<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA HUB: EVOLUTION 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --p: #00f2ff;
            --s: #ff00ff;
            --bg: #050505;
            --card: rgba(255, 255, 255, 0.08);
            --text: #fff;
            --border: rgba(0, 242, 255, 0.3);
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        /* –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è */
        #auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000 0%, #0a0a2a 100%);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .auth-card {
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid var(--p);
            text-align: center;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 0 50px var(--p);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 20px var(--p); }
            50% { box-shadow: 0 0 50px var(--p); }
            100% { box-shadow: 0 0 20px var(--p); }
        }
        
        .auth-input {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            border: 2px solid var(--p);
            background: rgba(0, 0, 0, 0.7);
            color: var(--text);
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .auth-btn {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, var(--p), var(--s));
            color: #000;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 242, 255, 0.5);
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #main-content {
            display: none;
            height: 100vh;
            flex-direction: column;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        nav {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.95);
            border-bottom: 3px solid var(--p);
            overflow-x: auto;
            flex-wrap: wrap;
            position: relative;
            z-index: 100;
        }
        
        nav button {
            background: transparent;
            border: 2px solid var(--p);
            color: var(--p);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        nav button:hover, nav button.active {
            background: var(--p);
            color: #000;
            transform: translateY(-2px);
        }
        
        /* –°–µ–∫—Ü–∏–∏ */
        section {
            display: none;
            height: calc(100vh - 70px);
            overflow: hidden;
            position: relative;
        }
        
        section.active {
            display: block;
        }
        
        /* –ú–∞–π–Ω–µ—Ä 3D */
        #miner-3d {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* UI –ø–æ–≤–µ—Ä—Ö 3D */
        #game-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
            padding: 20px;
        }
        
        .game-stats {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--p);
            pointer-events: all;
            min-width: 250px;
        }
        
        .game-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--p);
            pointer-events: all;
        }
        
        .miner-core {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, var(--p) 0%, transparent 70%);
            border-radius: 50%;
            border: 4px solid white;
            cursor: pointer;
            transition: all 0.1s;
            z-index: 3;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            pointer-events: all;
            box-shadow: 0 0 30px var(--p);
        }
        
        /* –ú–µ–Ω—é –≤ –∏–≥—Ä–µ */
        .game-menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid var(--p);
            z-index: 10;
            min-width: 400px;
            pointer-events: all;
            display: none;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: var(--card);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border);
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }
        
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        /* –Ø–π—Ü–∞ */
        .egg-card {
            padding: 15px;
            border-radius: 15px;
            border: 3px solid;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 0, 0, 0.5);
        }
        
        .egg-card:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.2);
        }
        
        .egg-common { border-color: #bdc3c7; }
        .egg-rare { border-color: #00ff00; }
        .egg-epic { border-color: #9b59b6; }
        .egg-mythic { border-color: #e74c3c; }
        .egg-legendary { border-color: #f1c40f; }
        .egg-god { border-color: #00ffff; }
        
        /* –ü–∏—Ç–æ–º—Ü—ã */
        .pet-card {
            padding: 15px;
            border-radius: 15px;
            border: 2px solid var(--p);
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .pet-emoji {
            font-size: 50px;
            margin-bottom: 10px;
        }
        
        /* –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è */
        .prestige-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid gold;
            margin: 20px 0;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            padding: 12px 20px;
            border-radius: 10px;
            border: 2px solid var(--p);
            background: rgba(0, 0, 0, 0.5);
            color: var(--text);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            background: var(--p);
            color: #000;
            transform: translateY(-2px);
        }
        
        .btn-big {
            padding: 20px;
            font-size: 18px;
            margin: 10px;
        }
        
        /* –•–µ–¥—à–æ—Ç—ã */
        .damage-indicator {
            position: absolute;
            font-size: 40px;
            color: red;
            font-weight: bold;
            animation: floatUp 1s forwards;
            pointer-events: none;
            z-index: 100;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }
        
        /* –£–ª—É—á—à–µ–Ω–∏—è */
        .upgrade-card {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 2px solid var(--s);
            margin: 10px 0;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .auth-card { padding: 20px; }
            nav button { font-size: 12px; padding: 8px 12px; }
            .game-stats, .game-controls { padding: 10px; }
            .miner-core { width: 100px; height: 100px; bottom: 100px; }
        }
    </style>
</head>
<body>

<!-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è -->
<div id="auth-overlay">
    <div class="auth-card">
        <h2 style="color:var(--p); margin-bottom: 30px;">üöÄ 3D ULTRA HUB</h2>
        
        <select id="user-select" class="auth-input">
            <option value="–ù–∏–∫–∏—Ç–∞">–ù–∏–∫–∏—Ç–∞ [ADMIN]</option>
            <option value="–ê–ª–µ–Ω–∞">–ê–ª–µ–Ω–∞</option>
            <option value="–°–∞—à–∞">–°–∞—à–∞</option>
            <option value="–ê–ª–∏—Å–∞">–ê–ª–∏—Å–∞</option>
        </select>
        
        <select id="device-select" class="auth-input">
            <option value="pc">üñ•Ô∏è –ö–æ–º–ø—å—é—Ç–µ—Ä</option>
            <option value="mobile">üì± –°–º–∞—Ä—Ç—Ñ–æ–Ω</option>
        </select>
        
        <input type="password" id="password-input" class="auth-input" placeholder="–í–í–ï–î–ò–¢–ï –õ–Æ–ë–û–ô –ü–ê–†–û–õ–¨" value="1" autocomplete="off">
        
        <button class="auth-btn" onclick="login()">
            üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ 3D –°–ò–°–¢–ï–ú–£
        </button>
        
        <p style="margin-top: 20px; color: #888; font-size: 14px;">
            ‚ö° F8 - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | WASD - –¥–≤–∏–∂–µ–Ω–∏–µ –≤ 3D
        </p>
    </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
<div id="main-content">
    <nav>
        <button onclick="switchTab('home')" class="active">üè† –ì–õ–ê–í–ù–ê–Ø</button>
        <button onclick="switchTab('miner3d')">üéÆ 3D –ú–ê–ô–ù–ï–†</button>
        <button onclick="switchTab('tom2')">üò∏ –¢–û–ú 2</button>
        <button onclick="switchTab('chat')">üí¨ –ß–ê–¢</button>
        <button onclick="switchTab('exit')">üö™ –í–´–•–û–î</button>
    </nav>

    <!-- –ì–ª–∞–≤–Ω–∞—è -->
    <section id="home" class="active">
        <div style="padding: 20px; max-width: 1200px; margin: 0 auto;">
            <div class="card">
                <h1 id="clock" style="font-size: 3rem; text-align: center; color: var(--p);">00:00:00</h1>
                <p id="user-tag" style="text-align: center; font-size: 1.2rem; margin: 10px 0;"></p>
            </div>
            
            <div class="card">
                <h2>üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ò–°–¢–ï–ú–´</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div style="background: rgba(0,255,0,0.1); padding: 15px; border-radius: 10px;">
                        <h3>üí∞ BYTES</h3>
                        <p style="font-size: 2rem; font-weight: bold;" id="balance-display">0</p>
                    </div>
                    
                    <div style="background: rgba(255,0,255,0.1); padding: 15px; border-radius: 10px;">
                        <h3>‚ö° –ú–ù–û–ñ–ò–¢–ï–õ–¨</h3>
                        <p style="font-size: 2rem; font-weight: bold;" id="multiplier">1x</p>
                    </div>
                    
                    <div style="background: rgba(0,242,255,0.1); padding: 15px; border-radius: 10px;">
                        <h3>üé™ –ü–ò–¢–û–ú–¶–ï–í</h3>
                        <p style="font-size: 2rem; font-weight: bold;" id="pets-count">0</p>
                    </div>
                    
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px;">
                        <h3>üîÑ –ü–ï–†–ï–†–û–ñ–î–ï–ù–ò–ô</h3>
                        <p style="font-size: 2rem; font-weight: bold;" id="rebirth-count">0</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 3D –ú–ê–ô–ù–ï–† (–≤—Å—ë –≤ –æ–¥–Ω–æ–º) -->
    <section id="miner3d">
        <div id="miner-3d">
            <canvas id="gameCanvas"></canvas>
            
            <!-- UI –ø–æ–≤–µ—Ä—Ö 3D -->
            <div id="game-ui">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="game-stats">
                    <h3>üéÆ 3D –ú–ê–ô–ù–ï–†</h3>
                    <p>üí∞ <span id="game-balance">0</span> BYTES</p>
                    <p>‚ö° –ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="game-multiplier">1x</span></p>
                    <p>üéØ –°–∏–ª–∞ —É–¥–∞—Ä–∞: <span id="click-power">1</span>x</p>
                    <p>ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä: <span id="auto-clicker-status">–í–´–ö–õ</span></p>
                </div>
                
                <!-- –Ø–¥—Ä–æ –¥–ª—è –∫–ª–∏–∫–æ–≤ -->
                <div class="miner-core" onclick="clickCore3D()">
                    –ö–õ–ò–ö–ù–ò!
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                <div class="game-controls">
                    <button class="btn" onclick="toggleGameMenu()">‚öôÔ∏è –ú–ï–ù–Æ</button>
                    <button class="btn" onclick="shootBullet()">üî´ –í–´–°–¢–†–ï–õ</button>
                </div>
                
                <!-- –ú–µ–Ω—é –≤ –∏–≥—Ä–µ -->
                <div id="game-menu" class="game-menu">
                    <h2 style="color:var(--p); margin-bottom: 20px;">üéÆ –ò–ì–†–û–í–û–ï –ú–ï–ù–Æ</h2>
                    
                    <!-- –Ø–π—Ü–∞ -->
                    <div class="card">
                        <h3>ü•ö –ú–ê–ì–ê–ó–ò–ù –Ø–ò–¶</h3>
                        <p>–í–∞—à–∏ BYTES: <span id="menu-balance">0</span></p>
                        <div class="card-grid">
                            <div class="egg-card egg-common" onclick="buyEgg('common')">
                                <div style="font-size: 40px;">ü•ö</div>
                                <h4>–û–±—ã—á–Ω–æ–µ</h4>
                                <p style="color: gold; font-weight: bold;">100 BYTES</p>
                            </div>
                            
                            <div class="egg-card egg-rare" onclick="buyEgg('rare')">
                                <div style="font-size: 40px;">üîµ</div>
                                <h4>–†–µ–¥–∫–æ–µ</h4>
                                <p style="color: gold; font-weight: bold;">500 BYTES</p>
                            </div>
                            
                            <div class="egg-card egg-epic" onclick="buyEgg('epic')">
                                <div style="font-size: 40px;">üíú</div>
                                <h4>–≠–ø–∏—á–µ—Å–∫–æ–µ</h4>
                                <p style="color: gold; font-weight: bold;">2,000 BYTES</p>
                            </div>
                            
                            <div class="egg-card egg-mythic" onclick="buyEgg('mythic')">
                                <div style="font-size: 40px;">üü†</div>
                                <h4>–ú–∏—Ñ–∏—á–µ—Å–∫–æ–µ</h4>
                                <p style="color: gold; font-weight: bold;">10,000 BYTES</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ü–∏—Ç–æ–º—Ü—ã -->
                    <div class="card">
                        <h3>üé™ –í–ê–®–ò –ü–ò–¢–û–ú–¶–´</h3>
                        <div id="pets-container" class="card-grid">
                            <!-- –ü–∏—Ç–æ–º—Ü—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                    
                    <!-- –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è -->
                    <div class="prestige-card">
                        <h3>üîÑ –°–ò–°–¢–ï–ú–ê –ü–ï–†–ï–†–û–ñ–î–ï–ù–ò–ô</h3>
                        <p>–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: <span id="menu-rebirths">0</span></p>
                        <p style="font-size: 24px; color: gold; margin: 15px 0;">
                            –°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="menu-prestige-cost">10,000</span> BYTES
                        </p>
                        <button class="btn btn-big" onclick="doPrestige()">üîÑ –ü–ï–†–ï–†–û–î–ò–¢–¨–°–Ø</button>
                        <p style="margin-top: 15px; font-size: 14px;">
                            +0.5x –∫ –º–Ω–æ–∂–∏—Ç–µ–ª—é | –°–±—Ä–æ—Å BYTES
                        </p>
                    </div>
                    
                    <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
                    <div class="card">
                        <h3>‚ö° –£–õ–£–ß–®–ï–ù–ò–Ø</h3>
                        <div class="upgrade-card">
                            <h4>üí™ –°–∏–ª–∞ –∫–ª–∏–∫–∞</h4>
                            <p>–¢–µ–∫—É—â–∞—è: <span id="upgrade-click-power">1</span>x</p>
                            <p>–°–ª–µ–¥—É—é—â–∞—è: <span id="next-click-power">2</span>x</p>
                            <button class="btn" onclick="buyUpgrade('click_power')">
                                –ö—É–ø–∏—Ç—å (1000 BYTES)
                            </button>
                        </div>
                        
                        <div class="upgrade-card">
                            <h4>ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</h4>
                            <p>–°—Ç–∞—Ç—É—Å: <span id="upgrade-auto-status">–í–´–ö–õ</span></p>
                            <button class="btn" onclick="buyUpgrade('auto_clicker')" id="auto-clicker-btn">
                                –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (5000 BYTES)
                            </button>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="toggleGameMenu()" style="width: 100%; margin-top: 20px;">
                        ‚úñ –ó–ê–ö–†–´–¢–¨ –ú–ï–ù–Æ
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- –¢–û–ú 2 -->
    <section id="tom2">
        <div style="padding: 20px; max-width: 800px; margin: 0 auto;">
            <div class="card">
                <h2 style="color:#ff6b6b; text-align: center;">üò∏ –¢–û–ú 2</h2>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 20px; border: 3px solid #ff6b6b; margin: 20px 0;">
                    <div style="width: 200px; height: 200px; background: #f8c291; border-radius: 50%; margin: 0 auto; position: relative; border: 5px solid #e55039;">
                        <div style="position: absolute; width: 40px; height: 60px; background: #f8c291; border-radius: 50%; top: -30px; left: 40px; transform: rotate(-20deg);"></div>
                        <div style="position: absolute; width: 40px; height: 60px; background: #f8c291; border-radius: 50%; top: -30px; right: 40px; transform: rotate(20deg);"></div>
                        
                        <div style="position: absolute; width: 30px; height: 40px; background: white; border-radius: 50%; top: 60px; left: 50px;">
                            <div style="position: absolute; width: 15px; height: 15px; background: black; border-radius: 50%; top: 12px; left: 7px;"></div>
                        </div>
                        
                        <div style="position: absolute; width: 30px; height: 40px; background: white; border-radius: 50%; top: 60px; right: 50px;">
                            <div style="position: absolute; width: 15px; height: 15px; background: black; border-radius: 50%; top: 12px; left: 7px;"></div>
                        </div>
                        
                        <div style="position: absolute; width: 60px; height: 30px; background: #e55039; border-radius: 0 0 30px 30px; bottom: 50px; left: 50%; transform: translateX(-50%);"></div>
                    </div>
                    
                    <div id="tom2-message" style="background: white; padding: 10px; border-radius: 10px; margin: 20px 0; border: 2px solid #ff6b6b; text-align: center; font-weight: bold; color: #333;">
                        –ü—Ä–∏–≤–µ—Ç! –Ø –¢–æ–º!
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0;">
                        <div style="background: white; padding: 10px; border-radius: 10px; border: 2px solid #4ecdc4; color: #333;">
                            <div>üçï –ì–æ–ª–æ–¥</div>
                            <div style="height: 10px; background: #ddd; border-radius: 5px; margin-top: 5px; overflow: hidden;">
                                <div id="tom2-hunger-bar" style="height: 100%; background: #4ecdc4; width: 100%;"></div>
                            </div>
                            <div id="tom2-hunger-value">100%</div>
                        </div>
                        
                        <div style="background: white; padding: 10px; border-radius: 10px; border: 2px solid #ffd32a; color: #333;">
                            <div>üí§ –≠–Ω–µ—Ä–≥–∏—è</div>
                            <div style="height: 10px; background: #ddd; border-radius: 5px; margin-top: 5px; overflow: hidden;">
                                <div id="tom2-energy-bar" style="height: 100%; background: #ffd32a; width: 100%;"></div>
                            </div>
                            <div id="tom2-energy-value">100%</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                        <button class="tom2-btn" onclick="tomAction('feed')">üçï –ö–û–†–ú–ò–¢–¨</button>
                        <button class="tom2-btn" onclick="tomAction('sleep')">üò¥ –°–ü–ê–¢–¨</button>
                        <button class="tom2-btn" onclick="tomAction('play')">‚öΩ –ò–ì–†–ê–¢–¨</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- –ß–ê–¢ -->
    <section id="chat">
        <div style="padding: 20px; max-width: 800px; margin: 0 auto; height: 100%;">
            <div class="card" style="height: 100%; display: flex; flex-direction: column;">
                <h2>üí¨ –ß–ê–¢ –°–ò–°–¢–ï–ú–´</h2>
                <div id="chat-container" style="flex: 1; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin: 15px 0;"></div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chat-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex: 1; padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; border: 2px solid var(--p);">
                    <button class="btn" onclick="sendChat()" style="padding: 12px 25px;">üì®</button>
                </div>
            </div>
        </div>
    </section>

    <!-- –í–´–•–û–î -->
    <section id="exit">
        <div style="padding: 20px; max-width: 600px; margin: 0 auto;">
            <div class="card">
                <h2 style="text-align: center;">üö™ –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ò–°–¢–ï–ú–û–ô</h2>
                
                <button class="btn btn-big" onclick="logout()" style="width: 100%; margin: 10px 0;">
                    üîì –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                </button>
                
                <button class="btn btn-big" onclick="exportData()" style="width: 100%; margin: 10px 0; background: #4CAF50;">
                    üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                </button>
                
                <button class="btn btn-big" onclick="importData()" style="width: 100%; margin: 10px 0; background: #2196F3;">
                    üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                </button>
                
                <button class="btn btn-big" onclick="resetData()" style="width: 100%; margin: 10px 0; background: #f44336;">
                    üí£ –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —Å–∏—Å—Ç–µ–º—ã
                </button>
                
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleFileImport(this.files[0])">
                
                <div style="margin-top: 30px; padding: 20px; background: rgba(255,0,0,0.1); border-radius: 15px; border: 2px solid red;">
                    <h3 style="color: red;">‚ö†Ô∏è –û–ü–ê–°–ù–ê–Ø –ó–û–ù–ê</h3>
                    <p>–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:</p>
                    <ul style="margin: 10px 0 20px 20px;">
                        <li>–í—Å–µ –≤–∞—à–∏ BYTES –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å</li>
                        <li>–ü–∏—Ç–æ–º—Ü–µ–≤ –∏ —è–π—Ü–∞</li>
                        <li>–£–ª—É—á—à–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è</li>
                        <li>–ò—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
// ====================
// –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –î–ê–ù–ù–´–ï
// ====================
let currentUser = "";
let currentDevice = "";
let autoClickerInterval = null;
let scene, camera, renderer, controls;
let cubes = [];
let bullets = [];
let enemies = [];
let gameActive = false;
let keys = {};
let lastShotTime = 0;
let shotCooldown = 300; // –º—Å –º–µ–∂–¥—É –≤—ã—Å—Ç—Ä–µ–ª–∞–º–∏

// –ë–∞–∑–∞ –ø–∏—Ç–æ–º—Ü–µ–≤
const petsDatabase = {
    common: [
        { name: "–ö—Ä–∏—Å—Ç–∞–ª–ª", emoji: "üíé", bonus: "+0.2x", value: 0.2, rarity: "common" },
        { name: "–†–æ–±–æ—Ç", emoji: "ü§ñ", bonus: "+0.15x", value: 0.15, rarity: "common" },
        { name: "–î—Ä–æ–∏–¥", emoji: "‚öôÔ∏è", bonus: "+0.1x", value: 0.1, rarity: "common" }
    ],
    rare: [
        { name: "–ö–∏–±–µ—Ä-–ö–æ—Ç", emoji: "üê±üíª", bonus: "+0.3x", value: 0.3, rarity: "rare" },
        { name: "–•–∞–∫–µ—Ä", emoji: "üë®‚Äçüíª", bonus: "+0.25x", value: 0.25, rarity: "rare" },
        { name: "–®–ø–∏–æ–Ω", emoji: "üïµÔ∏è", bonus: "+0.2x", value: 0.2, rarity: "rare" }
    ],
    epic: [
        { name: "–î—Ä–∞–∫–æ–Ω", emoji: "üê≤", bonus: "+0.5x", value: 0.5, rarity: "epic" },
        { name: "–ì—Ä–∏—Ñ–æ–Ω", emoji: "ü¶Ö", bonus: "+0.45x", value: 0.45, rarity: "epic" },
        { name: "–§–µ–Ω–∏–∫—Å", emoji: "üî•", bonus: "+0.4x", value: 0.4, rarity: "epic" }
    ],
    mythic: [
        { name: "–ö–∏–±–µ—Ä-–î–µ–º–æ–Ω", emoji: "üòàüíª", bonus: "+1x", value: 1, rarity: "mythic" },
        { name: "–ê–Ω–≥–µ–ª –¥–∞–Ω–Ω—ã—Ö", emoji: "üëºüíæ", bonus: "+0.8x", value: 0.8, rarity: "mythic" },
        { name: "–¢–∏—Ç–∞–Ω", emoji: "üóø", bonus: "+0.7x", value: 0.7, rarity: "mythic" }
    ]
};

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
let hubData = JSON.parse(localStorage.getItem('hub_data')) || {
    "–ù–∏–∫–∏—Ç–∞": { 
        bytes: 5000, 
        rebirths: 0, 
        eggsOpened: 0,
        pets: [], 
        upgrades: { click_power: 1, auto_clicker: false },
        tom2: { hunger: 100, energy: 100 }
    },
    "–ê–ª–µ–Ω–∞": { 
        bytes: 3000, 
        rebirths: 0, 
        eggsOpened: 0,
        pets: [], 
        upgrades: { click_power: 1, auto_clicker: false },
        tom2: { hunger: 100, energy: 100 }
    },
    "–°–∞—à–∞": { 
        bytes: 2000, 
        rebirths: 0, 
        eggsOpened: 0,
        pets: [], 
        upgrades: { click_power: 1, auto_clicker: false },
        tom2: { hunger: 100, energy: 100 }
    },
    "–ê–ª–∏—Å–∞": { 
        bytes: 1000, 
        rebirths: 0, 
        eggsOpened: 0,
        pets: [], 
        upgrades: { click_power: 1, auto_clicker: false },
        tom2: { hunger: 100, energy: 100 }
    }
};

let chatData = JSON.parse(localStorage.getItem('hub_chat')) || [];

// ====================
// –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
// ====================
function login() {
    const user = document.getElementById('user-select').value;
    const device = document.getElementById('device-select').value;
    const password = document.getElementById('password-input').value;
    
    if (!password || password.trim() === "") {
        alert("–í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π —Å–∏–º–≤–æ–ª –≤ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è!");
        return;
    }
    
    currentUser = user;
    currentDevice = device;
    
    if (!hubData[user]) {
        hubData[user] = { 
            bytes: 1000, 
            rebirths: 0, 
            eggsOpened: 0,
            pets: [], 
            upgrades: { click_power: 1, auto_clicker: false },
            tom2: { hunger: 100, energy: 100 }
        };
    }
    
    document.getElementById('auth-overlay').style.display = 'none';
    document.getElementById('main-content').style.display = 'flex';
    
    updateAllUI();
    startTom2System();
    loadChat();
    startClock();
    
    if (hubData[currentUser].upgrades.auto_clicker) {
        startAutoClicker();
    }
    
    saveData();
    alert(`üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ 3D —Å–∏—Å—Ç–µ–º—É, ${user}!`);
}

// ====================
// 3D –ò–ì–†–ê
// ====================
function init3DGame() {
    const canvas = document.getElementById('gameCanvas');
    
    // –°—Ü–µ–Ω–∞
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050505);
    scene.fog = new THREE.Fog(0x050505, 10, 50);
    
    // –ö–∞–º–µ—Ä–∞
    camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
    camera.position.set(0, 5, 15);
    
    // –†–µ–Ω–¥–µ—Ä–µ—Ä
    renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
    renderer.setSize(canvas.clientWidth, canvas.clientHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    
    // –û—Å–≤–µ—â–µ–Ω–∏–µ
    const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(10, 20, 5);
    directionalLight.castShadow = true;
    directionalLight.shadow.mapSize.width = 2048;
    directionalLight.shadow.mapSize.height = 2048;
    scene.add(directionalLight);
    
    // –ü–æ–ª
    const floorGeometry = new THREE.PlaneGeometry(100, 100);
    const floorMaterial = new THREE.MeshPhongMaterial({ 
        color: 0x1a1a1a,
        shininess: 30
    });
    const floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);
    
    // –°–æ–∑–¥–∞–µ–º –∫—É–±—ã-–º–∏—à–µ–Ω–∏
    createTargetCubes();
    
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–∞–≥–æ–≤
    createEnemies();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    gameActive = true;
    animate();
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à
    window.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true);
    window.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);
}

function createTargetCubes() {
    const colors = [0x00ff00, 0xff0000, 0x0000ff, 0xffff00, 0xff00ff];
    
    for (let i = 0; i < 20; i++) {
        const size = 1 + Math.random() * 2;
        const geometry = new THREE.BoxGeometry(size, size, size);
        const material = new THREE.MeshPhongMaterial({ 
            color: colors[Math.floor(Math.random() * colors.length)],
            emissive: 0x222222,
            shininess: 100
        });
        
        const cube = new THREE.Mesh(geometry, material);
        cube.castShadow = true;
        cube.receiveShadow = true;
        
        cube.position.x = (Math.random() - 0.5) * 40;
        cube.position.z = (Math.random() - 0.5) * 40;
        cube.position.y = size / 2;
        
        cube.userData = {
            health: 100,
            value: Math.floor(size * 10),
            isTarget: true
        };
        
        cubes.push(cube);
        scene.add(cube);
    }
}

function createEnemies() {
    for (let i = 0; i < 5; i++) {
        const geometry = new THREE.ConeGeometry(0.5, 2, 8);
        const material = new THREE.MeshPhongMaterial({ 
            color: 0xff5555,
            emissive: 0x550000
        });
        
        const enemy = new THREE.Mesh(geometry, material);
        enemy.castShadow = true;
        
        enemy.position.x = (Math.random() - 0.5) * 30;
        enemy.position.z = (Math.random() - 0.5) * 30;
        enemy.position.y = 1;
        
        enemy.userData = {
            health: 50,
            speed: 0.02 + Math.random() * 0.03,
            damage: 10,
            isEnemy: true
        };
        
        enemies.push(enemy);
        scene.add(enemy);
    }
}

function animate() {
    if (!gameActive) return;
    
    requestAnimationFrame(animate);
    
    // –î–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
    const speed = 0.2;
    if (keys['w']) camera.position.z -= speed;
    if (keys['s']) camera.position.z += speed;
    if (keys['a']) camera.position.x -= speed;
    if (keys['d']) camera.position.x += speed;
    if (keys[' ']) camera.position.y += speed; // –ü—Ä–æ–±–µ–ª - –≤–≤–µ—Ä—Ö
    if (keys['shift']) camera.position.y -= speed; // Shift - –≤–Ω–∏–∑
    
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
    camera.position.x = Math.max(-40, Math.min(40, camera.position.x));
    camera.position.z = Math.max(-40, Math.min(40, camera.position.z));
    camera.position.y = Math.max(1, Math.min(20, camera.position.y));
    
    // –í—Ä–∞—â–µ–Ω–∏–µ –∫—É–±–æ–≤
    cubes.forEach(cube => {
        cube.rotation.x += 0.01;
        cube.rotation.y += 0.01;
        
        // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑
        cube.position.y = (cube.geometry.parameters.height / 2) + Math.sin(Date.now() * 0.001 + cube.position.x) * 0.5;
    });
    
    // –î–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
    enemies.forEach(enemy => {
        const dx = camera.position.x - enemy.position.x;
        const dz = camera.position.z - enemy.position.z;
        const distance = Math.sqrt(dx * dx + dz * dz);
        
        if (distance > 5) {
            enemy.position.x += (dx / distance) * enemy.userData.speed;
            enemy.position.z += (dz / distance) * enemy.userData.speed;
        }
        
        // –í—Ä–∞—â–µ–Ω–∏–µ –∫ –∏–≥—Ä–æ–∫—É
        enemy.lookAt(camera.position);
        
        // –ï—Å–ª–∏ –≤—Ä–∞–≥ –±–ª–∏–∑–∫–æ - –Ω–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω
        if (distance < 3) {
            showDamage(-enemy.userData.damage, camera.position.x, camera.position.y, camera.position.z);
        }
    });
    
    // –î–≤–∏–∂–µ–Ω–∏–µ –ø—É–ª—å
    for (let i = bullets.length - 1; i >= 0; i--) {
        const bullet = bullets[i];
        bullet.position.add(bullet.userData.velocity);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∫—É–±–∞–º–∏
        cubes.forEach((cube, cubeIndex) => {
            const distance = bullet.position.distanceTo(cube.position);
            if (distance < cube.geometry.parameters.width) {
                // –ü–æ–ø–∞–¥–∞–Ω–∏–µ!
                cube.userData.health -= 25;
                
                if (cube.userData.health <= 0) {
                    // –£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –∫—É–±–∞
                    const reward = cube.userData.value * calculateMultiplier();
                    hubData[currentUser].bytes += reward;
                    
                    showDamage(reward, cube.position.x, cube.position.y, cube.position.z);
                    
                    scene.remove(cube);
                    cubes.splice(cubeIndex, 1);
                    updateAllUI();
                    saveData();
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫—É–±
                    setTimeout(() => createNewCube(), 1000);
                }
                
                // –£–¥–∞–ª—è–µ–º –ø—É–ª—é
                scene.remove(bullet);
                bullets.splice(i, 1);
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –≤—Ä–∞–≥–∞–º–∏
        enemies.forEach((enemy, enemyIndex) => {
            const distance = bullet.position.distanceTo(enemy.position);
            if (distance < 2) {
                // –ü–æ–ø–∞–¥–∞–Ω–∏–µ –≤–æ –≤—Ä–∞–≥–∞
                enemy.userData.health -= 25;
                
                if (enemy.userData.health <= 0) {
                    const reward = 100 * calculateMultiplier();
                    hubData[currentUser].bytes += reward;
                    
                    showDamage(reward, enemy.position.x, enemy.position.y, enemy.position.z);
                    
                    scene.remove(enemy);
                    enemies.splice(enemyIndex, 1);
                    updateAllUI();
                    saveData();
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –≤—Ä–∞–≥–∞
                    setTimeout(() => createNewEnemy(), 2000);
                }
                
                // –£–¥–∞–ª—è–µ–º –ø—É–ª—é
                scene.remove(bullet);
                bullets.splice(i, 1);
            }
        });
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—É–ª—å –¥–∞–ª–µ–∫–æ –æ—Ç –∫–∞–º–µ—Ä—ã
        if (bullet.position.distanceTo(camera.position) > 100) {
            scene.remove(bullet);
            bullets.splice(i, 1);
        }
    }
    
    renderer.render(scene, camera);
}

function shootBullet() {
    const now = Date.now();
    if (now - lastShotTime < shotCooldown) return;
    lastShotTime = now;
    
    const geometry = new THREE.SphereGeometry(0.1, 8, 8);
    const material = new THREE.MeshBasicMaterial({ color: 0xffff00 });
    const bullet = new THREE.Mesh(geometry, material);
    
    // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∑–≥–ª—è–¥–∞ –∫–∞–º–µ—Ä—ã
    const direction = new THREE.Vector3();
    camera.getWorldDirection(direction);
    
    bullet.position.copy(camera.position);
    bullet.position.y -= 1; // –ù–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ –∫–∞–º–µ—Ä—ã
    
    bullet.userData = {
        velocity: direction.multiplyScalar(1),
        damage: 25
    };
    
    bullets.push(bullet);
    scene.add(bullet);
}

function createNewCube() {
    const colors = [0x00ff00, 0xff0000, 0x0000ff];
    const size = 1 + Math.random() * 2;
    const geometry = new THREE.BoxGeometry(size, size, size);
    const material = new THREE.MeshPhongMaterial({ 
        color: colors[Math.floor(Math.random() * colors.length)],
        emissive: 0x222222,
        shininess: 100
    });
    
    const cube = new THREE.Mesh(geometry, material);
    cube.castShadow = true;
    cube.receiveShadow = true;
    
    cube.position.x = (Math.random() - 0.5) * 40;
    cube.position.z = (Math.random() - 0.5) * 40;
    cube.position.y = size / 2;
    
    cube.userData = {
        health: 100,
        value: Math.floor(size * 10),
        isTarget: true
    };
    
    cubes.push(cube);
    scene.add(cube);
}

function createNewEnemy() {
    const geometry = new THREE.ConeGeometry(0.5, 2, 8);
    const material = new THREE.MeshPhongMaterial({ 
        color: 0xff5555,
        emissive: 0x550000
    });
    
    const enemy = new THREE.Mesh(geometry, material);
    enemy.castShadow = true;
    
    enemy.position.x = (Math.random() - 0.5) * 30;
    enemy.position.z = (Math.random() - 0.5) * 30;
    enemy.position.y = 1;
    
    enemy.userData = {
        health: 50,
        speed: 0.02 + Math.random() * 0.03,
        damage: 10,
        isEnemy: true
    };
    
    enemies.push(enemy);
    scene.add(enemy);
}

function showDamage(value, x, y, z) {
    const damageElement = document.createElement('div');
    damageElement.className = 'damage-indicator';
    damageElement.textContent = value > 0 ? `+${value}` : value;
    damageElement.style.color = value > 0 ? '#00ff00' : '#ff0000';
    damageElement.style.left = '50%';
    damageElement.style.top = '50%';
    damageElement.style.transform = `translate(calc(-50% + ${x * 10}px), calc(-50% + ${-y * 10}px))`;
    
    document.getElementById('game-ui').appendChild(damageElement);
    
    setTimeout(() => {
        if (damageElement.parentNode) {
            damageElement.parentNode.removeChild(damageElement);
        }
    }, 1000);
}

// ====================
# –°–ò–°–¢–ï–ú–ê –ú–ê–ô–ù–ï–† (—è–π—Ü–∞, –ø–∏—Ç–æ–º—Ü—ã, –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è)
# ====================
function clickCore3D() {
    const core = document.querySelector('.miner-core');
    const userData = hubData[currentUser];
    const multiplier = calculateMultiplier();
    const clickPower = userData.upgrades.click_power || 1;
    
    // –ê–Ω–∏–º–∞—Ü–∏—è
    core.style.transform = 'translateX(-50%) scale(0.8)';
    core.style.boxShadow = '0 0 50px var(--p)';
    
    setTimeout(() => {
        core.style.transform = 'translateX(-50%) scale(1)';
        core.style.boxShadow = '0 0 30px var(--p)';
    }, 100);
    
    // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ
    const gain = Math.floor(50 * multiplier * clickPower);
    userData.bytes += gain;
    hubData[currentUser] = userData;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Ä–æ–Ω
    showDamage(gain, 0, 0, 0);
    
    updateAllUI();
    saveData();
}

function buyEgg(type) {
    const userData = hubData[currentUser];
    const prices = {
        common: 100,
        rare: 500,
        epic: 2000,
        mythic: 10000
    };
    
    const price = prices[type];
    if (userData.bytes < price) {
        alert(`–ù—É–∂–Ω–æ ${price} BYTES!`);
        return;
    }
    
    userData.bytes -= price;
    userData.eggsOpened = (userData.eggsOpened || 0) + 1;
    
    const result = openEgg(type);
    
    let message = `ü•ö –í—ã –ø–æ–ª—É—á–∏–ª–∏:\n`;
    result.forEach(pet => {
        message += `${pet.emoji} ${pet.name} (${pet.bonus})\n`;
    });
    
    alert(message);
    
    if (!userData.pets) userData.pets = [];
    result.forEach(pet => {
        userData.pets.push({
            ...pet,
            active: true,
            id: Date.now() + Math.random()
        });
    });
    
    hubData[currentUser] = userData;
    updateAllUI();
    saveData();
}

function openEgg(type) {
    const results = [];
    const pool = petsDatabase[type];
    
    // –û—Å–Ω–æ–≤–Ω–æ–π –ø–∏—Ç–æ–º–µ—Ü
    if (pool && pool.length > 0) {
        const pet = {...pool[Math.floor(Math.random() * pool.length)]};
        results.push(pet);
    }
    
    // –®–∞–Ω—Å –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ
    const extraChance = { common: 0.1, rare: 0.2, epic: 0.3, mythic: 0.5 }[type] || 0;
    if (Math.random() < extraChance) {
        const extraTypes = ['common', 'rare', 'epic'];
        const extraType = extraTypes[Math.floor(Math.random() * extraTypes.length)];
        const extraPool = petsDatabase[extraType];
        if (extraPool && extraPool.length > 0) {
            results.push({...extraPool[Math.floor(Math.random() * extraPool.length)]});
        }
    }
    
    return results;
}

function renderPets() {
    const container = document.getElementById('pets-container');
    const userData = hubData[currentUser];
    const pets = userData.pets || [];
    
    container.innerHTML = '';
    
    if (pets.length === 0) {
        container.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–∏—Ç–æ–º—Ü–µ–≤</p>';
        return;
    }
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏
    const rarityOrder = { mythic: 4, epic: 3, rare: 2, common: 1 };
    pets.sort((a, b) => (rarityOrder[b.rarity] || 0) - (rarityOrder[a.rarity] || 0));
    
    pets.forEach(pet => {
        const petCard = document.createElement('div');
        petCard.className = 'pet-card';
        petCard.innerHTML = `
            <div class="pet-emoji">${pet.emoji}</div>
            <h4>${pet.name}</h4>
            <p>${pet.bonus}</p>
            <p style="font-size: 12px; color: #888;">
                ${pet.rarity === 'common' ? '–û–±—ã—á–Ω—ã–π' : 
                  pet.rarity === 'rare' ? '–†–µ–¥–∫–∏–π' : 
                  pet.rarity === 'epic' ? '–≠–ø–∏—á–µ—Å–∫–∏–π' : '–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π'}
            </p>
        `;
        container.appendChild(petCard);
    });
}

function doPrestige() {
    const userData = hubData[currentUser];
    const rebirths = userData.rebirths || 0;
    const cost = Math.floor(10000 * Math.pow(1.5, rebirths));
    
    if (userData.bytes < cost) {
        alert(`–ù—É–∂–Ω–æ ${cost.toLocaleString()} BYTES!`);
        return;
    }
    
    if (!confirm(`üîÑ –ü–ï–†–ï–†–û–ñ–î–ï–ù–ò–ï #${rebirths + 1}\n\n–°—Ç–æ–∏–º–æ—Å—Ç—å: ${cost.toLocaleString()} BYTES\n\n–í—ã –ø–æ–ª—É—á–∏—Ç–µ:\n‚Ä¢ +0.5x –∫ –º–Ω–æ–∂–∏—Ç–µ–ª—é\n‚Ä¢ –°–±—Ä–æ—Å —É–ª—É—á—à–µ–Ω–∏–π\n‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–µ–≤`)) {
        return;
    }
    
    userData.bytes = 0;
    userData.rebirths = rebirths + 1;
    userData.upgrades = { click_power: 1, auto_clicker: false };
    
    hubData[currentUser] = userData;
    updateAllUI();
    saveData();
    alert(`üéâ –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ #${userData.rebirths} –∑–∞–≤–µ—Ä—à–µ–Ω–æ!`);
}

function buyUpgrade(type) {
    const userData = hubData[currentUser];
    const costs = {
        click_power: 1000,
        auto_clicker: 5000
    };
    
    const cost = costs[type];
    if (userData.bytes < cost) {
        alert(`–ù—É–∂–Ω–æ ${cost} BYTES!`);
        return;
    }
    
    userData.bytes -= cost;
    
    if (type === 'click_power') {
        userData.upgrades.click_power = (userData.upgrades.click_power || 1) + 1;
        alert(`üí™ –°–∏–ª–∞ –∫–ª–∏–∫–∞: ${userData.upgrades.click_power}x`);
    } else if (type === 'auto_clicker' && !userData.upgrades.auto_clicker) {
        userData.upgrades.auto_clicker = true;
        startAutoClicker();
        alert(`ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!`);
    }
    
    hubData[currentUser] = userData;
    updateAllUI();
    saveData();
}

function startAutoClicker() {
    if (autoClickerInterval) return;
    
    autoClickerInterval = setInterval(() => {
        if (!hubData[currentUser]?.upgrades?.auto_clicker) {
            clearInterval(autoClickerInterval);
            autoClickerInterval = null;
            return;
        }
        
        const userData = hubData[currentUser];
        const multiplier = calculateMultiplier();
        const clickPower = userData.upgrades.click_power || 1;
        const gain = Math.floor(10 * multiplier * clickPower);
        userData.bytes += gain;
        hubData[currentUser] = userData;
        
        updateAllUI();
        saveData();
    }, 1000);
}

// ====================
# –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê
# ====================
function updateAllUI() {
    if (!currentUser || !hubData[currentUser]) return;
    
    const userData = hubData[currentUser];
    const balance = userData.bytes || 0;
    const rebirths = userData.rebirths || 0;
    const multiplier = calculateMultiplier();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
    document.getElementById('balance-display').textContent = balance.toLocaleString();
    document.getElementById('game-balance').textContent = balance.toLocaleString();
    document.getElementById('menu-balance').textContent = balance.toLocaleString();
    
    // –ú–Ω–æ–∂–∏—Ç–µ–ª—å
    document.getElementById('multiplier').textContent = multiplier.toFixed(1) + 'x';
    document.getElementById('game-multiplier').textContent = multiplier.toFixed(1) + 'x';
    
    // –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è
    document.getElementById('rebirth-count').textContent = rebirths;
    document.getElementById('menu-rebirths').textContent = rebirths;
    
    // –ü–∏—Ç–æ–º—Ü—ã
    document.getElementById('pets-count').textContent = (userData.pets || []).length;
    
    // –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è
    const prestigeCost = Math.floor(10000 * Math.pow(1.5, rebirths));
    document.getElementById('menu-prestige-cost').textContent = prestigeCost.toLocaleString();
    
    // –£–ª—É—á—à–µ–Ω–∏—è
    document.getElementById('click-power').textContent = userData.upgrades.click_power || 1;
    document.getElementById('upgrade-click-power').textContent = userData.upgrades.click_power || 1;
    document.getElementById('next-click-power').textContent = (userData.upgrades.click_power || 1) + 1;
    
    const autoStatus = userData.upgrades.auto_clicker ? '–í–ö–õ' : '–í–´–ö–õ';
    document.getElementById('auto-clicker-status').textContent = autoStatus;
    document.getElementById('upgrade-auto-status').textContent = autoStatus;
    
    if (userData.upgrades.auto_clicker) {
        document.getElementById('auto-clicker-btn').innerHTML = 'ü§ñ –ê–ö–¢–ò–í–ï–ù';
        document.getElementById('auto-clicker-btn').style.background = '#00ff00';
        document.getElementById('auto-clicker-btn').style.color = '#000';
    } else {
        document.getElementById('auto-clicker-btn').innerHTML = '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (5000 BYTES)';
        document.getElementById('auto-clicker-btn').style.background = '';
        document.getElementById('auto-clicker-btn').style.color = '';
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∏—Ç–æ–º—Ü–µ–≤
    renderPets();
}

function calculateMultiplier() {
    const userData = hubData[currentUser];
    let multiplier = 1 + (userData.rebirths || 0) * 0.5;
    
    // –ë–æ–Ω—É—Å –æ—Ç –ø–∏—Ç–æ–º—Ü–µ–≤
    const activePets = (userData.pets || []).filter(p => p.active);
    activePets.forEach(pet => {
        multiplier += pet.value || 0;
    });
    
    return multiplier;
}

// ====================
# –¢–û–ú 2
# ====================
function startTom2System() {
    updateTom2UI();
    
    setInterval(() => {
        const tom2 = hubData[currentUser].tom2;
        
        tom2.hunger = Math.max(0, tom2.hunger - 0.3);
        tom2.energy = Math.max(0, tom2.energy - 0.2);
        
        updateTom2UI();
        saveData();
    }, 10000);
}

function updateTom2UI() {
    const tom2 = hubData[currentUser].tom2;
    
    document.getElementById('tom2-hunger-bar').style.width = tom2.hunger + '%';
    document.getElementById('tom2-energy-bar').style.width = tom2.energy + '%';
    
    document.getElementById('tom2-hunger-value').textContent = Math.round(tom2.hunger) + '%';
    document.getElementById('tom2-energy-value').textContent = Math.round(tom2.energy) + '%';
    
    let message = "–ü—Ä–∏–≤–µ—Ç! –Ø –¢–æ–º!";
    if (tom2.hunger < 20) message = "–Ø –≥–æ–ª–æ–¥–µ–Ω! üçï";
    else if (tom2.energy < 20) message = "–Ø —É—Å—Ç–∞–ª... üò¥";
    
    document.getElementById('tom2-message').textContent = message;
}

function tomAction(action) {
    const tom2 = hubData[currentUser].tom2;
    const messages = {
        feed: "–í–∫—É—Å–Ω–æ! –ú—É—Ä—Ä—Ä... üòã",
        sleep: "Zzz... –•–æ—Ä–æ—à–æ —Å–ø–ª—é... üí§",
        play: "–£—Ä–∞! –ò–≥—Ä–∞–µ–º! ‚öΩ"
    };
    
    switch(action) {
        case 'feed':
            tom2.hunger = Math.min(100, tom2.hunger + 30);
            break;
        case 'sleep':
            tom2.energy = 100;
            break;
        case 'play':
            tom2.energy = Math.max(0, tom2.energy - 15);
            break;
    }
    
    document.getElementById('tom2-message').textContent = messages[action];
    updateTom2UI();
    saveData();
    
    setTimeout(() => {
        document.getElementById('tom2-message').textContent = "–ü—Ä–∏–≤–µ—Ç! –Ø –¢–æ–º!";
    }, 2000);
}

// ====================
# –ß–ê–¢ –ò –£–¢–ò–õ–ò–¢–´
# ====================
function loadChat() {
    const container = document.getElementById('chat-container');
    container.innerHTML = '';
    
    chatData.slice(-20).forEach(msg => {
        const msgDiv = document.createElement('div');
        msgDiv.style.padding = '8px';
        msgDiv.style.margin = '5px 0';
        msgDiv.style.background = msg.user === currentUser ? 'rgba(0,255,0,0.1)' : 'rgba(0,242,255,0.1)';
        msgDiv.style.borderRadius = '8px';
        msgDiv.innerHTML = `<strong>${msg.user}:</strong> ${msg.text}`;
        container.appendChild(msgDiv);
    });
    
    container.scrollTop = container.scrollHeight;
}

function sendChat() {
    const input = document.getElementById('chat-input');
    const text = input.value.trim();
    
    if (!text) return;
    
    const message = {
        user: currentUser,
        text: text,
        time: new Date().toLocaleTimeString()
    };
    
    chatData.push(message);
    if (chatData.length > 100) chatData.shift();
    
    localStorage.setItem('hub_chat', JSON.stringify(chatData));
    loadChat();
    input.value = '';
}

function startClock() {
    function update() {
        const now = new Date();
        document.getElementById('clock').textContent = 
            now.toLocaleTimeString('ru-RU', { hour12: false });
    }
    update();
    setInterval(update, 1000);
}

function switchTab(tabId) {
    document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    document.querySelectorAll('section').forEach(section => section.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    
    if (tabId === 'miner3d') {
        setTimeout(() => {
            if (!scene) {
                init3DGame();
            }
            resize3D();
        }, 100);
    }
}

function resize3D() {
    if (camera && renderer) {
        const canvas = document.getElementById('gameCanvas');
        camera.aspect = canvas.clientWidth / canvas.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(canvas.clientWidth, canvas.clientHeight);
    }
}

function toggleGameMenu() {
    const menu = document.getElementById('game-menu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

function saveData() {
    localStorage.setItem('hub_data', JSON.stringify(hubData));
    localStorage.setItem('hub_chat', JSON.stringify(chatData));
    localStorage.setItem('last_user', currentUser);
}

function logout() {
    if (confirm('–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?')) {
        saveData();
        location.reload();
    }
}

function exportData() {
    const data = {
        hubData: hubData,
        chatData: chatData,
        exportDate: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `ultra-hub-3d-backup-${currentUser}.json`;
    a.click();
    URL.revokeObjectURL(url);
    
    alert('üíæ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
}

function importData() {
    document.getElementById('import-file').click();
}

function handleFileImport(file) {
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            if (confirm("–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?")) {
                if (data.hubData) hubData = data.hubData;
                if (data.chatData) chatData = data.chatData;
                
                saveData();
                updateAllUI();
                loadChat();
                alert('üíæ –î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
            }
        } catch (err) {
            alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ!');
        }
    };
    reader.readAsText(file);
}

function resetData() {
    if (confirm('üí£ –£–î–ê–õ–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) {
        localStorage.clear();
        location.reload();
    }
}

// ====================
# –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
# ====================
window.addEventListener('load', function() {
    // –ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    document.getElementById('password-input').value = "1";
    
    // Enter –¥–ª—è –≤—Ö–æ–¥–∞
    document.getElementById('password-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') login();
    });
    
    // –ê–≤—Ç–æ–≤—Ö–æ–¥
    const lastUser = localStorage.getItem('last_user');
    if (lastUser && hubData[lastUser]) {
        currentUser = lastUser;
        document.getElementById('auth-overlay').style.display = 'none';
        document.getElementById('main-content').style.display = 'flex';
        
        updateAllUI();
        startTom2System();
        loadChat();
        startClock();
        
        if (hubData[currentUser].upgrades.auto_clicker) {
            startAutoClicker();
        }
    }
});

// –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
window.addEventListener('keydown', function(e) {
    // –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
    if (e.key === 'F8' && currentUser === "–ù–∏–∫–∏—Ç–∞") {
        const bytes = parseInt(prompt("–°–∫–æ–ª—å–∫–æ BYTES –¥–æ–±–∞–≤–∏—Ç—å?"));
        if (!isNaN(bytes) && bytes > 0) {
            hubData[currentUser].bytes += bytes;
            updateAllUI();
            saveData();
            alert(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${bytes} BYTES!`);
        }
    }
    
    // –í—ã—Å—Ç—Ä–µ–ª –≤ 3D
    if (e.key === 'f' && document.getElementById('miner3d').classList.contains('active')) {
        shootBullet();
    }
    
    // –ú–µ–Ω—é –≤ –∏–≥—Ä–µ
    if (e.key === 'Escape' && document.getElementById('miner3d').classList.contains('active')) {
        toggleGameMenu();
    }
    
    // –ß–∞—Ç
    if (e.key === 'Enter' && document.getElementById('chat-input') === document.activeElement) {
        sendChat();
    }
});

// –†–µ—Å–∞–π–∑ 3D —Å—Ü–µ–Ω—ã
window.addEventListener('resize', resize3D);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA HUB - PVP –®–£–¢–ï–† & –§–≠–ú–ò–õ–ò –•–ê–ë</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --p: #00f2ff;
            --s: #ff00ff;
            --bg: #050505;
            --text: #fff;
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        /* –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - –ü–†–û–°–¢–ê–Ø */
        #auth-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #000 0%, #0a0a2a 100%);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .auth-card {
            background: rgba(0,0,0,0.95);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid var(--p);
            text-align: center;
            width: 100%;
            max-width: 400px;
            backdrop-filter: blur(10px);
        }
        
        .auth-title {
            color: var(--p);
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .auth-subtitle {
            color: var(--s);
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .auth-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: 2px solid var(--p);
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
        }
        
        .auth-btn {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            border-radius: 10px;
            border: none;
            background: var(--p);
            color: black;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 242, 255, 0.4);
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #main-content {
            display: none;
            height: 100vh;
            flex-direction: column;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        nav {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(0,0,0,0.95);
            border-bottom: 3px solid var(--p);
            overflow-x: auto;
            flex-wrap: wrap;
            backdrop-filter: blur(10px);
        }
        
        .nav-btn {
            background: transparent;
            border: 2px solid var(--p);
            color: var(--p);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .nav-btn:hover, .nav-btn.active {
            background: var(--p);
            color: black;
            transform: translateY(-2px);
        }
        
        /* –°–µ–∫—Ü–∏–∏ */
        .section {
            display: none;
            height: calc(100vh - 70px);
            overflow: hidden;
            position: relative;
        }
        
        .section.active {
            display: block;
        }
        
        /* –®–£–¢–ï–† - –æ—Ç–¥–µ–ª—å–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ */
        #shooter-section {
            background: linear-gradient(135deg, #0a0a1a 0%, #000 100%);
        }
        
        #game-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        #game-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }
        
        /* –ò–≥—Ä–æ–≤–æ–π UI */
        #game-ui {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 2;
            pointer-events: none;
            padding: 20px;
        }
        
        .game-stats {
            position: absolute;
            top: 20px; left: 20px;
            background: rgba(0,0,0,0.85);
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid var(--p);
            pointer-events: all;
            min-width: 280px;
            backdrop-filter: blur(5px);
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .health-bar {
            width: 100%;
            height: 10px;
            background: rgba(255,0,0,0.3);
            border-radius: 5px;
            margin: 5px 0;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #00ff00);
            border-radius: 5px;
            transition: width 0.3s;
        }
        
        .weapon-hud {
            position: absolute;
            bottom: 100px;
            right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid var(--p);
            pointer-events: all;
            min-width: 200px;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        
        .ammo-counter {
            font-size: 24px;
            font-weight: bold;
            color: var(--p);
            margin: 5px 0;
        }
        
        .weapon-name {
            font-size: 18px;
            color: white;
        }
        
        /* –ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤ */
        .skin-shop {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.95);
            padding: 20px;
            border-radius: 15px;
            border: 3px solid var(--s);
            pointer-events: all;
            width: 320px;
            backdrop-filter: blur(5px);
            display: none;
        }
        
        .skin-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .skin-item {
            background: rgba(255,255,255,0.1);
            border: 2px solid var(--p);
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .skin-item:hover {
            transform: scale(1.05);
            border-color: var(--s);
        }
        
        .skin-item.equipped {
            background: rgba(0,255,0,0.2);
            border-color: #00ff00;
        }
        
        /* –ö–µ–π—Å—ã */
        .case-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.98);
            padding: 30px;
            border-radius: 20px;
            border: 3px solid gold;
            pointer-events: all;
            width: 90%;
            max-width: 600px;
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .case-item {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid var(--p);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .case-item:hover {
            transform: translateY(-5px);
            border-color: var(--s);
            box-shadow: 0 10px 20px rgba(0,242,255,0.3);
        }
        
        .case-item.legendary {
            border-color: gold;
            background: linear-gradient(135deg, #2a1a00, #4d3c00);
        }
        
        /* –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        .mobile-controls {
            display: none;
            position: absolute;
            bottom: 20px;
            width: 100%;
            padding: 0 20px;
        }
        
        .mobile-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mobile-btn {
            padding: 20px;
            background: rgba(0,0,0,0.85);
            border: 2px solid var(--p);
            color: white;
            font-size: 24px;
            border-radius: 50%;
            cursor: pointer;
            pointer-events: all;
            user-select: none;
            transition: all 0.2s;
            backdrop-filter: blur(5px);
        }
        
        .mobile-btn:active {
            transform: scale(0.95);
            background: var(--p);
        }
        
        .joystick-area {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 120px;
            height: 120px;
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            pointer-events: all;
            border: 2px solid var(--p);
            backdrop-filter: blur(5px);
        }
        
        .joystick {
            position: absolute;
            width: 50px;
            height: 50px;
            background: var(--p);
            border-radius: 50%;
            top: 35px;
            left: 35px;
            touch-action: none;
            box-shadow: 0 0 10px rgba(0,242,255,0.5);
        }
        
        /* –ú–µ–Ω—é –∏–≥—Ä—ã */
        .game-menu {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.98);
            padding: 30px;
            border-radius: 20px;
            border: 3px solid var(--p);
            z-index: 10;
            min-width: 400px;
            pointer-events: all;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        .menu-title {
            color: var(--p);
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        /* –§—ç–º–∏–ª–∏ –•–∞–± */
        #family-section {
            background: linear-gradient(135deg, #0a1a0a 0%, #001a00 100%);
            padding: 20px;
            overflow-y: auto;
        }
        
        .hub-card {
            background: rgba(0,0,0,0.9);
            padding: 25px;
            border-radius: 20px;
            border: 2px solid #00ff00;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }
        
        .hub-title {
            color: #00ff00;
            margin-bottom: 15px;
            font-size: 22px;
        }
        
        .currency-display {
            font-size: 42px;
            color: gold;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }
        
        .clicker-core {
            width: 180px;
            height: 180px;
            background: radial-gradient(circle, #00ff00 0%, transparent 70%);
            border-radius: 50%;
            border: 3px solid white;
            margin: 20px auto;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: black;
            transition: all 0.2s;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 20px #00ff00; }
            50% { box-shadow: 0 0 40px #00ff00; }
            100% { box-shadow: 0 0 20px #00ff00; }
        }
        
        .clicker-core:active {
            transform: scale(0.95);
        }
        
        .upgrade-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .upgrade-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid var(--p);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upgrade-item:hover {
            transform: translateY(-3px);
            border-color: var(--s);
        }
        
        .egg-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .egg-item {
            background: linear-gradient(135deg, #2a1a2a, #1a0a1a);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .egg-item.common {
            border-color: #aaa;
        }
        
        .egg-item.rare {
            border-color: #00aaff;
        }
        
        .egg-item.epic {
            border-color: #aa00ff;
        }
        
        .egg-item.legendary {
            border-color: gold;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            margin: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .mobile-controls { display: block; }
            .joystick-area { display: block; }
            .game-menu, .skin-shop, .case-container { 
                min-width: 95%;
                padding: 15px;
            }
            .game-stats, .weapon-hud {
                min-width: 250px;
                font-size: 14px;
            }
            .nav-btn { padding: 8px 15px; font-size: 14px; }
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç—ã */
        .damage-effect {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            opacity: 0;
            z-index: 5;
            transition: opacity 0.3s;
        }
        
        .hit-marker {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-size: 40px;
            pointer-events: none;
            opacity: 0;
            z-index: 3;
        }
    </style>
</head>
<body>

<!-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è -->
<div id="auth-overlay">
    <div class="auth-card">
        <h1 class="auth-title">üéÆ ULTRA HUB</h1>
        <p class="auth-subtitle">CS 1.6 –®—É—Ç–µ—Ä & –§—ç–º–∏–ª–∏ –•–∞–± –ú–∞–π–Ω–µ—Ä</p>
        
        <select id="user-select" class="auth-input">
            <option value="–ù–∏–∫–∏—Ç–∞">–ù–∏–∫–∏—Ç–∞</option>
            <option value="–ê–ª–µ–Ω–∞">–ê–ª–µ–Ω–∞</option>
            <option value="–°–∞—à–∞">–°–∞—à–∞</option>
            <option value="–ê–ª–∏—Å–∞">–ê–ª–∏—Å–∞</option>
            <option value="–ì–æ—Å—Ç—å">–ì–æ—Å—Ç—å</option>
        </select>
        
        <input type="password" id="password-input" class="auth-input" placeholder="–õ—é–±–æ–π –ø–∞—Ä–æ–ª—å" value="1">
        
        <button class="auth-btn" onclick="login()">
            üöÄ –í–û–ô–¢–ò –í –ò–ì–†–£
        </button>
    </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
<div id="main-content">
    <nav>
        <button class="nav-btn active" onclick="switchTab('home')">üè† –ì–õ–ê–í–ù–ê–Ø</button>
        <button class="nav-btn" onclick="switchTab('shooter')">üî´ CS 1.6 –®–£–¢–ï–†</button>
        <button class="nav-btn" onclick="switchTab('family')">üè† –§–≠–ú–ò–õ–ò –•–ê–ë</button>
        <button class="nav-btn" onclick="switchTab('shop')">üõí –ú–ê–ì–ê–ó–ò–ù</button>
        <button class="nav-btn" onclick="switchTab('chat')">üí¨ –ß–ê–¢</button>
        <button class="nav-btn" onclick="switchTab('exit')">üö™ –í–´–•–û–î</button>
    </nav>

    <!-- –ì–ª–∞–≤–Ω–∞—è -->
    <section id="home" class="section active">
        <div style="padding: 20px; height: 100%;">
            <div class="hub-card" style="text-align: center;">
                <h1 style="color:var(--p); font-size: 32px;">ULTRA HUB</h1>
                <p style="color:var(--s); margin: 10px 0;">CS 1.6 –®—É—Ç–µ—Ä & –§—ç–º–∏–ª–∏ –•–∞–± –ú–∞–π–Ω–µ—Ä</p>
                
                <div id="clock" style="font-size: 48px; color: gold; margin: 20px 0;"></div>
                <p id="user-tag" style="font-size: 20px; margin: 10px 0;"></p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                    <div class="card">
                        <h3>üí∞ –®–£–¢–ï–† COINS</h3>
                        <p style="font-size: 2rem; color: gold;" id="shooter-coins">0</p>
                    </div>
                    <div class="card">
                        <h3>üíé HUB COINS</h3>
                        <p style="font-size: 2rem; color: #00ff00;" id="hub-coins">0</p>
                    </div>
                    <div class="card">
                        <h3>üéØ –£–ë–ò–ô–°–¢–í–ê</h3>
                        <p style="font-size: 2rem; color: var(--p);" id="total-kills">0</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- –®–£–¢–ï–† -->
    <section id="shooter" class="section">
        <div id="game-container">
            <canvas id="game-canvas"></canvas>
            
            <div id="game-ui">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="game-stats">
                    <div class="stat-row">
                        <span>üë§ –ò–≥—Ä–æ–∫:</span>
                        <span id="game-player">-</span>
                    </div>
                    <div class="stat-row">
                        <span>üéØ –£–±–∏–π—Å—Ç–≤–∞:</span>
                        <span id="game-kills" style="color:#00ff00">0</span>
                    </div>
                    <div class="stat-row">
                        <span>üíÄ –°–º–µ—Ä—Ç–∏:</span>
                        <span id="game-deaths" style="color:#ff0000">0</span>
                    </div>
                    <div class="stat-row">
                        <span>üí∞ COINS:</span>
                        <span id="game-coins" style="color:gold">0</span>
                    </div>
                    <div style="margin: 10px 0;">‚ù§Ô∏è –ó–î–û–†–û–í–¨–ï:</div>
                    <div class="health-bar">
                        <div class="health-fill" id="health-fill" style="width:100%"></div>
                    </div>
                </div>
                
                <!-- HUD –æ—Ä—É–∂–∏—è -->
                <div class="weapon-hud">
                    <div class="weapon-name" id="weapon-name">AK-47</div>
                    <div class="ammo-counter" id="ammo-counter">30/90</div>
                    <div style="font-size:12px; color:#aaa;">–ù–∞–∂–º–∏—Ç–µ 1-3 –¥–ª—è —Å–º–µ–Ω—ã –æ—Ä—É–∂–∏—è</div>
                </div>
                
                <!-- –ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤ -->
                <div id="skin-shop" class="skin-shop">
                    <h3 style="color:var(--s); margin-bottom: 15px;">üé® –ú–ê–ì–ê–ó–ò–ù –°–ö–ò–ù–û–í</h3>
                    <div class="skin-grid" id="skin-grid">
                        <!-- –°–∫–∏–Ω—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                    <button class="auth-btn" onclick="toggleSkinShop()" style="margin-top: 15px; background: #666;">
                        ‚úñ –ó–ê–ö–†–´–¢–¨
                    </button>
                </div>
                
                <!-- –ö–µ–π—Å—ã -->
                <div id="case-container" class="case-container">
                    <h2 style="color:gold; text-align: center;">üéÅ –ö–ï–ô–°–´</h2>
                    <div class="case-grid" id="case-grid">
                        <!-- –ö–µ–π—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                    <button class="auth-btn" onclick="toggleCaseContainer()" style="background: #666; margin-top: 20px;">
                        ‚úñ –ó–ê–ö–†–´–¢–¨
                    </button>
                </div>
                
                <!-- –ú–µ–Ω—é –∏–≥—Ä—ã -->
                <div id="game-menu" class="game-menu">
                    <h2 class="menu-title">üéÆ –ú–ï–ù–Æ –ò–ì–†–´</h2>
                    
                    <div style="margin: 25px 0;">
                        <button class="auth-btn" onclick="startGameMode('deathmatch')" style="margin: 10px 0;">
                            ‚öîÔ∏è –°–ú–ï–†–¢–ï–õ–¨–ù–ê–Ø –°–•–í–ê–¢–ö–ê
                        </button>
                        
                        <button class="auth-btn" onclick="startGameMode('team')" style="margin: 10px 0; background: var(--s);">
                            üë• –ö–û–ú–ê–ù–î–ù–´–ô –ë–û–ô
                        </button>
                        
                        <button class="auth-btn" onclick="toggleSkinShop()" style="margin: 10px 0; background: #ff9800;">
                            üé® –ú–ê–ì–ê–ó–ò–ù –°–ö–ò–ù–û–í
                        </button>
                        
                        <button class="auth-btn" onclick="toggleCaseContainer()" style="margin: 10px 0; background: gold; color: black;">
                            üéÅ –û–¢–ö–†–´–¢–¨ –ö–ï–ô–°
                        </button>
                        
                        <select id="bot-difficulty" class="auth-input" style="margin: 15px 0;">
                            <option value="easy">ü§ñ –õ–ï–ì–ö–ò–ï –ë–û–¢–´</option>
                            <option value="medium">ü§ñü§ñ –°–†–ï–î–ù–ò–ï –ë–û–¢–´</option>
                            <option value="hard">ü§ñü§ñü§ñ –°–õ–û–ñ–ù–´–ï –ë–û–¢–´</option>
                        </select>
                        
                        <button class="auth-btn" onclick="toggleGameMenu()" style="margin-top: 20px; background: #666;">
                            ‚úñ –í–ï–†–ù–£–¢–¨–°–Ø –í –ò–ì–†–£
                        </button>
                    </div>
                </div>
                
                <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                <div class="mobile-controls">
                    <div class="joystick-area">
                        <div class="joystick" id="joystick"></div>
                    </div>
                    
                    <div class="mobile-buttons">
                        <button class="mobile-btn" onclick="mobileAction('jump')">‚Üë</button>
                        <button class="mobile-btn" onclick="mobileAction('shoot')">üî´</button>
                        <button class="mobile-btn" onclick="mobileAction('reload')">üîÑ</button>
                        <button class="mobile-btn" onclick="toggleGameMenu()">‚öôÔ∏è</button>
                        <button class="mobile-btn" onclick="switchWeapon(1)">1</button>
                        <button class="mobile-btn" onclick="switchWeapon(2)">2</button>
                        <button class="mobile-btn" onclick="switchWeapon(3)">3</button>
                    </div>
                </div>
                
                <!-- –≠—Ñ—Ñ–µ–∫—Ç—ã -->
                <div class="damage-effect" id="damage-effect"></div>
                <div class="hit-marker" id="hit-marker">‚úñ</div>
            </div>
        </div>
    </section>

    <!-- –§–≠–ú–ò–õ–ò –•–ê–ë -->
    <section id="family" class="section">
        <div style="padding: 20px; height: 100%; overflow-y: auto;">
            <div class="hub-card">
                <h2 class="hub-title">üè† –§–≠–ú–ò–õ–ò –•–ê–ë –ú–ê–ô–ù–ï–†</h2>
                
                <div class="currency-display">
                    üíé <span id="hub-balance">0</span> HUB COINS
                </div>
                
                <div style="text-align: center;">
                    <div class="clicker-core" onclick="clickHub()" id="hub-core">
                        –ö–õ–ò–ö–ê–ô!
                    </div>
                    <p style="margin: 10px 0; color: #aaa;">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="hub-multiplier">1x</span></p>
                </div>
                
                <div class="upgrade-grid">
                    <div class="upgrade-item" onclick="buyUpgrade('click')">
                        <h4>üí™ –°–ò–õ–ê –ö–õ–ò–ö–ê</h4>
                        <p>+10 –∑–∞ –∫–ª–∏–∫</p>
                        <p style="color:gold;">–¶–µ–Ω–∞: 100</p>
                    </div>
                    <div class="upgrade-item" onclick="buyUpgrade('auto')">
                        <h4>‚ö° –ê–í–¢–û–ö–õ–ò–ö–ï–†</h4>
                        <p>+5 –≤ —Å–µ–∫—É–Ω–¥—É</p>
                        <p style="color:gold;">–¶–µ–Ω–∞: 500</p>
                    </div>
                    <div class="upgrade-item" onclick="buyUpgrade('multiplier')">
                        <h4>üöÄ –ú–ù–û–ñ–ò–¢–ï–õ–¨</h4>
                        <p>+0.2x –∫–æ –≤—Å–µ–º—É</p>
                        <p style="color:gold;">–¶–µ–Ω–∞: 1000</p>
                    </div>
                </div>
            </div>
            
            <div class="hub-card">
                <h3 class="hub-title">ü•ö –Ø–ô–¶–ê</h3>
                <div class="egg-grid">
                    <div class="egg-item common" onclick="buyEgg('common')">
                        <div style="font-size: 40px;">ü•ö</div>
                        <h4>–û–±—ã—á–Ω–æ–µ</h4>
                        <p style="color:gold;">100 HUB COINS</p>
                    </div>
                    <div class="egg-item rare" onclick="buyEgg('rare')">
                        <div style="font-size: 40px;">üîµ</div>
                        <h4>–†–µ–¥–∫–æ–µ</h4>
                        <p style="color:gold;">500 HUB COINS</p>
                    </div>
                    <div class="egg-item epic" onclick="buyEgg('epic')">
                        <div style="font-size: 40px;">üü£</div>
                        <h4>–≠–ø–∏—á–µ—Å–∫–æ–µ</h4>
                        <p style="color:gold;">2000 HUB COINS</p>
                    </div>
                    <div class="egg-item legendary" onclick="buyEgg('legendary')">
                        <div style="font-size: 40px;">‚≠ê</div>
                        <h4>–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ</h4>
                        <p style="color:gold;">10000 HUB COINS</p>
                    </div>
                </div>
            </div>
            
            <div class="hub-card">
                <h3 class="hub-title">üé™ –ü–ò–¢–û–ú–¶–´</h3>
                <div id="pets-container" style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px;">
                    <!-- –ü–∏—Ç–æ–º—Ü—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>
    </section>

    <!-- –ú–ê–ì–ê–ó–ò–ù -->
    <section id="shop" class="section">
        <div style="padding: 20px; height: 100%; overflow-y: auto;">
            <div class="hub-card">
                <h2 class="hub-title">üõí –û–ë–ú–ï–ù –í–ê–õ–Æ–¢–´</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="card" style="text-align: center;">
                        <h3>üíé HUB ‚Üí üî´ SHU</h3>
                        <p style="margin: 15px 0;">100 HUB = 1 SHU</p>
                        <input type="number" id="hub-to-shu" value="1000" style="width:100%; padding:10px; margin:10px 0; border-radius:10px; border:2px solid var(--p); background:rgba(255,255,255,0.1); color:white;">
                        <button class="auth-btn" onclick="convertHubToShu()" style="background:var(--p);">
                            –û–ë–ú–ï–ù–Ø–¢–¨
                        </button>
                        <p id="hub-to-shu-result" style="margin-top:10px;"></p>
                    </div>
                    <div class="card" style="text-align: center;">
                        <h3>üî´ SHU ‚Üí üíé HUB</h3>
                        <p style="margin: 15px 0;">1 SHU = 80 HUB</p>
                        <input type="number" id="shu-to-hub" value="100" style="width:100%; padding:10px; margin:10px 0; border-radius:10px; border:2px solid var(--p); background:rgba(255,255,255,0.1); color:white;">
                        <button class="auth-btn" onclick="convertShuToHub()" style="background:gold;">
                            –û–ë–ú–ï–ù–Ø–¢–¨
                        </button>
                        <p id="shu-to-hub-result" style="margin-top:10px;"></p>
                    </div>
                </div>
            </div>
            
            <div class="hub-card">
                <h2 class="hub-title">üèÜ –õ–ò–î–ï–†–ë–û–†–î</h2>
                <div id="leaderboard" style="margin-top: 20px;">
                    <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
            
            <div class="hub-card">
                <h2 class="hub-title">üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h2>
                <div id="user-stats" style="margin-top: 15px;">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>
    </section>

    <!-- –ß–ê–¢ -->
    <section id="chat" class="section">
        <div style="padding: 20px; height: 100%;">
            <div class="hub-card" style="height: 100%; display: flex; flex-direction: column;">
                <h2 class="hub-title">üí¨ –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ß–ê–¢</h2>
                <div id="chat-container" style="flex: 1; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin: 15px 0; backdrop-filter: blur(5px);"></div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chat-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex: 1; padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; border: 2px solid var(--p);">
                    <button class="auth-btn" onclick="sendChat()" style="width: auto; padding: 12px 25px;">üì®</button>
                </div>
            </div>
        </div>
    </section>

    <!-- –í–´–•–û–î -->
    <section id="exit" class="section">
        <div style="padding: 20px;">
            <div class="hub-card">
                <h2 style="text-align: center; color: var(--p);">üö™ –í–´–•–û–î</h2>
                
                <button class="auth-btn" onclick="logout()" style="margin: 15px 0;">
                    üîì –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                </button>
                
                <button class="auth-btn" onclick="backupData()" style="margin: 15px 0; background: #2196F3;">
                    üíæ –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                </button>
                
                <button class="auth-btn" onclick="resetData()" style="margin: 15px 0; background: #f44336;">
                    üí£ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                </button>
                
                <div id="backup-status" style="margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.5); border-radius: 10px; display: none;"></div>
            </div>
        </div>
    </section>
</div>

<script>
// ====================
// –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –î–ê–ù–ù–´–ï
// ====================
let currentUser = "";
let isMobile = false;
let gameActive = false;
let currentWeapon = 'ak47';
let weapons = {
    'ak47': { name: 'AK-47', damage: 34, ammo: 30, maxAmmo: 90, fireRate: 600 },
    'awp': { name: 'AWP', damage: 100, ammo: 10, maxAmmo: 30, fireRate: 1500 },
    'knife': { name: '–ù–æ–∂', damage: 50, ammo: 999, maxAmmo: 999, fireRate: 800 }
};
let kills = 0;
let deaths = 0;
let health = 100;
let maxHealth = 100;
let shooterCoins = 0;
let hubCoins = 1000;
let skinEquipped = 'default';
let lastShotTime = 0;

// Three.js –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let scene, camera, renderer;
let player, enemies = [];
let walls = [];
let bullets = [];
let props = [];

// –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
let gameData = JSON.parse(localStorage.getItem('ultra_hub_data')) || {
    users: {
        "–ù–∏–∫–∏—Ç–∞": { 
            shooterCoins: 5000, 
            hubCoins: 10000, 
            kills: 0, 
            deaths: 0,
            skins: ['default'],
            equippedSkin: 'default',
            hubUpgrades: { click: 1, auto: 0, multiplier: 1 },
            hubPets: [],
            hubLevel: 1
        },
        "–ê–ª–µ–Ω–∞": { 
            shooterCoins: 3000, 
            hubCoins: 5000, 
            kills: 0, 
            deaths: 0,
            skins: ['default'],
            equippedSkin: 'default',
            hubUpgrades: { click: 1, auto: 0, multiplier: 1 },
            hubPets: [],
            hubLevel: 1
        }
    },
    skins: [
        { id: 'default', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π', color: '#00ff00', price: 0 },
        { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', color: 'gold', price: 1000 },
        { id: 'neon', name: '–ù–µ–æ–Ω–æ–≤—ã–π', color: '#ff00ff', price: 2000 },
        { id: 'cyber', name: '–ö–∏–±–µ—Ä', color: '#00f2ff', price: 3000 },
        { id: 'blood', name: '–ö—Ä–æ–≤–∞–≤—ã–π', color: '#ff0000', price: 5000 }
    ],
    cases: [
        { id: 'common', name: '–û–±—ã—á–Ω—ã–π –∫–µ–π—Å', price: 100, items: ['skin1', 'coin100'] },
        { id: 'rare', name: '–†–µ–¥–∫–∏–π –∫–µ–π—Å', price: 500, items: ['skin2', 'coin500'] },
        { id: 'legendary', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–µ–π—Å', price: 2000, items: ['skin3', 'coin2000'] }
    ],
    chat: []
};

// –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
let userData = gameData.users[currentUser] || {};

// ====================
// –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
// ====================
function login() {
    const user = document.getElementById('user-select').value;
    const password = document.getElementById('password-input').value;
    
    if (!password) {
        alert("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å!");
        return;
    }
    
    currentUser = user;
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
    isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –Ω–µ—Ç
    if (!gameData.users[user]) {
        gameData.users[user] = {
            shooterCoins: 1000,
            hubCoins: 5000,
            kills: 0,
            deaths: 0,
            skins: ['default'],
            equippedSkin: 'default',
            hubUpgrades: { click: 1, auto: 0, multiplier: 1 },
            hubPets: [],
            hubLevel: 1
        };
    }
    
    userData = gameData.users[user];
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    document.getElementById('auth-overlay').style.display = 'none';
    document.getElementById('main-content').style.display = 'flex';
    document.getElementById('user-tag').textContent = `üë§ ${user} | –£–±–∏–π—Å—Ç–≤: ${userData.kills} | –£—Ä–æ–≤–µ–Ω—å: ${userData.hubLevel}`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    updateUI();
    loadChat();
    startClock();
    updateShop();
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º
    saveGameData();
    
    alert(`üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user}!`);
}

// ====================
// 3D –®–£–¢–ï–†
// ====================
function initShooter() {
    const canvas = document.getElementById('game-canvas');
    
    // –°—Ü–µ–Ω–∞
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0a0a1a);
    scene.fog = new THREE.Fog(0x0a0a1a, 1, 150);
    
    // –ö–∞–º–µ—Ä–∞
    camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
    camera.position.set(0, 2, 10);
    
    // –†–µ–Ω–¥–µ—Ä–µ—Ä
    renderer = new THREE.WebGLRenderer({ 
        canvas, 
        antialias: true,
        powerPreference: "high-performance"
    });
    renderer.setSize(canvas.clientWidth, canvas.clientHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    
    // –û—Å–≤–µ—â–µ–Ω–∏–µ
    const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(20, 30, 20);
    directionalLight.castShadow = true;
    directionalLight.shadow.camera.left = -50;
    directionalLight.shadow.camera.right = 50;
    directionalLight.shadow.camera.top = 50;
    directionalLight.shadow.camera.bottom = -50;
    scene.add(directionalLight);
    
    // –ü–æ–ª
    const floorGeometry = new THREE.PlaneGeometry(100, 100);
    const floorTexture = createGridTexture();
    const floorMaterial = new THREE.MeshPhongMaterial({ 
        map: floorTexture,
        color: 0x2a2a2a 
    });
    const floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);
    
    // –ù–µ–±–æ
    const skyGeometry = new THREE.SphereGeometry(500, 32, 32);
    const skyMaterial = new THREE.MeshBasicMaterial({ 
        color: 0x000022,
        side: THREE.BackSide
    });
    const sky = new THREE.Mesh(skyGeometry, skyMaterial);
    scene.add(sky);
    
    // –ò–≥—Ä–æ–∫
    createPlayer();
    
    // –ö–∞—Ä—Ç–∞
    createMap();
    
    // –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫–∏
    for (let i = 0; i < 5; i++) {
        createEnemy();
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
    gameActive = true;
    animate();
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    setupControls();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    updateGameUI();
}

function createGridTexture() {
    const canvas = document.createElement('canvas');
    canvas.width = 512;
    canvas.height = 512;
    const ctx = canvas.getContext('2d');
    
    ctx.fillStyle = '#1a1a1a';
    ctx.fillRect(0, 0, 512, 512);
    
    ctx.strokeStyle = '#333333';
    ctx.lineWidth = 2;
    
    for (let i = 0; i <= 512; i += 32) {
        ctx.beginPath();
        ctx.moveTo(i, 0);
        ctx.lineTo(i, 512);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(0, i);
        ctx.lineTo(512, i);
        ctx.stroke();
    }
    
    const texture = new THREE.CanvasTexture(canvas);
    texture.wrapS = THREE.RepeatWrapping;
    texture.wrapT = THREE.RepeatWrapping;
    texture.repeat.set(10, 10);
    return texture;
}

function createPlayer() {
    // –ì—Ä—É–ø–ø–∞ –¥–ª—è –∏–≥—Ä–æ–∫–∞
    player = new THREE.Group();
    
    // –¢–µ–ª–æ
    const bodyGeometry = new THREE.BoxGeometry(0.6, 1.8, 0.6);
    const bodyMaterial = new THREE.MeshPhongMaterial({ 
        color: getSkinColor(userData.equippedSkin || 'default')
    });
    const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
    body.position.y = 0.9;
    body.castShadow = true;
    player.add(body);
    
    // –ì–æ–ª–æ–≤–∞
    const headGeometry = new THREE.SphereGeometry(0.3);
    const headMaterial = new THREE.MeshPhongMaterial({ 
        color: getSkinColor(userData.equippedSkin || 'default')
    });
    const head = new THREE.Mesh(headGeometry, headMaterial);
    head.position.y = 1.8;
    head.castShadow = true;
    player.add(head);
    
    player.position.set(0, 0, 0);
    scene.add(player);
}

function createEnemy() {
    const enemy = new THREE.Group();
    
    const bodyGeometry = new THREE.BoxGeometry(0.6, 1.8, 0.6);
    const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000 });
    const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
    body.position.y = 0.9;
    body.castShadow = true;
    enemy.add(body);
    
    const headGeometry = new THREE.SphereGeometry(0.3);
    const headMaterial = new THREE.MeshPhongMaterial({ color: 0xaa0000 });
    const head = new THREE.Mesh(headGeometry, headMaterial);
    head.position.y = 1.8;
    head.castShadow = true;
    enemy.add(head);
    
    // –ü–æ–∑–∏—Ü–∏—è
    const angle = Math.random() * Math.PI * 2;
    const distance = 15 + Math.random() * 20;
    enemy.position.set(
        Math.cos(angle) * distance,
        0,
        Math.sin(angle) * distance
    );
    
    enemy.userData = {
        health: 100,
        type: 'enemy',
        speed: 0.03,
        lastShot: 0
    };
    
    enemies.push(enemy);
    scene.add(enemy);
    return enemy;
}

function createMap() {
    const wallMaterial = new THREE.MeshPhongMaterial({ color: 0x444444 });
    
    // –í–Ω–µ—à–Ω–∏–µ —Å—Ç–µ–Ω—ã
    const wallPositions = [
        { x: 0, z: -25, width: 50, height: 4, depth: 1 },
        { x: 0, z: 25, width: 50, height: 4, depth: 1 },
        { x: -25, z: 0, width: 1, height: 4, depth: 50 },
        { x: 25, z: 0, width: 1, height: 4, depth: 50 }
    ];
    
    wallPositions.forEach(pos => {
        const geometry = new THREE.BoxGeometry(pos.width, pos.height, pos.depth);
        const wall = new THREE.Mesh(geometry, wallMaterial);
        wall.position.set(pos.x, pos.height/2, pos.z);
        wall.castShadow = true;
        wall.receiveShadow = true;
        walls.push(wall);
        scene.add(wall);
    });
    
    // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
    for (let i = 0; i < 20; i++) {
        const size = 2 + Math.random() * 3;
        const geometry = new THREE.BoxGeometry(size, size, size);
        const obstacle = new THREE.Mesh(geometry, wallMaterial);
        obstacle.position.set(
            (Math.random() - 0.5) * 40,
            size / 2,
            (Math.random() - 0.5) * 40
        );
        obstacle.castShadow = true;
        obstacle.receiveShadow = true;
        props.push(obstacle);
        scene.add(obstacle);
    }
    
    // –Ø—â–∏–∫–∏ (–∫–∞–∫ –≤ CS)
    for (let i = 0; i < 15; i++) {
        const geometry = new THREE.BoxGeometry(2, 2, 2);
        const boxMaterial = new THREE.MeshPhongMaterial({ 
            color: Math.random() > 0.5 ? 0x8B4513 : 0xA0522D 
        });
        const box = new THREE.Mesh(geometry, boxMaterial);
        box.position.set(
            (Math.random() - 0.5) * 35,
            1,
            (Math.random() - 0.5) * 35
        );
        box.castShadow = true;
        box.receiveShadow = true;
        props.push(box);
        scene.add(box);
    }
}

function animate() {
    if (!gameActive) return;
    
    requestAnimationFrame(animate);
    
    // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
    updatePlayerMovement();
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
    updateEnemies();
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å
    updateBullets();
    
    // –ö–∞–º–µ—Ä–∞
    updateCamera();
    
    renderer.render(scene, camera);
}

function updatePlayerMovement() {
    const speed = 0.15;
    const moveX = (keys['d'] ? 1 : 0) - (keys['a'] ? 1 : 0);
    const moveZ = (keys['s'] ? 1 : 0) - (keys['w'] ? 1 : 0);
    
    if (moveX !== 0 || moveZ !== 0) {
        const angle = Math.atan2(moveZ, moveX);
        player.position.x += Math.cos(angle) * speed;
        player.position.z += Math.sin(angle) * speed;
        
        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
        const bounds = 23;
        player.position.x = Math.max(-bounds, Math.min(bounds, player.position.x));
        player.position.z = Math.max(-bounds, Math.min(bounds, player.position.z));
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
        checkCollisions();
    }
}

function updateEnemies() {
    enemies.forEach((enemy, index) => {
        if (!enemy.userData || enemy.userData.health <= 0) return;
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –∫ –∏–≥—Ä–æ–∫—É
        const dx = player.position.x - enemy.position.x;
        const dz = player.position.z - enemy.position.z;
        const distance = Math.sqrt(dx * dx + dz * dz);
        
        if (distance > 3) {
            const angle = Math.atan2(dz, dx);
            enemy.position.x += Math.cos(angle) * enemy.userData.speed;
            enemy.position.z += Math.sin(angle) * enemy.userData.speed;
            
            // –ü–æ–≤–æ—Ä–æ—Ç –∫ –∏–≥—Ä–æ–∫—É
            enemy.rotation.y = -angle + Math.PI/2;
        }
        
        // –°—Ç—Ä–µ–ª—å–±–∞
        const now = Date.now();
        if (distance < 15 && now - enemy.userData.lastShot > 1500) {
            enemyShoot(enemy);
            enemy.userData.lastShot = now;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ—Ä—Ç–∏
        if (enemy.userData.health <= 0) {
            enemyDeath(enemy, index);
        }
    });
}

function enemyShoot(enemy) {
    const bulletGeometry = new THREE.SphereGeometry(0.1);
    const bulletMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
    const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);
    
    const direction = new THREE.Vector3();
    direction.subVectors(player.position, enemy.position).normalize();
    
    bullet.position.copy(enemy.position);
    bullet.position.y += 1.5;
    
    bullet.userData = {
        velocity: direction.multiplyScalar(0.7),
        damage: 15,
        owner: 'enemy'
    };
    
    bullets.push(bullet);
    scene.add(bullet);
}

function enemyDeath(enemy, index) {
    // –ù–∞–≥—Ä–∞–¥–∞
    kills++;
    shooterCoins += 100;
    userData.kills++;
    userData.shooterCoins += 100;
    
    // –≠—Ñ—Ñ–µ–∫—Ç
    showDeathEffect(enemy.position);
    
    // –£–¥–∞–ª–µ–Ω–∏–µ
    scene.remove(enemy);
    enemies.splice(index, 1);
    
    // –ù–æ–≤—ã–π –≤—Ä–∞–≥ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        if (enemies.length < 10) {
            createEnemy();
        }
    }, 2000);
    
    updateGameUI();
    saveGameData();
}

function shoot() {
    const weapon = weapons[currentWeapon];
    const now = Date.now();
    
    if (now - lastShotTime < weapon.fireRate) return;
    if (weapon.ammo <= 0) {
        playSound('empty');
        return;
    }
    
    weapon.ammo--;
    lastShotTime = now;
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–ª–∏
    const bulletGeometry = new THREE.SphereGeometry(0.1);
    const bulletMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
    const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);
    
    const direction = new THREE.Vector3();
    camera.getWorldDirection(direction);
    
    bullet.position.copy(camera.position);
    bullet.position.y -= 0.5;
    
    bullet.userData = {
        velocity: direction.multiplyScalar(1.2),
        damage: weapon.damage,
        owner: 'player'
    };
    
    bullets.push(bullet);
    scene.add(bullet);
    
    // –≠—Ñ—Ñ–µ–∫—Ç
    playSound('shoot');
    showMuzzleFlash();
    
    updateGameUI();
}

function updateBullets() {
    for (let i = bullets.length - 1; i >= 0; i--) {
        const bullet = bullets[i];
        bullet.position.add(bullet.userData.velocity);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è
        let hit = false;
        
        // –í –∏–≥—Ä–æ–∫–∞ (–æ—Ç –≤—Ä–∞–≥–æ–≤)
        if (bullet.userData.owner === 'enemy') {
            const distance = bullet.position.distanceTo(player.position);
            if (distance < 1) {
                takeDamage(bullet.userData.damage);
                hit = true;
            }
        }
        
        // –í–æ –≤—Ä–∞–≥–æ–≤
        if (bullet.userData.owner === 'player') {
            enemies.forEach((enemy, enemyIndex) => {
                const distance = bullet.position.distanceTo(enemy.position);
                if (distance < 1 && enemy.userData.health > 0) {
                    enemy.userData.health -= bullet.userData.damage;
                    showHitMarker();
                    
                    if (enemy.userData.health <= 0) {
                        enemyDeath(enemy, enemyIndex);
                    }
                    hit = true;
                }
            });
        }
        
        // –í —Å—Ç–µ–Ω—ã
        walls.forEach(wall => {
            const distance = bullet.position.distanceTo(wall.position);
            if (distance < 3) {
                hit = true;
            }
        });
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –∏–ª–∏ –¥–∞–ª–µ–∫–æ
        if (hit || bullet.position.distanceTo(player.position) > 100) {
            scene.remove(bullet);
            bullets.splice(i, 1);
        }
    }
}

function takeDamage(amount) {
    health -= amount;
    if (health < 0) health = 0;
    
    // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è
    showDamageEffect();
    playSound('hurt');
    
    if (health <= 0) {
        playerDeath();
    }
    
    updateGameUI();
}

function playerDeath() {
    deaths++;
    userData.deaths++;
    
    alert('üíÄ –í–´ –£–ú–ï–†–õ–ò! –ù–∞–∂–º–∏—Ç–µ OK –¥–ª—è –≤–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è.');
    
    // –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ
    health = maxHealth;
    player.position.set(0, 0, 0);
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    updateGameUI();
    saveGameData();
}

function updateCamera() {
    camera.position.x = player.position.x;
    camera.position.y = player.position.y + 2;
    camera.position.z = player.position.z + 3;
    camera.lookAt(player.position.x, player.position.y + 1, player.position.z);
}

function checkCollisions() {
    const playerBox = new THREE.Box3().setFromObject(player);
    
    walls.forEach(wall => {
        const wallBox = new THREE.Box3().setFromObject(wall);
        if (playerBox.intersectsBox(wallBox)) {
            // –û—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ
            const dx = player.position.x - wall.position.x;
            const dz = player.position.z - wall.position.z;
            player.position.x += dx * 0.1;
            player.position.z += dz * 0.1;
        }
    });
}

// ====================
// –≠–§–§–ï–ö–¢–´ –ò –ê–ù–ò–ú–ê–¶–ò–ò
// ====================
function showMuzzleFlash() {
    const flash = document.createElement('div');
    flash.style.position = 'absolute';
    flash.style.top = '50%';
    flash.style.left = '50%';
    flash.style.width = '20px';
    flash.style.height = '20px';
    flash.style.background = 'radial-gradient(circle, yellow 0%, orange 50%, transparent 100%)';
    flash.style.borderRadius = '50%';
    flash.style.transform = 'translate(-50%, -50%)';
    flash.style.pointerEvents = 'none';
    flash.style.zIndex = '3';
    
    document.getElementById('game-ui').appendChild(flash);
    
    setTimeout(() => {
        if (flash.parentNode) flash.parentNode.removeChild(flash);
    }, 100);
}

function showHitMarker() {
    const marker = document.getElementById('hit-marker');
    marker.style.opacity = '1';
    marker.style.transform = 'translate(-50%, -50%) scale(1.5)';
    
    setTimeout(() => {
        marker.style.opacity = '0';
        marker.style.transform = 'translate(-50%, -50%) scale(1)';
    }, 200);
}

function showDamageEffect() {
    const effect = document.getElementById('damage-effect');
    effect.style.background = 'radial-gradient(circle, rgba(255,0,0,0.3) 0%, transparent 70%)';
    effect.style.opacity = '0.7';
    
    setTimeout(() => {
        effect.style.opacity = '0';
    }, 300);
}

function showDeathEffect(position) {
    const particles = 10;
    for (let i = 0; i < particles; i++) {
        const geometry = new THREE.SphereGeometry(0.1);
        const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
        const particle = new THREE.Mesh(geometry, material);
        
        particle.position.copy(position);
        particle.position.y += 1;
        
        particle.userData = {
            velocity: new THREE.Vector3(
                (Math.random() - 0.5) * 0.5,
                Math.random() * 0.5,
                (Math.random() - 0.5) * 0.5
            ),
            life: 1.0
        };
        
        scene.add(particle);
        
        // –ê–Ω–∏–º–∞—Ü–∏—è
        const animateParticle = () => {
            if (particle.userData.life > 0) {
                particle.position.add(particle.userData.velocity);
                particle.userData.life -= 0.02;
                particle.material.opacity = particle.userData.life;
                requestAnimationFrame(animateParticle);
            } else {
                scene.remove(particle);
            }
        };
        animateParticle();
    }
}

function playSound(type) {
    // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–æ–≤ —á–µ—Ä–µ–∑ Web Audio API
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        let frequency = 440;
        let duration = 0.1;
        
        switch(type) {
            case 'shoot':
                frequency = 800;
                duration = 0.05;
                break;
            case 'hurt':
                frequency = 200;
                duration = 0.3;
                break;
            case 'empty':
                frequency = 150;
                duration = 0.2;
                break;
        }
        
        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
        
        oscillator.start();
        oscillator.stop(audioContext.currentTime + duration);
    } catch (e) {
        console.log("–ê—É–¥–∏–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");
    }
}

// ====================
// –£–ü–†–ê–í–õ–ï–ù–ò–ï
// ====================
let keys = {};

function setupControls() {
    // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
    window.addEventListener('keydown', (e) => {
        const key = e.key.toLowerCase();
        keys[key] = true;
        
        switch(key) {
            case 'f':
            case ' ':
                shoot();
                break;
            case 'r':
                reloadWeapon();
                break;
            case 'escape':
                toggleGameMenu();
                break;
            case '1':
                switchWeapon('ak47');
                break;
            case '2':
                switchWeapon('awp');
                break;
            case '3':
                switchWeapon('knife');
                break;
            case 'b':
                toggleSkinShop();
                break;
            case 'n':
                toggleCaseContainer();
                break;
        }
    });
    
    window.addEventListener('keyup', (e) => {
        keys[e.key.toLowerCase()] = false;
    });
    
    // –ú—ã—à—å
    const canvas = document.getElementById('game-canvas');
    canvas.addEventListener('click', () => {
        if (document.pointerLockElement === canvas) {
            shoot();
        }
    });
    
    canvas.addEventListener('mousedown', () => {
        canvas.requestPointerLock();
    });
    
    // –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    if (isMobile) {
        setupMobileControls();
    }
}

function setupMobileControls() {
    const joystick = document.getElementById('joystick');
    const area = document.querySelector('.joystick-area');
    let dragging = false;
    let touchId = null;
    
    area.addEventListener('touchstart', (e) => {
        if (dragging) return;
        dragging = true;
        touchId = e.touches[0].identifier;
        e.preventDefault();
    });
    
    document.addEventListener('touchmove', (e) => {
        if (!dragging) return;
        
        const touch = Array.from(e.touches).find(t => t.identifier === touchId);
        if (!touch) return;
        
        const rect = area.getBoundingClientRect();
        const x = touch.clientX - rect.left - rect.width / 2;
        const y = touch.clientY - rect.top - rect.height / 2;
        
        const distance = Math.sqrt(x * x + y * y);
        const maxDistance = rect.width / 2 - 25;
        
        if (distance > maxDistance) {
            const angle = Math.atan2(y, x);
            joystick.style.transform = `translate(${Math.cos(angle) * maxDistance}px, ${Math.sin(angle) * maxDistance}px)`;
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–µ–º
            keys['w'] = y < -maxDistance/2;
            keys['s'] = y > maxDistance/2;
            keys['a'] = x < -maxDistance/2;
            keys['d'] = x > maxDistance/2;
        } else {
            joystick.style.transform = `translate(${x}px, ${y}px)`;
            
            // –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            keys['w'] = y < -10;
            keys['s'] = y > 10;
            keys['a'] = x < -10;
            keys['d'] = x > 10;
        }
    });
    
    document.addEventListener('touchend', (e) => {
        if (!dragging) return;
        
        const touch = Array.from(e.changedTouches).find(t => t.identifier === touchId);
        if (touch) {
            dragging = false;
            touchId = null;
            joystick.style.transform = 'translate(0, 0)';
            keys['w'] = keys['s'] = keys['a'] = keys['d'] = false;
        }
    });
}

function mobileAction(action) {
    switch(action) {
        case 'jump':
            // –ü—Ä—ã–∂–æ–∫
            break;
        case 'shoot':
            shoot();
            break;
        case 'reload':
            reloadWeapon();
            break;
    }
}

// ====================
// –û–†–£–ñ–ò–ï
// ====================
function switchWeapon(weaponId) {
    currentWeapon = weaponId;
    updateGameUI();
    playSound('shoot');
}

function reloadWeapon() {
    const weapon = weapons[currentWeapon];
    if (weapon.ammo < weapon.maxAmmo) {
        weapon.ammo = weapon.maxAmmo;
        updateGameUI();
        playSound('shoot');
    }
}

// ====================
# –ò–ì–†–û–í–û–ô UI
# ====================
function updateGameUI() {
    const weapon = weapons[currentWeapon];
    
    document.getElementById('game-kills').textContent = kills;
    document.getElementById('game-deaths').textContent = deaths;
    document.getElementById('game-coins').textContent = shooterCoins;
    document.getElementById('health-fill').style.width = `${(health/maxHealth)*100}%`;
    document.getElementById('ammo-counter').textContent = `${weapon.ammo}/${weapon.maxAmmo}`;
    document.getElementById('weapon-name').textContent = weapon.name;
}

function updateUI() {
    document.getElementById('shooter-coins').textContent = userData.shooterCoins || 0;
    document.getElementById('hub-coins').textContent = userData.hubCoins || 0;
    document.getElementById('total-kills').textContent = userData.kills || 0;
    document.getElementById('hub-balance').textContent = userData.hubCoins || 0;
    
    // –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è —Ö–∞–±–∞
    const multiplier = userData.hubUpgrades?.multiplier || 1;
    document.getElementById('hub-multiplier').textContent = `${multiplier.toFixed(1)}x`;
}

// ====================
# –ú–ê–ì–ê–ó–ò–ù –°–ö–ò–ù–û–í –ò –ö–ï–ô–°–´
# ====================
function toggleSkinShop() {
    const shop = document.getElementById('skin-shop');
    if (shop.style.display === 'block') {
        shop.style.display = 'none';
    } else {
        loadSkins();
        shop.style.display = 'block';
    }
}

function loadSkins() {
    const grid = document.getElementById('skin-grid');
    grid.innerHTML = '';
    
    gameData.skins.forEach(skin => {
        const owned = userData.skins?.includes(skin.id);
        const equipped = userData.equippedSkin === skin.id;
        
        const skinElement = document.createElement('div');
        skinElement.className = `skin-item ${equipped ? 'equipped' : ''}`;
        skinElement.style.borderColor = skin.color;
        skinElement.innerHTML = `
            <div style="width: 50px; height: 50px; margin: 0 auto; background: ${skin.color}; border-radius: 10px;"></div>
            <h4>${skin.name}</h4>
            ${owned ? 
                `<button onclick="equipSkin('${skin.id}')" style="width:100%; padding:5px; margin-top:5px; background:${equipped ? '#00ff00' : 'var(--p)'};">${equipped ? '‚úÖ' : '–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å'}</button>` :
                `<p style="color:gold;">${skin.price} SHU</p>
                 <button onclick="buySkin('${skin.id}')" style="width:100%; padding:5px; margin-top:5px; background:gold; color:black;">–ö–£–ü–ò–¢–¨</button>`
            }
        `;
        grid.appendChild(skinElement);
    });
}

function buySkin(skinId) {
    const skin = gameData.skins.find(s => s.id === skinId);
    if (!skin) return;
    
    if (userData.shooterCoins < skin.price) {
        alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ SHU! –ù—É–∂–Ω–æ: ${skin.price}`);
        return;
    }
    
    if (confirm(`–ö—É–ø–∏—Ç—å —Å–∫–∏–Ω "${skin.name}" –∑–∞ ${skin.price} SHU?`)) {
        userData.shooterCoins -= skin.price;
        if (!userData.skins) userData.skins = [];
        userData.skins.push(skinId);
        
        updateUI();
        loadSkins();
        saveGameData();
        alert(`üéâ –°–∫–∏–Ω "${skin.name}" –∫—É–ø–ª–µ–Ω!`);
    }
}

function equipSkin(skinId) {
    userData.equippedSkin = skinId;
    loadSkins();
    saveGameData();
    
    // –û–±–Ω–æ–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –≤ –∏–≥—Ä–µ
    if (player) {
        player.traverse(child => {
            if (child.isMesh) {
                child.material.color.set(getSkinColor(skinId));
            }
        });
    }
}

function getSkinColor(skinId) {
    const skin = gameData.skins.find(s => s.id === skinId);
    return skin ? new THREE.Color(skin.color) : new THREE.Color('#00ff00');
}

function toggleCaseContainer() {
    const container = document.getElementById('case-container');
    if (container.style.display === 'block') {
        container.style.display = 'none';
    } else {
        loadCases();
        container.style.display = 'block';
    }
}

function loadCases() {
    const grid = document.getElementById('case-grid');
    grid.innerHTML = '';
    
    gameData.cases.forEach(caseItem => {
        const caseElement = document.createElement('div');
        caseElement.className = `case-item ${caseItem.id === 'legendary' ? 'legendary' : ''}`;
        caseElement.innerHTML = `
            <div style="font-size: 40px;">üéÅ</div>
            <h3>${caseItem.name}</h3>
            <p style="color:gold; font-size: 18px;">${caseItem.price} SHU</p>
            <button onclick="openCase('${caseItem.id}')" style="width:100%; padding:8px; margin-top:10px; background:var(--p); border:none; border-radius:5px; cursor:pointer;">
                –û–¢–ö–†–´–¢–¨
            </button>
        `;
        grid.appendChild(caseElement);
    });
}

function openCase(caseId) {
    const caseItem = gameData.cases.find(c => c.id === caseId);
    if (!caseItem) return;
    
    if (userData.shooterCoins < caseItem.price) {
        alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ SHU! –ù—É–∂–Ω–æ: ${caseItem.price}`);
        return;
    }
    
    if (confirm(`–û—Ç–∫—Ä—ã—Ç—å ${caseItem.name} –∑–∞ ${caseItem.price} SHU?`)) {
        userData.shooterCoins -= caseItem.price;
        
        // –†–∞–Ω–¥–æ–º–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞
        const rewards = [
            { type: 'coins', amount: caseItem.price * 2, name: `üí∞ ${caseItem.price * 2} SHU` },
            { type: 'skin', skin: gameData.skins[Math.floor(Math.random() * gameData.skins.length)], name: `üé® –°–∫–∏–Ω` },
            { type: 'coins', amount: caseItem.price * 5, name: `üí∞ ${caseItem.price * 5} SHU` }
        ];
        
        const reward = rewards[Math.floor(Math.random() * rewards.length)];
        
        if (reward.type === 'coins') {
            userData.shooterCoins += reward.amount;
            alert(`üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏: ${reward.name}`);
        } else if (reward.type === 'skin') {
            if (!userData.skins) userData.skins = [];
            if (!userData.skins.includes(reward.skin.id)) {
                userData.skins.push(reward.skin.id);
                alert(`üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏ —Å–∫–∏–Ω: ${reward.skin.name}`);
            } else {
                userData.shooterCoins += caseItem.price * 3;
                alert(`üéâ –í—ã —É–∂–µ –∏–º–µ–µ—Ç–µ —ç—Ç–æ—Ç —Å–∫–∏–Ω! –ü–æ–ª—É—á–∏–ª–∏ ${caseItem.price * 3} SHU –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ.`);
            }
        }
        
        updateUI();
        saveGameData();
    }
}

// ====================
# –§–≠–ú–ò–õ–ò –•–ê–ë
# ====================
function clickHub() {
    const core = document.getElementById('hub-core');
    const upgrade = userData.hubUpgrades || { click: 1, auto: 0, multiplier: 1 };
    const multiplier = upgrade.multiplier || 1;
    const gain = Math.floor(10 * upgrade.click * multiplier);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è
    core.style.transform = 'scale(0.9)';
    core.style.background = 'radial-gradient(circle, #00ff00 0%, transparent 70%)';
    
    setTimeout(() => {
        core.style.transform = 'scale(1)';
        core.style.background = 'radial-gradient(circle, #00ff00 0%, transparent 70%)';
    }, 100);
    
    // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ
    userData.hubCoins += gain;
    
    // –≠—Ñ—Ñ–µ–∫—Ç
    const effect = document.createElement('div');
    effect.textContent = `+${gain}`;
    effect.style.position = 'absolute';
    effect.style.color = '#00ff00';
    effect.style.fontSize = '24px';
    effect.style.fontWeight = 'bold';
    effect.style.left = '50%';
    effect.style.top = '50%';
    effect.style.transform = 'translate(-50%, -50%)';
    effect.style.pointerEvents = 'none';
    document.getElementById('family-section').appendChild(effect);
    
    setTimeout(() => {
        if (effect.parentNode) effect.parentNode.removeChild(effect);
    }, 1000);
    
    updateUI();
    saveGameData();
}

function buyUpgrade(type) {
    const upgrade = userData.hubUpgrades || { click: 1, auto: 0, multiplier: 1 };
    let price = 0;
    let currentLevel = 0;
    
    switch(type) {
        case 'click':
            currentLevel = upgrade.click || 1;
            price = 100 * Math.pow(2, currentLevel - 1);
            if (userData.hubCoins < price) {
                alert(`–ù—É–∂–Ω–æ ${price} HUB COINS!`);
                return;
            }
            userData.hubCoins -= price;
            upgrade.click = (upgrade.click || 1) + 1;
            break;
            
        case 'auto':
            currentLevel = upgrade.auto || 0;
            price = 500 * Math.pow(2, currentLevel);
            if (userData.hubCoins < price) {
                alert(`–ù—É–∂–Ω–æ ${price} HUB COINS!`);
                return;
            }
            userData.hubCoins -= price;
            upgrade.auto = (upgrade.auto || 0) + 1;
            startAutoClicker();
            break;
            
        case 'multiplier':
            currentLevel = upgrade.multiplier || 1;
            price = 1000 * Math.pow(2, currentLevel - 1);
            if (userData.hubCoins < price) {
                alert(`–ù—É–∂–Ω–æ ${price} HUB COINS!`);
                return;
            }
            userData.hubCoins -= price;
            upgrade.multiplier = (upgrade.multiplier || 1) + 0.2;
            break;
    }
    
    userData.hubUpgrades = upgrade;
    updateUI();
    saveGameData();
    alert(`‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ!`);
}

function startAutoClicker() {
    const upgrade = userData.hubUpgrades || { auto: 0 };
    if (upgrade.auto > 0 && !window.autoClickerInterval) {
        window.autoClickerInterval = setInterval(() => {
            const multiplier = userData.hubUpgrades?.multiplier || 1;
            const gain = Math.floor(5 * upgrade.auto * multiplier);
            userData.hubCoins += gain;
            updateUI();
            saveGameData();
        }, 1000);
    }
}

function buyEgg(type) {
    const prices = {
        common: 100,
        rare: 500,
        epic: 2000,
        legendary: 10000
    };
    
    const price = prices[type];
    if (userData.hubCoins < price) {
        alert(`–ù—É–∂–Ω–æ ${price} HUB COINS!`);
        return;
    }
    
    userData.hubCoins -= price;
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —è–π—Ü–æ
    const pets = [
        { 
            name: "–ö—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π –¥—Ä–∞–∫–æ–Ω", 
            emoji: "üíéüê≤", 
            bonus: "+0.3x –∫ –º–Ω–æ–∂–∏—Ç–µ–ª—é", 
            type: "legendary",
            effect: "multiplier",
            value: 0.3
        },
        { 
            name: "–≠–ª–µ–∫—Ç—Ä–æ –≤–æ–ª–∫", 
            emoji: "‚ö°üê∫", 
            bonus: "+20% –∫ –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä—É", 
            type: "epic",
            effect: "auto",
            value: 0.2
        },
        { 
            name: "–°—Ç–∞–ª—å–Ω–æ–π –æ—Ä—ë–ª", 
            emoji: "ü¶Öüî©", 
            bonus: "+15% –∫ —Å–∏–ª–µ –∫–ª–∏–∫–∞", 
            type: "rare",
            effect: "click",
            value: 0.15
        },
        { 
            name: "–û–≥–Ω–µ–Ω–Ω–∞—è –ª–∏—Å–∞", 
            emoji: "üî•ü¶ä", 
            bonus: "+0.1x –∫ –º–Ω–æ–∂–∏—Ç–µ–ª—é", 
            type: "common",
            effect: "multiplier",
            value: 0.1
        }
    ];
    
    // –®–∞–Ω—Å—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —è–π—Ü–∞
    let chancePool = pets;
    if (type === 'common') chancePool = pets.filter(p => p.type === 'common');
    if (type === 'rare') chancePool = pets.filter(p => p.type === 'common' || p.type === 'rare');
    if (type === 'epic') chancePool = pets.filter(p => p.type !== 'legendary');
    
    const pet = chancePool[Math.floor(Math.random() * chancePool.length)];
    
    if (!userData.hubPets) userData.hubPets = [];
    userData.hubPets.push(pet);
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å
    applyPetBonus(pet);
    
    updateUI();
    saveGameData();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∏—Ç–æ–º—Ü–µ–≤
    showPets();
    
    alert(`üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏: ${pet.emoji} ${pet.name}\n${pet.bonus}`);
}

function applyPetBonus(pet) {
    if (!userData.hubUpgrades) userData.hubUpgrades = { click: 1, auto: 0, multiplier: 1 };
    
    switch(pet.effect) {
        case 'multiplier':
            userData.hubUpgrades.multiplier += pet.value;
            break;
        case 'click':
            userData.hubUpgrades.click += pet.value;
            break;
        case 'auto':
            userData.hubUpgrades.auto += pet.value;
            break;
    }
}

function showPets() {
    const container = document.getElementById('pets-container');
    container.innerHTML = '';
    
    (userData.hubPets || []).forEach((pet, index) => {
        const petElement = document.createElement('div');
        petElement.className = 'card';
        petElement.style = 'min-width: 150px; text-align: center;';
        petElement.innerHTML = `
            <div style="font-size: 40px;">${pet.emoji}</div>
            <h4>${pet.name}</h4>
            <p style="color: #aaa; font-size: 12px;">${pet.bonus}</p>
        `;
        container.appendChild(petElement);
    });
}

// ====================
# –û–ë–ú–ï–ù –í–ê–õ–Æ–¢–´
# ====================
function convertHubToShu() {
    const input = document.getElementById('hub-to-shu');
    const amount = parseInt(input.value) || 0;
    
    if (amount < 100) {
        alert("–ú–∏–Ω–∏–º—É–º 100 HUB COINS!");
        return;
    }
    
    if (userData.hubCoins < amount) {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ HUB COINS!");
        return;
    }
    
    const shuAmount = Math.floor(amount / 100);
    userData.hubCoins -= amount;
    userData.shooterCoins += shuAmount;
    
    document.getElementById('hub-to-shu-result').innerHTML = 
        `‚úÖ –û–±–º–µ–Ω–µ–Ω–æ: ${amount} HUB ‚Üí ${shuAmount} SHU`;
    
    updateUI();
    saveGameData();
}

function convertShuToHub() {
    const input = document.getElementById('shu-to-hub');
    const amount = parseInt(input.value) || 0;
    
    if (amount < 1) {
        alert("–ú–∏–Ω–∏–º—É–º 1 SHU!");
        return;
    }
    
    if (userData.shooterCoins < amount) {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ SHU!");
        return;
    }
    
    const hubAmount = amount * 80;
    userData.shooterCoins -= amount;
    userData.hubCoins += hubAmount;
    
    document.getElementById('shu-to-hub-result').innerHTML = 
        `‚úÖ –û–±–º–µ–Ω–µ–Ω–æ: ${amount} SHU ‚Üí ${hubAmount} HUB`;
    
    updateUI();
    saveGameData();
}

function updateShop() {
    // –õ–∏–¥–µ—Ä–±–æ—Ä–¥
    const leaderboard = document.getElementById('leaderboard');
    let html = '';
    
    Object.entries(gameData.users)
        .sort((a, b) => b[1].kills - a[1].kills)
        .slice(0, 10)
        .forEach(([username, data], index) => {
            html += `
                <div style="display: flex; justify-content: space-between; padding: 10px; background: ${index % 2 === 0 ? 'rgba(255,255,255,0.05)' : 'transparent'}; border-radius: 5px; margin: 5px 0;">
                    <span>${index + 1}. ${username}</span>
                    <span>${data.kills} —É–±–∏–π—Å—Ç–≤ | ${data.shooterCoins} SHU</span>
                </div>
            `;
        });
    
    leaderboard.innerHTML = html;
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const stats = document.getElementById('user-stats');
    stats.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div class="card">
                <h4>üî´ –®–£–¢–ï–†</h4>
                <p>–£–±–∏–π—Å—Ç–≤: ${userData.kills}</p>
                <p>–°–º–µ—Ä—Ç–µ–π: ${userData.deaths}</p>
                <p>K/D: ${(userData.kills / Math.max(userData.deaths, 1)).toFixed(2)}</p>
            </div>
            <div class="card">
                <h4>üíé –§–≠–ú–ò–õ–ò –•–ê–ë</h4>
                <p>–£—Ä–æ–≤–µ–Ω—å: ${userData.hubLevel || 1}</p>
                <p>–ü–∏—Ç–æ–º—Ü–µ–≤: ${(userData.hubPets || []).length}</p>
                <p>–ê–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä: ${(userData.hubUpgrades?.auto || 0)} —É—Ä.</p>
            </div>
        </div>
    `;
}

// ====================
# –ß–ê–¢
# ====================
function loadChat() {
    const container = document.getElementById('chat-container');
    container.innerHTML = '';
    
    (gameData.chat || []).slice(-20).forEach(msg => {
        const div = document.createElement('div');
        div.style.padding = '10px';
        div.style.margin = '8px 0';
        div.style.background = msg.user === currentUser ? 
            'linear-gradient(90deg, rgba(0,255,0,0.1), transparent)' : 
            'linear-gradient(90deg, rgba(0,242,255,0.1), transparent)';
        div.style.borderRadius = '10px';
        div.style.borderLeft = `4px solid ${msg.user === currentUser ? '#00ff00' : 'var(--p)'}`;
        div.innerHTML = `
            <strong style="color:${msg.user === currentUser ? '#00ff00' : 'var(--p)'}">${msg.user}:</strong>
            <span style="margin-left: 10px;">${msg.text}</span>
            <div style="font-size: 10px; color: #aaa; text-align: right;">${msg.time}</div>
        `;
        container.appendChild(div);
    });
    
    container.scrollTop = container.scrollHeight;
}

function sendChat() {
    const input = document.getElementById('chat-input');
    const text = input.value.trim();
    
    if (!text) return;
    
    const message = {
        user: currentUser,
        text: text,
        time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
    };
    
    if (!gameData.chat) gameData.chat = [];
    gameData.chat.push(message);
    
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
    if (gameData.chat.length > 100) {
        gameData.chat = gameData.chat.slice(-50);
    }
    
    localStorage.setItem('ultra_hub_data', JSON.stringify(gameData));
    loadChat();
    input.value = '';
    input.focus();
}

// ====================
# –£–¢–ò–õ–ò–¢–´
# ====================
function startClock() {
    function update() {
        const now = new Date();
        document.getElementById('clock').textContent = 
            now.toLocaleTimeString('ru-RU', { hour12: false });
    }
    update();
    setInterval(update, 1000);
}

function switchTab(tabId) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
    document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
    document.getElementById(tabId + '-section').classList.add('active');
    
    // –û—Å–æ–±—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
    if (tabId === 'shooter') {
        setTimeout(() => {
            if (!scene) {
                initShooter();
            }
            if (window.autoClickerInterval) {
                clearInterval(window.autoClickerInterval);
                window.autoClickerInterval = null;
            }
        }, 100);
    }
    
    if (tabId === 'family') {
        showPets();
        startAutoClicker();
    }
    
    if (tabId === 'shop') {
        updateShop();
    }
}

function startGameMode(mode) {
    alert(`–†–µ–∂–∏–º "${mode}" –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...`);
    toggleGameMenu();
}

function toggleGameMenu() {
    const menu = document.getElementById('game-menu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

function saveGameData() {
    gameData.users[currentUser] = userData;
    localStorage.setItem('ultra_hub_data', JSON.stringify(gameData));
}

function backupData() {
    const backup = JSON.stringify(gameData);
    const blob = new Blob([backup], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `ultra_hub_backup_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    const status = document.getElementById('backup-status');
    status.style.display = 'block';
    status.innerHTML = '‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞!';
    setTimeout(() => {
        status.style.display = 'none';
    }, 3000);
}

function logout() {
    if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
        saveGameData();
        location.reload();
    }
}

function resetData() {
    if (confirm('üí£ –í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã.\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!\n\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
        localStorage.clear();
        alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã. –ò–≥—Ä–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è.');
        location.reload();
    }
}

// ====================
# –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
# ====================
window.addEventListener('load', function() {
    // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
    document.getElementById('password-input').value = "1";
    
    // Enter –¥–ª—è –≤—Ö–æ–¥–∞
    document.getElementById('password-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') login();
    });
    
    // Enter –¥–ª—è —á–∞—Ç–∞
    document.getElementById('chat-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') sendChat();
    });
    
    // –ê–≤—Ç–æ–≤—Ö–æ–¥ –ø–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const lastUser = Object.keys(gameData.users)[0];
    if (lastUser) {
        currentUser = lastUser;
        userData = gameData.users[lastUser];
        
        document.getElementById('user-select').value = lastUser;
        document.getElementById('auth-overlay').style.display = 'none';
        document.getElementById('main-content').style.display = 'flex';
        document.getElementById('user-tag').textContent = `üë§ ${lastUser} | –£–±–∏–π—Å—Ç–≤: ${userData.kills} | –£—Ä–æ–≤–µ–Ω—å: ${userData.hubLevel || 1}`;
        
        updateUI();
        loadChat();
        startClock();
        updateShop();
        showPets();
        startAutoClicker();
    }
    
    // –†–µ—Å–∞–π–∑ –∏–≥—Ä—ã
    window.addEventListener('resize', function() {
        if (camera && renderer) {
            const canvas = document.getElementById('game-canvas');
            camera.aspect = canvas.clientWidth / canvas.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        }
    });
});
</script>
</body>
</html>

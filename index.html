<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA HUB 3D - PVP –®–£–¢–ï–†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --p: #00f2ff;
            --s: #ff00ff;
            --bg: #050505;
            --text: #fff;
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        /* –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - –ü–†–û–°–¢–ê–Ø */
        #auth-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #000 0%, #0a0a2a 100%);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .auth-card {
            background: rgba(0,0,0,0.9);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid var(--p);
            text-align: center;
            width: 100%;
            max-width: 400px;
        }
        
        .auth-input {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            border: 2px solid var(--p);
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
        }
        
        .auth-btn {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            border-radius: 10px;
            border: none;
            background: var(--p);
            color: black;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #main-content {
            display: none;
            height: 100vh;
            flex-direction: column;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        nav {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(0,0,0,0.9);
            border-bottom: 3px solid var(--p);
            overflow-x: auto;
            flex-wrap: wrap;
        }
        
        nav button {
            background: transparent;
            border: 2px solid var(--p);
            color: var(--p);
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        nav button:hover, nav button.active {
            background: var(--p);
            color: black;
        }
        
        /* –°–µ–∫—Ü–∏–∏ */
        section {
            display: none;
            height: calc(100vh - 70px);
            overflow: hidden;
        }
        
        section.active {
            display: block;
        }
        
        /* 3D –ò–≥—Ä–∞ */
        #game-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        #game-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }
        
        /* –ò–≥—Ä–æ–≤–æ–π UI */
        #game-ui {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 2;
            pointer-events: none;
            padding: 20px;
        }
        
        .game-stats {
            position: absolute;
            top: 20px; left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--p);
            pointer-events: all;
            min-width: 250px;
        }
        
        .mobile-controls {
            display: none;
            position: absolute;
            bottom: 20px;
            width: 100%;
            padding: 0 20px;
        }
        
        .mobile-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .mobile-btn {
            padding: 20px;
            background: rgba(0,0,0,0.7);
            border: 2px solid var(--p);
            color: white;
            font-size: 24px;
            border-radius: 50%;
            cursor: pointer;
            pointer-events: all;
            user-select: none;
        }
        
        .joystick-area {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 150px;
            height: 150px;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            pointer-events: all;
        }
        
        .joystick {
            position: absolute;
            width: 60px;
            height: 60px;
            background: var(--p);
            border-radius: 50%;
            top: 45px;
            left: 45px;
            touch-action: none;
        }
        
        /* –û—Ä—É–∂–∏–µ */
        .weapon-selector {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--p);
            pointer-events: all;
        }
        
        .weapon-btn {
            padding: 10px;
            margin: 5px;
            background: rgba(255,255,255,0.1);
            border: 2px solid var(--p);
            color: white;
            cursor: pointer;
        }
        
        /* –ú–µ–Ω—é –∏–≥—Ä—ã */
        .game-menu {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid var(--p);
            z-index: 10;
            min-width: 400px;
            pointer-events: all;
            display: none;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            margin: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .mobile-controls { display: block; }
            .joystick-area { display: block; }
            .game-menu { min-width: 90%; }
        }
    </style>
</head>
<body>

<!-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è -->
<div id="auth-overlay">
    <div class="auth-card">
        <h2 style="color:var(--p); margin-bottom: 30px;">üéÆ 3D PVP –®–£–¢–ï–†</h2>
        
        <select id="user-select" class="auth-input">
            <option value="–ù–∏–∫–∏—Ç–∞">–ù–∏–∫–∏—Ç–∞</option>
            <option value="–ê–ª–µ–Ω–∞">–ê–ª–µ–Ω–∞</option>
            <option value="–°–∞—à–∞">–°–∞—à–∞</option>
            <option value="–ê–ª–∏—Å–∞">–ê–ª–∏—Å–∞</option>
        </select>
        
        <input type="password" id="password-input" class="auth-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π –ø–∞—Ä–æ–ª—å" value="1">
        
        <button class="auth-btn" onclick="login()">
            üöÄ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
        </button>
    </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
<div id="main-content">
    <nav>
        <button onclick="switchTab('home')" class="active">üè† –ì–õ–ê–í–ù–ê–Ø</button>
        <button onclick="switchTab('pvp')">üéÆ PVP –®–£–¢–ï–†</button>
        <button onclick="switchTab('miner')">‚õèÔ∏è –ú–ê–ô–ù–ï–†</button>
        <button onclick="switchTab('chat')">üí¨ –ß–ê–¢</button>
        <button onclick="switchTab('exit')">üö™ –í–´–•–û–î</button>
    </nav>

    <!-- –ì–ª–∞–≤–Ω–∞—è -->
    <section id="home" class="active">
        <div style="padding: 20px;">
            <div class="card">
                <h1 id="clock" style="text-align: center; color: var(--p);">00:00:00</h1>
                <p id="user-tag" style="text-align: center; margin: 10px 0;"></p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div class="card">
                        <h3>üí∞ BYTES</h3>
                        <p style="font-size: 2rem;" id="balance-display">0</p>
                    </div>
                    <div class="card">
                        <h3>‚ö° –ú–ù–û–ñ–ò–¢–ï–õ–¨</h3>
                        <p style="font-size: 2rem;" id="multiplier">1x</p>
                    </div>
                    <div class="card">
                        <h3>üé™ –ü–ò–¢–û–ú–¶–ï–í</h3>
                        <p style="font-size: 2rem;" id="pets-count">0</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- PVP –®–£–¢–ï–† -->
    <section id="pvp">
        <div id="game-container">
            <canvas id="game-canvas"></canvas>
            
            <div id="game-ui">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="game-stats">
                    <h3>üéÆ PVP –®–£–¢–ï–†</h3>
                    <p>–ò–≥—Ä–æ–∫: <span id="game-player">-</span></p>
                    <p>–£–±–∏–π—Å—Ç–≤–∞: <span id="game-kills">0</span></p>
                    <p>–°–º–µ—Ä—Ç–∏: <span id="game-deaths">0</span></p>
                    <p>–ó–¥–æ—Ä–æ–≤—å–µ: <span id="game-health">100</span> ‚ù§Ô∏è</p>
                    <p>–ü–∞—Ç—Ä–æ–Ω—ã: <span id="game-ammo">30</span> üî´</p>
                    <p>–û—Ä—É–∂–∏–µ: <span id="game-weapon">AKM</span></p>
                </div>
                
                <!-- –í—ã–±–æ—Ä –æ—Ä—É–∂–∏—è -->
                <div class="weapon-selector">
                    <h4>üõ†Ô∏è –û–†–£–ñ–ò–ï</h4>
                    <button class="weapon-btn" onclick="switchWeapon('akm')">üî´ AKM</button>
                    <button class="weapon-btn" onclick="switchWeapon('awp')">üéØ AWP</button>
                    <button class="weapon-btn" onclick="switchWeapon('knife')">üî™ –ù–û–ñ</button>
                </div>
                
                <!-- –ú–µ–Ω—é –∏–≥—Ä—ã -->
                <div id="game-menu" class="game-menu">
                    <h2 style="color:var(--p); margin-bottom: 20px;">üéÆ –í–´–ë–û–† –†–ï–ñ–ò–ú–ê</h2>
                    
                    <div style="margin: 20px 0;">
                        <button class="auth-btn" onclick="startPVP('bot')" style="margin: 10px 0;">
                            ü§ñ –ò–ì–†–ê –° –ë–û–¢–ê–ú–ò
                        </button>
                        
                        <button class="auth-btn" onclick="startPVP('pvp')" style="margin: 10px 0; background: var(--s);">
                            ‚öîÔ∏è PVP 1 –Ω–∞ 1
                        </button>
                        
                        <select id="pvp-opponent" class="auth-input" style="margin: 15px 0;">
                            <option value="bot">–ü—Ä–æ—Ç–∏–≤ –±–æ—Ç–∞</option>
                            <option value="–ê–ª–µ–Ω–∞">–ü—Ä–æ—Ç–∏–≤ –ê–ª–µ–Ω—ã</option>
                            <option value="–°–∞—à–∞">–ü—Ä–æ—Ç–∏–≤ –°–∞—à–∏</option>
                            <option value="–ê–ª–∏—Å–∞">–ü—Ä–æ—Ç–∏–≤ –ê–ª–∏—Å—ã</option>
                        </select>
                        
                        <button class="auth-btn" onclick="toggleGameMenu()" style="margin-top: 20px; background: #666;">
                            ‚úñ –ó–ê–ö–†–´–¢–¨
                        </button>
                    </div>
                </div>
                
                <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                <div class="mobile-controls">
                    <div class="joystick-area">
                        <div class="joystick" id="joystick"></div>
                    </div>
                    
                    <div class="mobile-buttons">
                        <button class="mobile-btn" onclick="mobileAction('jump')">‚Üë</button>
                        <button class="mobile-btn" onclick="mobileAction('shoot')">üî´</button>
                        <button class="mobile-btn" onclick="mobileAction('reload')">üîÑ</button>
                        <button class="mobile-btn" onclick="toggleGameMenu()">‚öôÔ∏è</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- –ú–ê–ô–ù–ï–† -->
    <section id="miner">
        <div style="padding: 20px;">
            <div class="card">
                <h2>‚õèÔ∏è 3D –ú–ê–ô–ù–ï–†</h2>
                <p style="font-size: 2rem; text-align: center; margin: 20px 0;">
                    üí∞ <span id="miner-balance">0</span> BYTES
                </p>
                
                <div style="text-align: center;">
                    <div id="miner-core" style="width: 150px; height: 150px; background: radial-gradient(circle, var(--p) 0%, transparent 70%); border-radius: 50%; border: 3px solid white; margin: 0 auto; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold;">
                        –ö–õ–ò–ö–ù–ò!
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>ü•ö –Ø–ô–¶–ê</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0;">
                        <div class="card" onclick="buyEgg('common')" style="cursor: pointer;">
                            <div style="font-size: 40px;">ü•ö</div>
                            <h4>–û–±—ã—á–Ω–æ–µ</h4>
                            <p>100 BYTES</p>
                        </div>
                        <div class="card" onclick="buyEgg('rare')" style="cursor: pointer;">
                            <div style="font-size: 40px;">üîµ</div>
                            <h4>–†–µ–¥–∫–æ–µ</h4>
                            <p>500 BYTES</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>üîÑ –ü–ï–†–ï–†–û–ñ–î–ï–ù–ò–Ø</h3>
                    <div class="card">
                        <p>–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: <span id="rebirth-level">0</span></p>
                        <p style="color: gold; font-size: 1.5rem; margin: 10px 0;">
                            –°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="rebirth-cost">10000</span> BYTES
                        </p>
                        <button class="auth-btn" onclick="doRebirth()" style="background: gold; color: black;">
                            üîÑ –ü–ï–†–ï–†–û–î–ò–¢–¨–°–Ø
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- –ß–ê–¢ -->
    <section id="chat">
        <div style="padding: 20px; height: 100%;">
            <div class="card" style="height: 100%; display: flex; flex-direction: column;">
                <h2>üí¨ –ß–ê–¢</h2>
                <div id="chat-container" style="flex: 1; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin: 15px 0;"></div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chat-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="flex: 1; padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; border: 2px solid var(--p);">
                    <button class="auth-btn" onclick="sendChat()" style="width: auto;">üì®</button>
                </div>
            </div>
        </div>
    </section>

    <!-- –í–´–•–û–î -->
    <section id="exit">
        <div style="padding: 20px;">
            <div class="card">
                <h2 style="text-align: center;">üö™ –í–´–•–û–î</h2>
                
                <button class="auth-btn" onclick="logout()" style="margin: 10px 0;">
                    üîì –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                </button>
                
                <button class="auth-btn" onclick="resetData()" style="margin: 10px 0; background: #f44336;">
                    üí£ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                </button>
            </div>
        </div>
    </section>
</div>

<script>
// ====================
// –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –î–ê–ù–ù–´–ï
// ====================
let currentUser = "";
let isMobile = false;
let gameActive = false;
let pvpMode = false;
let currentWeapon = 'akm';
let kills = 0;
let deaths = 0;
let health = 100;
let ammo = 30;

// Three.js –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let scene, camera, renderer;
let player, opponent;
let walls = [];
let bullets = [];
let bots = [];

// –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã —á–µ—Ä–µ–∑ localStorage (–º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä)
let gameData = JSON.parse(localStorage.getItem('game_data')) || {
    players: {},
    pvpMatches: []
};

// –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
let userData = JSON.parse(localStorage.getItem('user_data')) || {
    "–ù–∏–∫–∏—Ç–∞": { bytes: 10000, rebirths: 0, pets: [], kills: 0, deaths: 0 },
    "–ê–ª–µ–Ω–∞": { bytes: 5000, rebirths: 0, pets: [], kills: 0, deaths: 0 },
    "–°–∞—à–∞": { bytes: 3000, rebirths: 0, pets: [], kills: 0, deaths: 0 },
    "–ê–ª–∏—Å–∞": { bytes: 2000, rebirths: 0, pets: [], kills: 0, deaths: 0 }
};

let chatData = JSON.parse(localStorage.getItem('chat_data')) || [];

// ====================
// –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø - –†–ê–ë–û–¢–ê–ï–¢!
// ====================
function login() {
    const user = document.getElementById('user-select').value;
    const password = document.getElementById('password-input').value;
    
    if (!password) {
        alert("–í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π –ø–∞—Ä–æ–ª—å!");
        return;
    }
    
    currentUser = user;
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
    isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –Ω–µ—Ç
    if (!userData[user]) {
        userData[user] = { bytes: 1000, rebirths: 0, pets: [], kills: 0, deaths: 0 };
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    document.getElementById('auth-overlay').style.display = 'none';
    document.getElementById('main-content').style.display = 'flex';
    document.getElementById('user-tag').textContent = `üë§ ${user}`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    updateUI();
    loadChat();
    startClock();
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º
    saveAllData();
    
    alert(`üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user}!`);
}

// ====================
// 3D PVP –ò–ì–†–ê
// ====================
function init3DGame() {
    const canvas = document.getElementById('game-canvas');
    
    // –°—Ü–µ–Ω–∞
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111122);
    scene.fog = new THREE.Fog(0x111122, 1, 100);
    
    // –ö–∞–º–µ—Ä–∞
    camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
    camera.position.set(0, 2, 5);
    
    // –†–µ–Ω–¥–µ—Ä–µ—Ä
    renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
    renderer.setSize(canvas.clientWidth, canvas.clientHeight);
    renderer.shadowMap.enabled = true;
    
    // –û—Å–≤–µ—â–µ–Ω–∏–µ
    const ambientLight = new THREE.AmbientLight(0x404040);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(10, 20, 10);
    directionalLight.castShadow = true;
    scene.add(directionalLight);
    
    // –ü–æ–ª
    const floorGeometry = new THREE.PlaneGeometry(50, 50);
    const floorMaterial = new THREE.MeshPhongMaterial({ color: 0x2a2a2a });
    const floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);
    
    // –°—Ç–µ–Ω—ã
    createWalls();
    
    // –ò–≥—Ä–æ–∫
    createPlayer();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
    gameActive = true;
    animate();
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
    setupKeyboardControls();
    
    // –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    if (isMobile) {
        setupMobileControls();
    }
}

function createWalls() {
    const wallMaterial = new THREE.MeshPhongMaterial({ color: 0x444444 });
    
    // –ë–æ–∫–æ–≤—ã–µ —Å—Ç–µ–Ω—ã
    for (let i = -20; i <= 20; i += 40) {
        const wallGeometry = new THREE.BoxGeometry(1, 4, 40);
        const wall = new THREE.Mesh(wallGeometry, wallMaterial);
        wall.position.set(i, 2, 0);
        wall.castShadow = true;
        wall.receiveShadow = true;
        walls.push(wall);
        scene.add(wall);
    }
    
    // –ü–µ—Ä–µ–¥–Ω—è—è/–∑–∞–¥–Ω—è—è —Å—Ç–µ–Ω—ã
    for (let i = -20; i <= 20; i += 40) {
        const wallGeometry = new THREE.BoxGeometry(40, 4, 1);
        const wall = new THREE.Mesh(wallGeometry, wallMaterial);
        wall.position.set(0, 2, i);
        wall.castShadow = true;
        wall.receiveShadow = true;
        walls.push(wall);
        scene.add(wall);
    }
    
    // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
    for (let i = 0; i < 10; i++) {
        const size = 1 + Math.random() * 2;
        const obstacleGeometry = new THREE.BoxGeometry(size, size, size);
        const obstacle = new THREE.Mesh(obstacleGeometry, wallMaterial);
        obstacle.position.set(
            (Math.random() - 0.5) * 30,
            size / 2,
            (Math.random() - 0.5) * 30
        );
        obstacle.castShadow = true;
        obstacle.receiveShadow = true;
        walls.push(obstacle);
        scene.add(obstacle);
    }
}

function createPlayer() {
    // –¢–µ–ª–æ –∏–≥—Ä–æ–∫–∞
    const bodyGeometry = new THREE.BoxGeometry(0.5, 1.8, 0.5);
    const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
    player = new THREE.Mesh(bodyGeometry, bodyMaterial);
    player.position.set(0, 1, 0);
    player.castShadow = true;
    scene.add(player);
    
    // –ì–æ–ª–æ–≤–∞
    const headGeometry = new THREE.SphereGeometry(0.3);
    const headMaterial = new THREE.MeshPhongMaterial({ color: 0x00aa00 });
    const head = new THREE.Mesh(headGeometry, headMaterial);
    head.position.y = 1;
    player.add(head);
}

function createBot() {
    const bodyGeometry = new THREE.BoxGeometry(0.5, 1.8, 0.5);
    const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000 });
    const bot = new THREE.Mesh(bodyGeometry, bodyMaterial);
    
    bot.position.set(
        (Math.random() - 0.5) * 30,
        1,
        (Math.random() - 0.5) * 30
    );
    
    bot.userData = {
        type: 'bot',
        health: 100,
        speed: 0.02,
        target: player,
        lastShot: 0
    };
    
    bot.castShadow = true;
    scene.add(bot);
    bots.push(bot);
    return bot;
}

function createOpponent(username) {
    const bodyGeometry = new THREE.BoxGeometry(0.5, 1.8, 0.5);
    const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xff5555 });
    opponent = new THREE.Mesh(bodyGeometry, bodyMaterial);
    
    opponent.position.set(10, 1, 0);
    opponent.userData = {
        type: 'player',
        username: username,
        health: 100
    };
    
    opponent.castShadow = true;
    scene.add(opponent);
    return opponent;
}

function animate() {
    if (!gameActive) return;
    
    requestAnimationFrame(animate);
    
    // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
    const speed = 0.1;
    if (keys['w']) player.position.z -= speed;
    if (keys['s']) player.position.z += speed;
    if (keys['a']) player.position.x -= speed;
    if (keys['d']) player.position.x += speed;
    if (keys[' ']) player.position.y += speed; // –ü—Ä—ã–∂–æ–∫
    
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
    player.position.x = Math.max(-19, Math.min(19, player.position.x));
    player.position.z = Math.max(-19, Math.min(19, player.position.z));
    player.position.y = Math.max(0.9, Math.min(5, player.position.y));
    
    // –ö–∞–º–µ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –∑–∞ –∏–≥—Ä–æ–∫–æ–º
    camera.position.x = player.position.x;
    camera.position.y = player.position.y + 2;
    camera.position.z = player.position.z + 5;
    camera.lookAt(player.position.x, player.position.y, player.position.z);
    
    // AI –±–æ—Ç–æ–≤
    updateBots();
    
    // –î–≤–∏–∂–µ–Ω–∏–µ –ø—É–ª—å
    updateBullets();
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PVP –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞
    updateOpponent();
    
    renderer.render(scene, camera);
}

function updateBots() {
    bots.forEach((bot, index) => {
        if (!bot.userData.target) return;
        
        const target = bot.userData.target;
        const dx = target.position.x - bot.position.x;
        const dz = target.position.z - bot.position.z;
        const distance = Math.sqrt(dx * dx + dz * dz);
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–∏
        if (distance > 2) {
            bot.position.x += (dx / distance) * bot.userData.speed;
            bot.position.z += (dz / distance) * bot.userData.speed;
        }
        
        // –°—Ç—Ä–µ–ª—å–±–∞
        const now = Date.now();
        if (distance < 10 && now - bot.userData.lastShot > 1000) {
            shootFromBot(bot);
            bot.userData.lastShot = now;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ—Ä—Ç–∏
        if (bot.userData.health <= 0) {
            scene.remove(bot);
            bots.splice(index, 1);
            kills++;
            updateGameUI();
            
            // –ù–∞–≥—Ä–∞–¥–∞
            userData[currentUser].bytes += 100;
            userData[currentUser].kills++;
            updateUI();
            saveAllData();
            
            // –ù–æ–≤—ã–π –±–æ—Ç
            setTimeout(() => createBot(), 2000);
        }
    });
}

function updateBullets() {
    for (let i = bullets.length - 1; i >= 0; i--) {
        const bullet = bullets[i];
        bullet.position.add(bullet.userData.velocity);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å–æ —Å—Ç–µ–Ω–∞–º–∏
        let hit = false;
        walls.forEach(wall => {
            const distance = bullet.position.distanceTo(wall.position);
            if (distance < 2) {
                hit = true;
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –±–æ—Ç–æ–≤
        bots.forEach((bot, botIndex) => {
            const distance = bullet.position.distanceTo(bot.position);
            if (distance < 1) {
                bot.userData.health -= 34;
                hit = true;
                
                if (bot.userData.health <= 0) {
                    // –≠—Ñ—Ñ–µ–∫—Ç —Å–º–µ—Ä—Ç–∏
                    showHitEffect(bot.position, 'üíÄ');
                } else {
                    showHitEffect(bot.position, 'üí•');
                }
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞ (PVP)
        if (opponent) {
            const distance = bullet.position.distanceTo(opponent.position);
            if (distance < 1) {
                opponent.userData.health -= 34;
                hit = true;
                showHitEffect(opponent.position, 'üéØ');
                
                if (opponent.userData.health <= 0) {
                    // –£–±–∏–π—Å—Ç–≤–æ –≤ PVP
                    kills++;
                    userData[currentUser].kills++;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é PVP
                    if (gameData.pvpMatches.length > 20) gameData.pvpMatches.shift();
                    gameData.pvpMatches.push({
                        winner: currentUser,
                        loser: opponent.userData.username,
                        time: new Date().toISOString()
                    });
                    
                    // –ù–∞–≥—Ä–∞–¥–∞
                    userData[currentUser].bytes += 500;
                    updateGameUI();
                    updateUI();
                    saveAllData();
                    
                    alert(`üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏ ${opponent.userData.username} –≤ PVP!`);
                    resetPVPMatch();
                }
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—É–ª–∏ –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –∏–ª–∏ –¥–∞–ª–µ–∫–æ
        if (hit || bullet.position.distanceTo(player.position) > 100) {
            scene.remove(bullet);
            bullets.splice(i, 1);
        }
    }
}

function updateOpponent() {
    if (!opponent || opponent.userData.type !== 'player') return;
    
    // –í PVP —Ä–µ–∂–∏–º–µ –æ–ø–ø–æ–Ω–µ–Ω—Ç –¥–≤–∏–≥–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ
    if (pvpMode && opponent.userData.health > 0) {
        // –ü—Ä–æ—Å—Ç–æ–µ —Å–ª—É—á–∞–π–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
        if (Math.random() < 0.02) {
            opponent.position.x += (Math.random() - 0.5) * 0.5;
            opponent.position.z += (Math.random() - 0.5) * 0.5;
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
            opponent.position.x = Math.max(-19, Math.min(19, opponent.position.x));
            opponent.position.z = Math.max(-19, Math.min(19, opponent.position.z));
        }
        
        // –°–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–µ–ª—å–±–∞
        if (Math.random() < 0.01) {
            shootFromOpponent();
        }
    }
}

function shoot() {
    if (ammo <= 0) {
        alert('–ù–µ—Ç –ø–∞—Ç—Ä–æ–Ω–æ–≤! –ù–∞–∂–º–∏—Ç–µ R –¥–ª—è –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏');
        return;
    }
    
    ammo--;
    updateGameUI();
    
    const bulletGeometry = new THREE.SphereGeometry(0.1);
    const bulletMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
    const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);
    
    // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Å—Ç—Ä–µ–ª–∞
    const direction = new THREE.Vector3();
    camera.getWorldDirection(direction);
    
    bullet.position.copy(camera.position);
    bullet.position.y -= 0.5;
    
    bullet.userData = {
        velocity: direction.multiplyScalar(1),
        damage: 34
    };
    
    bullets.push(bullet);
    scene.add(bullet);
    
    // –≠—Ñ—Ñ–µ–∫—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞
    showHitEffect(bullet.position, 'üî´');
}

function shootFromBot(bot) {
    const bulletGeometry = new THREE.SphereGeometry(0.1);
    const bulletMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
    const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);
    
    const direction = new THREE.Vector3();
    direction.subVectors(player.position, bot.position).normalize();
    
    bullet.position.copy(bot.position);
    bullet.position.y += 1;
    
    bullet.userData = {
        velocity: direction.multiplyScalar(0.8),
        damage: 10
    };
    
    bullets.push(bullet);
    scene.add(bullet);
}

function shootFromOpponent() {
    const bulletGeometry = new THREE.SphereGeometry(0.1);
    const bulletMaterial = new THREE.MeshBasicMaterial({ color: 0xff5555 });
    const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);
    
    const direction = new THREE.Vector3();
    direction.subVectors(player.position, opponent.position).normalize();
    
    bullet.position.copy(opponent.position);
    bullet.position.y += 1;
    
    bullet.userData = {
        velocity: direction.multiplyScalar(0.7),
        damage: 25
    };
    
    bullets.push(bullet);
    scene.add(bullet);
}

function showHitEffect(position, emoji) {
    const effect = document.createElement('div');
    effect.style.position = 'absolute';
    effect.style.color = emoji === 'üíÄ' ? 'red' : 'yellow';
    effect.style.fontSize = '30px';
    effect.style.left = '50%';
    effect.style.top = '50%';
    effect.style.transform = `translate(calc(-50% + ${position.x * 10}px), calc(-50% + ${-position.y * 10}px))`;
    effect.style.pointerEvents = 'none';
    effect.textContent = emoji;
    
    document.getElementById('game-ui').appendChild(effect);
    
    setTimeout(() => {
        if (effect.parentNode) {
            effect.parentNode.removeChild(effect);
        }
    }, 1000);
}

// ====================
# –£–ü–†–ê–í–õ–ï–ù–ò–ï
# ====================
let keys = {};

function setupKeyboardControls() {
    window.addEventListener('keydown', (e) => {
        keys[e.key.toLowerCase()] = true;
        
        // –í—ã—Å—Ç—Ä–µ–ª –Ω–∞ –ø—Ä–æ–±–µ–ª –∏–ª–∏ F
        if (e.key === ' ' || e.key === 'f') {
            shoot();
        }
        
        // –ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ –Ω–∞ R
        if (e.key === 'r') {
            reload();
        }
        
        // –ú–µ–Ω—é –Ω–∞ ESC
        if (e.key === 'Escape') {
            toggleGameMenu();
        }
    });
    
    window.addEventListener('keyup', (e) => {
        keys[e.key.toLowerCase()] = false;
    });
}

function setupMobileControls() {
    const joystick = document.getElementById('joystick');
    const area = document.querySelector('.joystick-area');
    let dragging = false;
    
    joystick.addEventListener('touchstart', (e) => {
        dragging = true;
        e.preventDefault();
    });
    
    document.addEventListener('touchmove', (e) => {
        if (!dragging) return;
        
        const touch = e.touches[0];
        const rect = area.getBoundingClientRect();
        const x = touch.clientX - rect.left - rect.width / 2;
        const y = touch.clientY - rect.top - rect.height / 2;
        
        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –¥–∂–æ–π—Å—Ç–∏–∫–∞
        const distance = Math.sqrt(x * x + y * y);
        const maxDistance = rect.width / 2 - 30;
        
        if (distance > maxDistance) {
            const angle = Math.atan2(y, x);
            joystick.style.transform = `translate(${Math.cos(angle) * maxDistance}px, ${Math.sin(angle) * maxDistance}px)`;
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            player.position.x += Math.cos(angle) * 0.1;
            player.position.z += Math.sin(angle) * 0.1;
        } else {
            joystick.style.transform = `translate(${x}px, ${y}px)`;
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–º–µ—â–µ–Ω–∏—é –¥–∂–æ–π—Å—Ç–∏–∫–∞
            player.position.x += (x / maxDistance) * 0.1;
            player.position.z += (y / maxDistance) * 0.1;
        }
    });
    
    document.addEventListener('touchend', () => {
        dragging = false;
        joystick.style.transform = 'translate(0, 0)';
    });
}

function mobileAction(action) {
    switch(action) {
        case 'jump':
            player.position.y += 1;
            setTimeout(() => {
                if (player.position.y > 1) player.position.y = 1;
            }, 500);
            break;
        case 'shoot':
            shoot();
            break;
        case 'reload':
            reload();
            break;
    }
}

function reload() {
    ammo = currentWeapon === 'akm' ? 30 : currentWeapon === 'awp' ? 10 : 999;
    updateGameUI();
    showHitEffect(player.position, 'üîÑ');
}

function switchWeapon(weapon) {
    currentWeapon = weapon;
    updateGameUI();
    showHitEffect(player.position, weapon === 'akm' ? 'üî´' : weapon === 'awp' ? 'üéØ' : 'üî™');
}

// ====================
# –ò–ì–†–û–í–´–ï –†–ï–ñ–ò–ú–´
# ====================
function startPVP(mode) {
    pvpMode = mode === 'pvp';
    
    // –û—á–∏—â–∞–µ–º —Å—Ü–µ–Ω—É
    if (scene) {
        while(scene.children.length > 0){ 
            scene.remove(scene.children[0]); 
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
    init3DGame();
    
    if (mode === 'bot') {
        // –†–µ–∂–∏–º —Å –±–æ—Ç–∞–º–∏
        for (let i = 0; i < 3; i++) {
            createBot();
        }
        document.getElementById('game-player').textContent = '–ë–æ—Ç—ã';
    } else {
        // PVP —Ä–µ–∂–∏–º
        const opponentName = document.getElementById('pvp-opponent').value;
        if (opponentName === 'bot') {
            createBot();
            document.getElementById('game-player').textContent = '–ë–æ—Ç';
        } else {
            createOpponent(opponentName);
            document.getElementById('game-player').textContent = opponentName;
        }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    kills = 0;
    deaths = 0;
    health = 100;
    ammo = 30;
    updateGameUI();
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
    toggleGameMenu();
}

function resetPVPMatch() {
    if (opponent) {
        scene.remove(opponent);
        opponent = null;
    }
    
    health = 100;
    ammo = 30;
    updateGameUI();
}

function toggleGameMenu() {
    const menu = document.getElementById('game-menu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

function updateGameUI() {
    document.getElementById('game-kills').textContent = kills;
    document.getElementById('game-deaths').textContent = deaths;
    document.getElementById('game-health').textContent = health;
    document.getElementById('game-ammo').textContent = ammo;
    document.getElementById('game-weapon').textContent = 
        currentWeapon === 'akm' ? 'AKM' : 
        currentWeapon === 'awp' ? 'AWP' : '–ù–û–ñ';
}

// ====================
# –ú–ê–ô–ù–ï–† –°–ò–°–¢–ï–ú–ê
# ====================
function clickMiner() {
    const core = document.getElementById('miner-core');
    const user = userData[currentUser];
    const multiplier = 1 + (user.rebirths || 0) * 0.5;
    
    // –ê–Ω–∏–º–∞—Ü–∏—è
    core.style.transform = 'scale(0.9)';
    core.style.boxShadow = '0 0 30px var(--p)';
    
    setTimeout(() => {
        core.style.transform = 'scale(1)';
        core.style.boxShadow = 'none';
    }, 100);
    
    // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ
    const gain = Math.floor(100 * multiplier);
    user.bytes += gain;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç
    const effect = document.createElement('div');
    effect.textContent = `+${gain}`;
    effect.style.position = 'absolute';
    effect.style.color = '#00ff00';
    effect.style.fontSize = '20px';
    effect.style.fontWeight = 'bold';
    effect.style.left = '50%';
    effect.style.top = '50%';
    effect.style.transform = 'translate(-50%, -50%)';
    document.getElementById('miner').appendChild(effect);
    
    setTimeout(() => {
        if (effect.parentNode) effect.parentNode.removeChild(effect);
    }, 1000);
    
    updateUI();
    saveAllData();
}

function buyEgg(type) {
    const user = userData[currentUser];
    const price = type === 'common' ? 100 : 500;
    
    if (user.bytes < price) {
        alert(`–ù—É–∂–Ω–æ ${price} BYTES!`);
        return;
    }
    
    user.bytes -= price;
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —è–π—Ü–æ
    const pets = [
        { name: "–ö—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π –¥—Ä–∞–∫–æ–Ω", emoji: "üíéüê≤", bonus: "+0.3x", value: 0.3 },
        { name: "–≠–ª–µ–∫—Ç—Ä–æ –≤–æ–ª–∫", emoji: "‚ö°üê∫", bonus: "+0.2x", value: 0.2 },
        { name: "–°—Ç–∞–ª—å–Ω–æ–π –æ—Ä—ë–ª", emoji: "ü¶Öüî©", bonus: "+0.15x", value: 0.15 },
        { name: "–û–≥–Ω–µ–Ω–Ω–∞—è –ª–∏—Å–∞", emoji: "üî•ü¶ä", bonus: "+0.1x", value: 0.1 }
    ];
    
    const pet = pets[Math.floor(Math.random() * pets.length)];
    
    if (!user.pets) user.pets = [];
    user.pets.push(pet);
    
    updateUI();
    saveAllData();
    alert(`üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏: ${pet.emoji} ${pet.name} (${pet.bonus})`);
}

function doRebirth() {
    const user = userData[currentUser];
    const rebirths = user.rebirths || 0;
    const cost = Math.floor(10000 * Math.pow(1.5, rebirths));
    
    if (user.bytes < cost) {
        alert(`–ù—É–∂–Ω–æ ${cost} BYTES!`);
        return;
    }
    
    if (!confirm(`–ü–µ—Ä–µ—Ä–æ–¥–∏—Ç—å—Å—è –∑–∞ ${cost} BYTES?\n+0.5x –∫ –º–Ω–æ–∂–∏—Ç–µ–ª—é –Ω–∞–≤—Å–µ–≥–¥–∞!`)) {
        return;
    }
    
    user.bytes = 0;
    user.rebirths = rebirths + 1;
    
    updateUI();
    saveAllData();
    alert(`üéâ –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ #${user.rebirths} –∑–∞–≤–µ—Ä—à–µ–Ω–æ!`);
}

// ====================
# –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê
# ====================
function updateUI() {
    const user = userData[currentUser] || {};
    
    document.getElementById('balance-display').textContent = user.bytes || 0;
    document.getElementById('miner-balance').textContent = user.bytes || 0;
    document.getElementById('multiplier').textContent = (1 + (user.rebirths || 0) * 0.5).toFixed(1) + 'x';
    document.getElementById('pets-count').textContent = (user.pets || []).length;
    document.getElementById('rebirth-level').textContent = user.rebirths || 0;
    document.getElementById('rebirth-cost').textContent = Math.floor(10000 * Math.pow(1.5, user.rebirths || 0)).toLocaleString();
}

// ====================
# –ß–ê–¢
# ====================
function loadChat() {
    const container = document.getElementById('chat-container');
    container.innerHTML = '';
    
    chatData.slice(-20).forEach(msg => {
        const div = document.createElement('div');
        div.style.padding = '8px';
        div.style.margin = '5px 0';
        div.style.background = msg.user === currentUser ? 'rgba(0,255,0,0.1)' : 'rgba(0,242,255,0.1)';
        div.style.borderRadius = '8px';
        div.innerHTML = `<strong>${msg.user}:</strong> ${msg.text}`;
        container.appendChild(div);
    });
    
    container.scrollTop = container.scrollHeight;
}

function sendChat() {
    const input = document.getElementById('chat-input');
    const text = input.value.trim();
    
    if (!text) return;
    
    const message = {
        user: currentUser,
        text: text,
        time: new Date().toLocaleTimeString()
    };
    
    chatData.push(message);
    if (chatData.length > 100) chatData.shift();
    
    localStorage.setItem('chat_data', JSON.stringify(chatData));
    loadChat();
    input.value = '';
}

// ====================
# –£–¢–ò–õ–ò–¢–´
# ====================
function startClock() {
    function update() {
        const now = new Date();
        document.getElementById('clock').textContent = 
            now.toLocaleTimeString('ru-RU', { hour12: false });
    }
    update();
    setInterval(update, 1000);
}

function switchTab(tabId) {
    document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    document.querySelectorAll('section').forEach(section => section.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    
    if (tabId === 'pvp') {
        setTimeout(() => {
            if (!scene) {
                init3DGame();
            }
        }, 100);
    }
}

function saveAllData() {
    localStorage.setItem('user_data', JSON.stringify(userData));
    localStorage.setItem('chat_data', JSON.stringify(chatData));
    localStorage.setItem('game_data', JSON.stringify(gameData));
    localStorage.setItem('last_user', currentUser);
}

function logout() {
    if (confirm('–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?')) {
        saveAllData();
        location.reload();
    }
}

function resetData() {
    if (confirm('üí£ –£–î–ê–õ–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) {
        localStorage.clear();
        location.reload();
    }
}

// ====================
# –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
# ====================
window.addEventListener('load', function() {
    // –ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    document.getElementById('password-input').value = "1";
    
    // Enter –¥–ª—è –≤—Ö–æ–¥–∞
    document.getElementById('password-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') login();
    });
    
    // –ê–≤—Ç–æ–≤—Ö–æ–¥
    const lastUser = localStorage.getItem('last_user');
    if (lastUser && userData[lastUser]) {
        currentUser = lastUser;
        document.getElementById('auth-overlay').style.display = 'none';
        document.getElementById('main-content').style.display = 'flex';
        document.getElementById('user-tag').textContent = `üë§ ${lastUser}`;
        
        updateUI();
        loadChat();
        startClock();
    }
});

// –†–µ—Å–∞–π–∑ –∏–≥—Ä—ã
window.addEventListener('resize', function() {
    if (camera && renderer) {
        const canvas = document.getElementById('game-canvas');
        camera.aspect = canvas.clientWidth / canvas.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(canvas.clientWidth, canvas.clientHeight);
    }
});
</script>
</body>
</html>

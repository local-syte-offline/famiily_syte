<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        :root {
            --primary: #3498db;
            --secondary: #2980b9;
            --accent: #2ecc71;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --text: #ecf0f1;
            --bg: #2c3e50;
            --card: #34495e;
            --border: #7f8c8d;
        }

        [data-theme="light"] {
            --primary: #3498db;
            --secondary: #2980b9;
            --accent: #2ecc71;
            --text: #2c3e50;
            --bg: #ecf0f1;
            --card: #ffffff;
            --border: #bdc3c7;
        }

        [data-theme="purple"] {
            --primary: #9b59b6;
            --secondary: #8e44ad;
            --accent: #e74c3c;
            --text: #ecf0f1;
            --bg: #2c3e50;
            --card: #34495e;
            --border: #7f8c8d;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* –°–Ω–µ–∂–∏–Ω–∫–∏ */
        .snowflake {
            position: fixed;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            animation: fall linear infinite;
            filter: blur(1px);
            opacity: 0.8;
        }

        @keyframes fall {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* –õ–æ–≥–∏–Ω */
        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .login-container {
            background: var(--card);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        .user-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 180px;
        }

        .user-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .user-btn.selected {
            background: var(--accent);
            box-shadow: 0 0 0 3px var(--accent);
        }

        .user-btn.occupied {
            background: var(--danger);
            opacity: 0.7;
        }

        .login-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 15px 30px;
            margin-top: 30px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: #219653;
            transform: translateY(-2px);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .main-app {
            display: none;
            min-height: 100vh;
        }

        .header {
            background: var(--card);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .balance {
            background: var(--accent);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: white;
        }

        .nav {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 15px;
            background: var(--card);
        }

        .tab {
            background: transparent;
            border: none;
            color: var(--text);
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: var(--primary);
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .page {
            display: none;
            padding: 20px;
            min-height: calc(100vh - 150px);
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* –û–±–ª–∞–∫–æ */
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .file {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .file-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .delete-file {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
        }

        /* –ò–≥—Ä—ã */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .game-card {
            background: var(--card);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--border);
        }

        .game-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .game-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        /* –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ */
        .translator-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .lang-selector {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        select, textarea {
            width: 100%;
            background: var(--card);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 12px;
            border-radius: 10px;
            font-size: 16px;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        .voice-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }

        /* –ß–∞—Å—ã */
        .clocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .clock {
            background: var(--card);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }

        .clock-time {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }

        /* –ß–∞—Ç */
        .chat-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            height: 500px;
        }

        @media (max-width: 768px) {
            .chat-container {
                grid-template-columns: 1fr;
            }
        }

        .chat-users {
            background: var(--card);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
        }

        .chat-user {
            background: var(--bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .chat-user.active {
            background: var(--primary);
            color: white;
        }

        .chat-messages {
            background: var(--card);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .messages-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .message {
            background: var(--bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            max-width: 70%;
        }

        .message.sent {
            background: var(--primary);
            margin-left: auto;
            color: white;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            background: var(--bg);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 12px;
            border-radius: 8px;
        }

        .chat-send {
            background: var(--success);
            color: white;
            border: none;
            width: 50px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* –ú–æ–¥–∞–ª–∫–∏ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card);
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-btn {
            background: var(--danger);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Talking Tom 2 - –∫–∞–∫ –æ—Ä–∏–≥–∏–Ω–∞–ª */
        .tom-game {
            text-align: center;
        }

        .tom-body {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 50%;
            margin: 20px auto;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tom-body:hover {
            transform: scale(1.05);
        }

        .tom-eye {
            position: absolute;
            width: 50px;
            height: 70px;
            background: white;
            border-radius: 50%;
            top: 80px;
        }

        .tom-eye.left {
            left: 80px;
        }

        .tom-eye.right {
            right: 80px;
        }

        .tom-eye::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: #2c3e50;
            border-radius: 50%;
            top: 25px;
            left: 15px;
        }

        .tom-mouth {
            position: absolute;
            width: 80px;
            height: 40px;
            background: #e74c3c;
            border-radius: 50%;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
        }

        .tom-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .tom-stat {
            background: var(--bg);
            padding: 20px;
            border-radius: 10px;
        }

        .tom-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .tom-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* –ö–° 1.6 —Å—Ç–∏–ª—å */
        .cs-game {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 2000;
        }

        #cs-canvas {
            width: 100%;
            height: 100%;
        }

        .cs-hud {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Arial', sans-serif;
        }

        .cs-hud-item {
            margin-bottom: 10px;
            font-size: 18px;
        }

        .cs-weapons {
            position: absolute;
            bottom: 100px;
            left: 20px;
            display: flex;
            gap: 10px;
        }

        .cs-weapon {
            background: rgba(0,0,0,0.7);
            border: 2px solid #666;
            padding: 10px 20px;
            color: white;
            border-radius: 8px;
            cursor: pointer;
        }

        .cs-exit {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
        }

        /* –ö–ª–∏–∫–µ—Ä */
        .clicker-game {
            text-align: center;
        }

        .clicker-money {
            font-size: 48px;
            font-weight: bold;
            margin: 30px 0;
            color: var(--accent);
        }

        .clicker-btn {
            background: var(--warning);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            border-radius: 15px;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.1s ease;
        }

        .clicker-btn:active {
            transform: scale(0.95);
        }

        .upgrades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .upgrade {
            background: var(--bg);
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upgrade:hover {
            background: var(--primary);
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .theme-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            margin: 5px;
        }

        .theme-dark { background: #2c3e50; }
        .theme-light { background: #ecf0f1; color: #2c3e50; }
        .theme-purple { background: #8e44ad; }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #7f8c8d;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* –ö–∞—Ä—Ç—ã */
        .map-container {
            height: 500px;
            background: var(--card);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
        }

        .map-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
        }

        /* –ß–∞—Ç-–±–æ—Ç */
        .chat-bot {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .chat-bot-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .chat-bot-modal {
            display: none;
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            height: 500px;
            background: var(--card);
            border-radius: 15px;
            z-index: 1001;
            border: 2px solid var(--border);
            flex-direction: column;
        }

        .chat-bot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .bot-message {
            background: var(--bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .bot-message.user {
            background: var(--primary);
            color: white;
            margin-left: auto;
        }

        .chat-bot-input {
            display: flex;
            padding: 20px;
            border-top: 2px solid var(--border);
        }

        .chat-bot-input input {
            flex: 1;
            background: var(--bg);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 12px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- –õ–æ–≥–∏–Ω -->
    <div class="login-screen">
        <div class="login-container">
            <h1 style="margin-bottom: 30px;">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
            <div id="user-list" style="display: flex; flex-wrap: wrap; justify-content: center;">
                <!-- –Æ–∑–µ—Ä—ã —á–µ—Ä–µ–∑ JS -->
            </div>
            <button class="login-btn" onclick="login()">–í–æ–π—Ç–∏</button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="main-app">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="user-info">
                <div class="user-avatar" id="current-avatar">N</div>
                <div>
                    <div style="font-weight: bold;" id="current-username">–ù–∏–∫–∏—Ç–∞</div>
                    <div class="balance" id="balance">$1000</div>
                </div>
            </div>
            
            <div>
                <button class="voice-btn" onclick="openSettings()">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button class="voice-btn" onclick="exitApp()" style="background: var(--danger);">–í—ã—Ö–æ–¥</button>
            </div>
        </div>
        
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="nav">
            <button class="tab active" data-page="cloud">–û–±–ª–∞–∫–æ</button>
            <button class="tab" data-page="games">–ò–≥—Ä—ã</button>
            <button class="tab" data-page="translator">–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫</button>
            <button class="tab" data-page="clocks">–ß–∞—Å—ã</button>
            <button class="tab" data-page="chat">–ß–∞—Ç</button>
            <button class="tab" data-page="maps">–ö–∞—Ä—Ç—ã</button>
        </nav>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
        <main>
            <!-- –û–±–ª–∞–∫–æ -->
            <section id="cloud" class="page active">
                <h2 style="margin-bottom: 20px;">–û–±–ª–∞–∫–æ</h2>
                <button class="voice-btn" onclick="addFile()">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª</button>
                <div class="files-grid" id="files-grid">
                    <!-- –§–∞–π–ª—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </section>
            
            <!-- –ò–≥—Ä—ã -->
            <section id="games" class="page">
                <h2 style="margin-bottom: 20px;">–ò–≥—Ä—ã</h2>
                <div class="games-grid">
                    <div class="game-card" onclick="startCS()">
                        <div class="game-icon">üî´</div>
                        <div style="font-weight: bold; margin-bottom: 10px;">Counter-Strike 1.6</div>
                        <div>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —à—É—Ç–µ—Ä</div>
                    </div>
                    
                    <div class="game-card" onclick="startTalkingTom()">
                        <div class="game-icon">üò∫</div>
                        <div style="font-weight: bold; margin-bottom: 10px;">My Talking Tom 2</div>
                        <div>–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü</div>
                    </div>
                    
                    <div class="game-card" onclick="startClicker()">
                        <div class="game-icon">üí∞</div>
                        <div style="font-weight: bold; margin-bottom: 10px;">–ö–ª–∏–∫–µ—Ä</div>
                        <div>–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –∫–ª–∏–∫–∞–º–∏</div>
                    </div>
                </div>
            </section>
            
            <!-- –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ -->
            <section id="translator" class="page">
                <div class="translator-container">
                    <h2 style="margin-bottom: 20px;">–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫</h2>
                    
                    <div class="lang-selector">
                        <div style="flex: 1;">
                            <select id="lang-from">
                                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                                <option value="en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                                <option value="es">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
                                <option value="de">–ù–µ–º–µ—Ü–∫–∏–π</option>
                                <option value="fr">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
                            </select>
                        </div>
                        
                        <button class="voice-btn" onclick="swapLanguages()">‚áÑ</button>
                        
                        <div style="flex: 1;">
                            <select id="lang-to">
                                <option value="en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                                <option value="es">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
                                <option value="de">–ù–µ–º–µ—Ü–∫–∏–π</option>
                                <option value="fr">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0; text-align: center;">
                        <button class="voice-btn" onclick="startVoiceInput()">üé§ –ì–æ–ª–æ—Å</button>
                        <button class="voice-btn" onclick="speakTranslation()">üîä –û–∑–≤—É—á–∏—Ç—å</button>
                        <button class="voice-btn" onclick="askAI()" style="background: var(--accent);">ü§ñ –ò–ò –ø–æ–º–æ—â—å</button>
                    </div>
                    
                    <textarea id="input-text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..." oninput="translateText()"></textarea>
                    <textarea id="output-text" placeholder="–ü–µ—Ä–µ–≤–æ–¥..." readonly></textarea>
                </div>
            </section>
            
            <!-- –ß–∞—Å—ã -->
            <section id="clocks" class="page">
                <h2 style="margin-bottom: 20px;">–ß–∞—Å—ã –º–∏—Ä–∞</h2>
                <div class="clocks-grid" id="clocks-grid">
                    <!-- –ß–∞—Å—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </section>
            
            <!-- –ß–∞—Ç -->
            <section id="chat" class="page">
                <div class="chat-container">
                    <div class="chat-users">
                        <h3 style="margin-bottom: 15px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                        <div id="chat-users">
                            <!-- –Æ–∑–µ—Ä—ã —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>
                    
                    <div class="chat-messages">
                        <h3 id="chat-title">–û–±—â–∏–π —á–∞—Ç</h3>
                        <div class="messages-list" id="messages-list">
                            <!-- –°–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ JS -->
                        </div>
                        <div class="chat-input">
                            <input type="text" id="chat-message" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
                            <button class="chat-send" onclick="sendMessage()">‚û§</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- –ö–∞—Ä—Ç—ã -->
            <section id="maps" class="page">
                <h2 style="margin-bottom: 20px;">–ö–∞—Ä—Ç—ã</h2>
                <div class="map-container" id="map-container">
                    <div style="font-size: 48px; margin-bottom: 20px;">üó∫Ô∏è</div>
                    <h3>–ö–∞—Ä—Ç—ã</h3>
                    <p style="margin: 20px 0; opacity: 0.8;">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</p>
                    <div>
                        <button class="map-btn" onclick="showLocation('–ú–æ—Å–∫–≤–∞')">–ú–æ—Å–∫–≤–∞</button>
                        <button class="map-btn" onclick="showLocation('–î—É–±–∞–π')">–î—É–±–∞–π</button>
                        <button class="map-btn" onclick="showLocation('–ü–∞—Ä–∏–∂')">–ü–∞—Ä–∏–∂</button>
                    </div>
                    <div id="coordinates" style="margin-top: 30px; padding: 20px; background: var(--bg); border-radius: 10px;">
                        <!-- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- –ß–∞—Ç-–±–æ—Ç -->
    <div class="chat-bot">
        <button class="chat-bot-btn" onclick="toggleChatBot()">ü§ñ</button>
        <div class="chat-bot-modal" id="chat-bot-modal">
            <div style="padding: 20px; background: var(--primary); color: white; border-radius: 15px 15px 0 0;">
                <div style="display: flex; justify-content: space-between;">
                    <span style="font-weight: bold;">–ü–æ–º–æ—â–Ω–∏–∫</span>
                    <button class="close-btn" onclick="toggleChatBot()" style="width: 30px; height: 30px; font-size: 18px;">√ó</button>
                </div>
            </div>
            <div class="chat-bot-messages" id="chat-bot-messages">
                <div class="bot-message">
                    –ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
                </div>
            </div>
            <div class="chat-bot-input">
                <input type="text" id="bot-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å...">
                <button class="chat-send" onclick="sendBotMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <!-- CS 1.6 -->
    <div class="cs-game" id="cs-game">
        <canvas id="cs-canvas"></canvas>
        <div class="cs-hud">
            <div class="cs-hud-item">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: <span id="cs-health">100</span></div>
            <div class="cs-hud-item">üí∞ –î–µ–Ω—å–≥–∏: $<span id="cs-money">800</span></div>
            <div class="cs-hud-item">üéØ –£–±–∏–π—Å—Ç–≤: <span id="cs-kills">0</span></div>
            <div class="cs-hud-item">üî´ –ü–∞—Ç—Ä–æ–Ω—ã: <span id="cs-ammo">30/90</span></div>
        </div>
        <div class="cs-weapons">
            <button class="cs-weapon" onclick="selectWeapon('ak47')">AK-47</button>
            <button class="cs-weapon" onclick="selectWeapon('awp')">AWP</button>
            <button class="cs-weapon" onclick="selectWeapon('m4a1')">M4A1</button>
        </div>
        <button class="cs-exit" onclick="exitCS()">–í—ã–π—Ç–∏</button>
    </div>

    <!-- My Talking Tom 2 -->
    <div id="talking-tom-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <h2>My Talking Tom 2</h2>
                <button class="close-btn" onclick="closeModal('talking-tom-modal')">√ó</button>
            </div>
            
            <div class="tom-game">
                <div class="tom-body" onclick="petTom()">
                    <div class="tom-eye left"></div>
                    <div class="tom-eye right"></div>
                    <div class="tom-mouth"></div>
                </div>
                
                <div class="tom-stats">
                    <div class="tom-stat">
                        <div style="font-weight: bold;">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
                        <div id="tom-happiness">100%</div>
                    </div>
                    <div class="tom-stat">
                        <div style="font-weight: bold;">–ì–æ–ª–æ–¥</div>
                        <div id="tom-hunger">100%</div>
                    </div>
                    <div class="tom-stat">
                        <div style="font-weight: bold;">–î–µ–Ω—å–≥–∏</div>
                        <div id="tom-money">$100</div>
                    </div>
                </div>
                
                <div class="tom-buttons">
                    <button class="tom-btn" onclick="feedTom()">
                        <span>üçñ</span> –ü–æ–∫–æ—Ä–º–∏—Ç—å ($10)
                    </button>
                    <button class="tom-btn" onclick="playWithTom()" style="background: var(--accent);">
                        <span>üéÆ</span> –ü–æ–∏–≥—Ä–∞—Ç—å
                    </button>
                    <button class="tom-btn" onclick="dressTom()" style="background: var(--warning);">
                        <span>üëï</span> –û–¥–µ—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–ª–∏–∫–µ—Ä -->
    <div id="clicker-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <h2>–ö–ª–∏–∫–µ—Ä</h2>
                <button class="close-btn" onclick="closeModal('clicker-modal')">√ó</button>
            </div>
            
            <div class="clicker-game">
                <div class="clicker-money" id="clicker-money">$0</div>
                <button class="clicker-btn" onclick="clickMoney()">–ö–õ–ò–ö!</button>
                
                <div class="upgrades-grid">
                    <div class="upgrade" onclick="buyUpgrade('click')">
                        <div style="font-weight: bold;">üí™ –°–∏–ª–∞ –∫–ª–∏–∫–∞</div>
                        <div style="margin: 10px 0; opacity: 0.8;">+$1 –∑–∞ –∫–ª–∏–∫</div>
                        <div style="color: var(--accent);" id="click-price">$10</div>
                    </div>
                    
                    <div class="upgrade" onclick="buyUpgrade('auto')">
                        <div style="font-weight: bold;">‚ö° –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</div>
                        <div style="margin: 10px 0; opacity: 0.8;">+$0.5/—Å–µ–∫</div>
                        <div style="color: var(--accent);" id="auto-price">$100</div>
                    </div>
                    
                    <div class="upgrade" onclick="buyUpgrade('multiplier')">
                        <div style="font-weight: bold;">üöÄ –ú–Ω–æ–∂–∏—Ç–µ–ª—å</div>
                        <div style="margin: 10px 0; opacity: 0.8;">√ó1.2 –∫–æ –≤—Å–µ–º—É</div>
                        <div style="color: var(--accent);" id="multiplier-price">$1000</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <button class="close-btn" onclick="closeModal('settings-modal')">√ó</button>
            </div>
            
            <div class="settings-grid">
                <div>
                    <h3 style="margin-bottom: 15px;">–¢–µ–º–∞</h3>
                    <div>
                        <button class="theme-btn theme-dark" onclick="setTheme('dark')">–¢—ë–º–Ω–∞—è</button>
                        <button class="theme-btn theme-light" onclick="setTheme('light')">–°–≤–µ—Ç–ª–∞—è</button>
                        <button class="theme-btn theme-purple" onclick="setTheme('purple')">–§–∏–æ–ª–µ—Ç–æ–≤–∞—è</button>
                    </div>
                </div>
                
                <div>
                    <h3 style="margin-bottom: 15px;">–°–Ω–µ–≥</h3>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>–í–∫–ª—é—á–∏—Ç—å —Å–Ω–µ–∂–∏–Ω–∫–∏</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="snow-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div>
                    <h3 style="margin-bottom: 15px;">–î–∞–Ω–Ω—ã–µ</h3>
                    <button class="voice-btn" onclick="exportData()" style="margin-bottom: 10px; width: 100%;">–≠–∫—Å–ø–æ—Ä—Ç</button>
                    <button class="voice-btn" onclick="importData()" style="margin-bottom: 10px; width: 100%; background: var(--secondary);">–ò–º–ø–æ—Ä—Ç</button>
                    <button class="voice-btn" onclick="clearData()" style="width: 100%; background: var(--danger);">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

<script>
// ====================
// –û–°–ù–û–í–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
// ====================
const USERS = ["–ù–∏–∫–∏—Ç–∞", "–ê–ª–µ–Ω–∞", "–°–∞—à–∞", "–ê–ª–∏—Å–∞", "–ì–æ—Å—Ç—å"];
let currentUser = null;
let appData = JSON.parse(localStorage.getItem('platform_data')) || {
    users: {},
    online: {},
    settings: { theme: 'dark', snow: true },
    chat: [],
    cloud: []
};

// CS 1.6
let csScene, csCamera, csRenderer, csPlayer, csBots = [];
let csHealth = 100, csMoney = 800, csKills = 0, csAmmo = 30;
let currentWeapon = 'ak47';

// Talking Tom
let tomHappiness = 100, tomHunger = 100, tomMoney = 100;

// –ö–ª–∏–∫–µ—Ä
let clickerMoney = 0, clickerClickPower = 1, clickerAutoClicker = 0, clickerMultiplier = 1;

// –ß–∞—Ç
let currentChat = 'general';
let chatMessages = { general: [] };
USERS.forEach(user => chatMessages[user] = []);

// ====================
// –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò
// ====================
function setupNavigation() {
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            this.classList.add('active');
            document.getElementById(this.dataset.page).classList.add('active');
        });
    });
}

// –°–Ω–µ–∂–∏–Ω–∫–∏
function createSnowflakes() {
    if (!appData.settings.snow || appData.settings.theme === 'light') return;
    
    for (let i = 0; i < 50; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.style.cssText = `
            width: ${Math.random() * 10 + 5}px;
            height: ${Math.random() * 10 + 5}px;
            left: ${Math.random() * 100}vw;
            opacity: ${Math.random() * 0.5 + 0.3};
            animation-duration: ${Math.random() * 10 + 10}s;
            animation-delay: ${Math.random() * 5}s;
        `;
        document.body.appendChild(snowflake);
        
        setTimeout(() => snowflake.remove(), 15000);
    }
    
    setTimeout(createSnowflakes, 15000);
}

// –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function initUserSelection() {
    const userList = document.getElementById('user-list');
    userList.innerHTML = USERS.map(username => {
        const isOccupied = appData.online[username];
        return `<button class="user-btn ${isOccupied ? 'occupied' : ''}" onclick="selectUser('${username}', ${isOccupied})">${username}</button>`;
    }).join('');
}

function selectUser(username, isOccupied) {
    if (isOccupied) {
        alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "${username}" —É–∂–µ –≤ —Å–µ—Ç–∏!`);
        return;
    }
    document.querySelectorAll('.user-btn').forEach(btn => btn.classList.remove('selected'));
    event.target.classList.add('selected');
    currentUser = username;
}

function login() {
    if (!currentUser) {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!');
        return;
    }
    
    if (appData.online[currentUser]) {
        alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "${currentUser}" —Ç–æ–ª—å–∫–æ —á—Ç–æ –≤–æ—à–µ–ª!`);
        initUserSelection();
        return;
    }
    
    if (!appData.users[currentUser]) {
        appData.users[currentUser] = {
            balance: 1000,
            games: {}
        };
    }
    
    appData.online[currentUser] = Date.now();
    saveData();
    initApp();
}

function initApp() {
    document.querySelector('.login-screen').style.display = 'none';
    document.querySelector('.main-app').style.display = 'block';
    
    setupNavigation();
    setTheme(appData.settings.theme);
    
    if (appData.settings.snow) {
        createSnowflakes();
    }
    
    updateUserInfo();
    loadCloudFiles();
    initWorldClocks();
    loadChat();
}

function updateUserInfo() {
    const userData = appData.users[currentUser];
    document.getElementById('current-avatar').textContent = currentUser[0];
    document.getElementById('current-username').textContent = currentUser;
    document.getElementById('balance').textContent = `$${userData.balance || 1000}`;
}

// ====================
// –û–ë–õ–ê–ö–û
// ====================
function addFile() {
    // –°–æ–∑–¥–∞–µ–º input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
    const input = document.createElement('input');
    input.type = 'file';
    input.multiple = true;
    
    input.onchange = (e) => {
        const files = Array.from(e.target.files);
        files.forEach(file => {
            const size = file.size > 1024 * 1024 
                ? (file.size / (1024 * 1024)).toFixed(1) + ' MB'
                : Math.round(file.size / 1024) + ' KB';
            
            const type = file.type.split('/')[0] || 'file';
            const icon = {
                'image': 'üñºÔ∏è',
                'video': 'üé¨',
                'audio': 'üéµ',
                'text': 'üìÑ',
                'application': 'üìé'
            }[type] || 'üìÑ';
            
            appData.cloud.push({
                name: file.name,
                type: icon,
                size: size,
                date: new Date().toLocaleString(),
                file: file
            });
        });
        
        saveData();
        loadCloudFiles();
    };
    
    // –ö–ª–∏–∫–∞–µ–º –Ω–∞ input –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–∞/–≥–∞–ª–µ—Ä–µ–∏
    input.click();
}

function loadCloudFiles() {
    const grid = document.getElementById('files-grid');
    const files = appData.cloud || [];
    
    if (files.length === 0) {
        grid.innerHTML = '<div style="text-align: center; padding: 40px;">–§–∞–π–ª–æ–≤ –Ω–µ—Ç</div>';
        return;
    }
    
    grid.innerHTML = files.map((file, index) => `
        <div class="file">
            <button class="delete-file" onclick="deleteFile(${index})">√ó</button>
            <div class="file-icon">${file.type}</div>
            <div style="font-weight: bold;">${file.name}</div>
            <div style="opacity: 0.7;">${file.size}</div>
        </div>
    `).join('');
}

function deleteFile(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª?')) {
        appData.cloud.splice(index, 1);
        saveData();
        loadCloudFiles();
    }
}

// ====================
// –ò–ì–†–´
// ====================
// CS 1.6
function startCS() {
    document.getElementById('cs-game').style.display = 'block';
    initCS();
}

function initCS() {
    const canvas = document.getElementById('cs-canvas');
    
    // –°—Ü–µ–Ω–∞
    csScene = new THREE.Scene();
    csScene.background = new THREE.Color(0x1a1a1a);
    
    // –ö–∞–º–µ—Ä–∞
    csCamera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
    csCamera.position.set(0, 5, 15);
    
    // –†–µ–Ω–¥–µ—Ä–µ—Ä
    csRenderer = new THREE.WebGLRenderer({ canvas });
    csRenderer.setSize(canvas.clientWidth, canvas.clientHeight);
    
    // –û—Å–≤–µ—â–µ–Ω–∏–µ
    const light = new THREE.AmbientLight(0x404040);
    csScene.add(light);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
    directionalLight.position.set(10, 20, 10);
    csScene.add(directionalLight);
    
    // –ü–æ–ª
    const floorGeometry = new THREE.PlaneGeometry(100, 100);
    const floorMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
    const floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    csScene.add(floor);
    
    // –°—Ç–µ–Ω—ã
    const wallGeometry = new THREE.BoxGeometry(80, 10, 2);
    const wallMaterial = new THREE.MeshPhongMaterial({ color: 0x666666 });
    
    // –ó–∞–¥–Ω—è—è —Å—Ç–µ–Ω–∞
    const backWall = new THREE.Mesh(wallGeometry, wallMaterial);
    backWall.position.set(0, 5, -40);
    csScene.add(backWall);
    
    // –ë–æ–∫–æ–≤—ã–µ —Å—Ç–µ–Ω—ã
    const sideWallGeometry = new THREE.BoxGeometry(2, 10, 80);
    const leftWall = new THREE.Mesh(sideWallGeometry, wallMaterial);
    leftWall.position.set(-40, 5, 0);
    csScene.add(leftWall);
    
    const rightWall = new THREE.Mesh(sideWallGeometry, wallMaterial);
    rightWall.position.set(40, 5, 0);
    csScene.add(rightWall);
    
    // –ò–≥—Ä–æ–∫ (CT)
    createCSPlayer();
    
    // –ë–æ—Ç—ã (T)
    createCSBots();
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    setupCSControls();
    
    // –ê–Ω–∏–º–∞—Ü–∏—è
    animateCS();
}

function createCSPlayer() {
    const geometry = new THREE.BoxGeometry(1, 2, 1);
    const material = new THREE.MeshPhongMaterial({ color: 0x3498db }); // –°–∏–Ω–∏–π - CT
    csPlayer = new THREE.Mesh(geometry, material);
    csPlayer.position.y = 1;
    csScene.add(csPlayer);
}

function createCSBots() {
    for (let i = 0; i < 5; i++) {
        const geometry = new THREE.BoxGeometry(1, 2, 1);
        const material = new THREE.MeshPhongMaterial({ color: 0xe74c3c }); // –ö—Ä–∞—Å–Ω—ã–π - T
        const bot = new THREE.Mesh(geometry, material);
        
        bot.position.set(
            (Math.random() - 0.5) * 70,
            1,
            (Math.random() - 0.5) * 70 - 20
        );
        
        csBots.push(bot);
        csScene.add(bot);
    }
}

function setupCSControls() {
    const keys = {};
    
    window.addEventListener('keydown', (e) => {
        keys[e.key.toLowerCase()] = true;
        if (e.key === ' ') shoot();
    });
    
    window.addEventListener('keyup', (e) => {
        keys[e.key.toLowerCase()] = false;
    });
    
    function updateMovement() {
        const speed = 0.3;
        
        if (keys['w']) csPlayer.position.z -= speed;
        if (keys['s']) csPlayer.position.z += speed;
        if (keys['a']) csPlayer.position.x -= speed;
        if (keys['d']) csPlayer.position.x += speed;
        
        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
        csPlayer.position.x = Math.max(-38, Math.min(38, csPlayer.position.x));
        csPlayer.position.z = Math.max(-38, Math.min(38, csPlayer.position.z));
        
        // –ö–∞–º–µ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –∑–∞ –∏–≥—Ä–æ–∫–æ–º
        csCamera.position.x = csPlayer.position.x;
        csCamera.position.y = csPlayer.position.y + 5;
        csCamera.position.z = csPlayer.position.z + 10;
        csCamera.lookAt(csPlayer.position);
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –±–æ—Ç–æ–≤
        csBots.forEach(bot => {
            const dx = csPlayer.position.x - bot.position.x;
            const dz = csPlayer.position.z - bot.position.z;
            const distance = Math.sqrt(dx * dx + dz * dz);
            
            if (distance > 10) {
                bot.position.x += (dx / distance) * 0.05;
                bot.position.z += (dz / distance) * 0.05;
            }
        });
    }
    
    function animateCS() {
        requestAnimationFrame(animateCS);
        updateMovement();
        csRenderer.render(csScene, csCamera);
    }
    
    animateCS();
}

function shoot() {
    if (csAmmo <= 0) return;
    
    csAmmo--;
    updateCSHUD();
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è
    csBots.forEach((bot, index) => {
        const distance = csPlayer.position.distanceTo(bot.position);
        if (distance < 10) {
            csKills++;
            csMoney += 300;
            updateCSHUD();
            
            // –£–¥–∞–ª—è–µ–º –±–æ—Ç–∞
            csScene.remove(bot);
            csBots.splice(index, 1);
            
            // –ù–æ–≤—ã–π –±–æ—Ç
            setTimeout(() => createCSBots(), 2000);
        }
    });
}

function selectWeapon(weapon) {
    currentWeapon = weapon;
    const ammo = { ak47: 30, awp: 10, m4a1: 30 }[weapon];
    csAmmo = ammo;
    updateCSHUD();
}

function updateCSHUD() {
    document.getElementById('cs-health').textContent = csHealth;
    document.getElementById('cs-money').textContent = csMoney;
    document.getElementById('cs-kills').textContent = csKills;
    document.getElementById('cs-ammo').textContent = `${csAmmo}/90`;
}

function exitCS() {
    document.getElementById('cs-game').style.display = 'none';
}

// Talking Tom 2
function startTalkingTom() {
    showModal('talking-tom-modal');
    updateTomStats();
}

function petTom() {
    tomHappiness = Math.min(100, tomHappiness + 5);
    tomMoney += 2;
    updateTomStats();
}

function feedTom() {
    if (tomMoney >= 10) {
        tomHunger = Math.min(100, tomHunger + 30);
        tomMoney -= 10;
        updateTomStats();
    } else {
        alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
    }
}

function playWithTom() {
    tomHappiness = Math.min(100, tomHappiness + 15);
    tomHunger = Math.max(0, tomHunger - 10);
    updateTomStats();
}

function dressTom() {
    if (tomMoney >= 50) {
        tomMoney -= 50;
        alert('–¢–æ–º –ø–æ–ª—É—á–∏–ª –Ω–æ–≤—É—é –æ–¥–µ–∂–¥—É!');
        updateTomStats();
    } else {
        alert('–ù—É–∂–Ω–æ $50!');
    }
}

function updateTomStats() {
    document.getElementById('tom-happiness').textContent = `${tomHappiness}%`;
    document.getElementById('tom-hunger').textContent = `${tomHunger}%`;
    document.getElementById('tom-money').textContent = `$${tomMoney}`;
}

// –ö–ª–∏–∫–µ—Ä
function startClicker() {
    showModal('clicker-modal');
    updateClickerUI();
}

function clickMoney() {
    clickerMoney += clickerClickPower * clickerMultiplier;
    updateClickerUI();
}

function buyUpgrade(type) {
    let cost = 0;
    
    switch(type) {
        case 'click':
            cost = 10 * Math.pow(2, clickerClickPower - 1);
            if (clickerMoney >= cost) {
                clickerMoney -= cost;
                clickerClickPower++;
            }
            break;
        case 'auto':
            cost = 100 * Math.pow(2, clickerAutoClicker);
            if (clickerMoney >= cost) {
                clickerMoney -= cost;
                clickerAutoClicker++;
                startAutoClicker();
            }
            break;
        case 'multiplier':
            cost = 1000 * Math.pow(2, clickerMultiplier - 1);
            if (clickerMoney >= cost) {
                clickerMoney -= cost;
                clickerMultiplier += 0.2;
            }
            break;
    }
    
    updateClickerUI();
}

function startAutoClicker() {
    if (window.autoClickerInterval) clearInterval(window.autoClickerInterval);
    
    window.autoClickerInterval = setInterval(() => {
        clickerMoney += clickerAutoClicker * 0.5 * clickerMultiplier;
        updateClickerUI();
    }, 1000);
}

function updateClickerUI() {
    document.getElementById('clicker-money').textContent = `$${Math.floor(clickerMoney)}`;
    document.getElementById('click-price').textContent = `$${10 * Math.pow(2, clickerClickPower - 1)}`;
    document.getElementById('auto-price').textContent = `$${100 * Math.pow(2, clickerAutoClicker)}`;
    document.getElementById('multiplier-price').textContent = `$${1000 * Math.pow(2, clickerMultiplier - 1)}`;
}

// ====================
// –ü–ï–†–ï–í–û–î–ß–ò–ö –° –ò–ò
// ====================
async function translateText() {
    const text = document.getElementById('input-text').value;
    const from = document.getElementById('lang-from').value;
    const to = document.getElementById('lang-to').value;
    
    if (!text.trim()) {
        document.getElementById('output-text').value = '';
        return;
    }
    
    try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π API
        const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${from}|${to}`);
        const data = await response.json();
        
        if (data.responseData) {
            document.getElementById('output-text').value = data.responseData.translatedText;
        } else {
            // Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π —Å–ª–æ–≤–∞—Ä—å
            const translations = {
                'ru-en': { '–ø—Ä–∏–≤–µ—Ç': 'hello', '–∫–∞–∫ –¥–µ–ª–∞': 'how are you', '—Å–ø–∞—Å–∏–±–æ': 'thank you' },
                'en-ru': { 'hello': '–ø—Ä–∏–≤–µ—Ç', 'how are you': '–∫–∞–∫ –¥–µ–ª–∞', 'thank you': '—Å–ø–∞—Å–∏–±–æ' }
            };
            
            const key = `${from}-${to}`;
            let result = text;
            
            if (translations[key]) {
                for (const [word, translation] of Object.entries(translations[key])) {
                    result = result.replace(new RegExp(word, 'gi'), translation);
                }
            }
            
            document.getElementById('output-text').value = result;
        }
    } catch (error) {
        document.getElementById('output-text').value = '[–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞]';
    }
}

async function askAI() {
    const question = document.getElementById('input-text').value;
    if (!question.trim()) return;
    
    // –ü—Ä–æ—Å—Ç–æ–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫
    const responses = {
        '–ø—Ä–∏–≤–µ—Ç': '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
        '–∫–∞–∫ –¥–µ–ª–∞': '–£ –º–µ–Ω—è –≤—Å–µ —Ö–æ—Ä–æ—à–æ, —Å–ø–∞—Å–∏–±–æ!',
        '—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å': '–Ø –º–æ–≥—É –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç, –ø–æ–º–æ–≥–∞—Ç—å —Å –∏–≥—Ä–∞–º–∏ –∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã.',
        '–ø–æ–º–æ—â—å': '–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ —è –ø–µ—Ä–µ–≤–µ–¥—É –µ–≥–æ.',
        '–∏–≥—Ä—ã': '–î–æ—Å—Ç—É–ø–Ω—ã –∏–≥—Ä—ã: CS 1.6, Talking Tom 2, –ö–ª–∏–∫–µ—Ä.',
        '—á–∞—Ç': '–í —á–∞—Ç–µ –º–æ–∂–Ω–æ –æ–±—â–∞—Ç—å—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.',
        '–∫–∞—Ä—Ç—ã': '–ö–∞—Ä—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ—Ä–æ–¥–æ–≤.',
        '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏': '–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –º–æ–∂–Ω–æ —Å–º–µ–Ω–∏—Ç—å —Ç–µ–º—É –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–º–∏.'
    };
    
    const lowerQuestion = question.toLowerCase();
    let response = '–Ø –µ—â–µ —É—á—É—Å—å. –ú–æ–∂–µ—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å –æ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–µ, –∏–≥—Ä–∞—Ö –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö.';
    
    for (const [key, value] of Object.entries(responses)) {
        if (lowerQuestion.includes(key)) {
            response = value;
            break;
        }
    }
    
    document.getElementById('output-text').value = response;
    
    // –û–∑–≤—É—á–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(response);
        utterance.lang = 'ru-RU';
        speechSynthesis.speak(utterance);
    }
}

function swapLanguages() {
    const from = document.getElementById('lang-from');
    const to = document.getElementById('lang-to');
    [from.value, to.value] = [to.value, from.value];
    translateText();
}

function speakTranslation() {
    const text = document.getElementById('output-text').value;
    if (!text.trim()) return;
    
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = document.getElementById('lang-to').value;
        speechSynthesis.speak(utterance);
    }
}

function startVoiceInput() {
    if ('webkitSpeechRecognition' in window) {
        const recognition = new webkitSpeechRecognition();
        recognition.lang = document.getElementById('lang-from').value;
        recognition.onresult = (event) => {
            const text = event.results[0][0].transcript;
            document.getElementById('input-text').value = text;
            translateText();
        };
        recognition.start();
    } else {
        alert('–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
    }
}

// ====================
// –ß–ê–°–´ –ú–ò–†–ê
// ====================
const timezones = {
    '–ú–æ—Å–∫–≤–∞': 'Europe/Moscow',
    '–î—É–±–∞–π': 'Asia/Dubai',
    '–ü–∞—Ä–∏–∂': 'Europe/Paris',
    '–¢–æ–∫–∏–æ': 'Asia/Tokyo',
    '–ù—å—é-–ô–æ—Ä–∫': 'America/New_York'
};

function initWorldClocks() {
    const grid = document.getElementById('clocks-grid');
    grid.innerHTML = Object.keys(timezones).map(city => `
        <div class="clock">
            <div style="font-weight: bold;">${city}</div>
            <div class="clock-time" id="clock-${city}">00:00:00</div>
            <div id="date-${city}">--</div>
        </div>
    `).join('');
    
    updateClocks();
    setInterval(updateClocks, 1000);
}

function updateClocks() {
    const now = new Date();
    
    Object.keys(timezones).forEach(city => {
        try {
            const timeString = now.toLocaleTimeString('ru-RU', { timeZone: timezones[city] });
            const dateString = now.toLocaleDateString('ru-RU', { timeZone: timezones[city] });
            
            document.getElementById(`clock-${city}`).textContent = timeString;
            document.getElementById(`date-${city}`).textContent = dateString;
        } catch (e) {
            // Fallback
            document.getElementById(`clock-${city}`).textContent = now.toLocaleTimeString();
        }
    });
}

// ====================
// –ß–ê–¢ P2P
// ====================
function loadChat() {
    const usersDiv = document.getElementById('chat-users');
    usersDiv.innerHTML = `
        <div class="chat-user active" onclick="switchChat('general')">
            <div style="font-weight: bold;">–û–±—â–∏–π —á–∞—Ç</div>
            <div style="font-size: 12px; opacity: 0.7;">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
        </div>
    `;
    
    USERS.forEach(user => {
        if (user !== currentUser) {
            const isOnline = appData.online[user];
            usersDiv.innerHTML += `
                <div class="chat-user" onclick="switchChat('${user}')">
                    <div style="font-weight: bold;">${user}</div>
                    <div style="font-size: 12px; opacity: 0.7;">${isOnline ? 'üü¢ –û–Ω–ª–∞–π–Ω' : '‚ö´ –û—Ñ–ª–∞–π–Ω'}</div>
                </div>
            `;
        }
    });
    
    switchChat('general');
}

function switchChat(user) {
    currentChat = user;
    document.querySelectorAll('.chat-user').forEach(el => el.classList.remove('active'));
    event.target.closest('.chat-user').classList.add('active');
    
    document.getElementById('chat-title').textContent = user === 'general' ? '–û–±—â–∏–π —á–∞—Ç' : `–ß–∞—Ç —Å ${user}`;
    showMessages();
}

function showMessages() {
    const list = document.getElementById('messages-list');
    const messages = chatMessages[currentChat] || [];
    
    list.innerHTML = messages.map(msg => `
        <div class="message ${msg.sender === currentUser ? 'sent' : 'received'}">
            <div style="font-weight: bold;">${msg.sender}</div>
            <div>${msg.text}</div>
            <div style="font-size: 12px; opacity: 0.7;">${msg.time}</div>
        </div>
    `).join('');
    
    list.scrollTop = list.scrollHeight;
}

function sendMessage() {
    const input = document.getElementById('chat-message');
    const text = input.value.trim();
    
    if (!text) return;
    
    const message = {
        sender: currentUser,
        text: text,
        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    };
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    chatMessages[currentChat].push(message);
    
    // –ï—Å–ª–∏ —ç—Ç–æ –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–Ω–ª–∞–π–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    if (currentChat !== 'general' && appData.online[currentChat]) {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å WebSocket –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ P2P
        alert(`–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${currentChat}!`);
    }
    
    // –î–ª—è –æ–±—â–µ–≥–æ —á–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
    if (currentChat === 'general') {
        appData.chat.push(message);
        saveData();
    }
    
    input.value = '';
    showMessages();
}

// ====================
// –ö–ê–†–¢–´
// ====================
function showLocation(city) {
    const coordinates = {
        '–ú–æ—Å–∫–≤–∞': '55.7558¬∞ N, 37.6173¬∞ E',
        '–î—É–±–∞–π': '25.2048¬∞ N, 55.2708¬∞ E',
        '–ü–∞—Ä–∏–∂': '48.8566¬∞ N, 2.3522¬∞ E'
    };
    
    document.getElementById('coordinates').innerHTML = `
        <div style="font-weight: bold;">üìç ${city}</div>
        <div style="margin: 10px 0;">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</div>
        <div style="font-family: monospace; background: var(--card); padding: 10px; border-radius: 5px;">
            ${coordinates[city]}
        </div>
        <div style="margin-top: 15px; font-size: 14px; opacity: 0.8;">
            –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–µ
        </div>
    `;
}

// ====================
// –ß–ê–¢-–ë–û–¢
// ====================
function toggleChatBot() {
    const modal = document.getElementById('chat-bot-modal');
    modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
}

function sendBotMessage() {
    const input = document.getElementById('bot-input');
    const text = input.value.trim();
    
    if (!text) return;
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    addBotMessage(text, 'user');
    input.value = '';
    
    // –ò–ò –æ—Ç–≤–µ—Ç
    setTimeout(() => {
        const response = generateAIResponse(text);
        addBotMessage(response, 'bot');
        
        // –û–∑–≤—É—á–∏–≤–∞–µ–º
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(response);
            utterance.lang = 'ru-RU';
            speechSynthesis.speak(utterance);
        }
    }, 500);
}

function addBotMessage(text, sender) {
    const container = document.getElementById('chat-bot-messages');
    const div = document.createElement('div');
    div.className = `bot-message ${sender === 'user' ? 'user' : ''}`;
    div.textContent = text;
    container.appendChild(div);
    container.scrollTop = container.scrollHeight;
}

function generateAIResponse(text) {
    const lowerText = text.toLowerCase();
    
    // –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
    const knowledgeBase = {
        '–ø—Ä–∏–≤–µ—Ç': `–ü—Ä–∏–≤–µ—Ç, ${currentUser}! –ö–∞–∫ –¥–µ–ª–∞?`,
        '–∫–∞–∫ –¥–µ–ª–∞': '–£ –º–µ–Ω—è –≤—Å–µ –æ—Ç–ª–∏—á–Ω–æ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?',
        '—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å': '–Ø –º–æ–≥—É: 1) –ü–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç 2) –ü–æ–º–æ–≥–∞—Ç—å —Å –∏–≥—Ä–∞–º–∏ 3) –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã 4) –û–±—â–∞—Ç—å—Å—è –≤ —á–∞—Ç–µ',
        '–ø–µ—Ä–µ–≤–æ–¥': '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏".',
        '–∏–≥—Ä—ã': '–î–æ—Å—Ç—É–ø–Ω—ã: CS 1.6 (—à—É—Ç–µ—Ä), Talking Tom 2 (–ø–∏—Ç–æ–º–µ—Ü), –ö–ª–∏–∫–µ—Ä (–∫–ª–∏–∫–µ—Ä).',
        '–∫—Å': 'Counter-Strike 1.6 - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —à—É—Ç–µ—Ä. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: WASD - –¥–≤–∏–∂–µ–Ω–∏–µ, –ü—Ä–æ–±–µ–ª - —Å—Ç—Ä–µ–ª—å–±–∞.',
        '—Ç–æ–º': 'My Talking Tom 2 - –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü. –ö–æ—Ä–º–∏—Ç–µ –µ–≥–æ, –∏–≥—Ä–∞–π—Ç–µ, –ø–æ–∫—É–ø–∞–π—Ç–µ –æ–¥–µ–∂–¥—É.',
        '–∫–ª–∏–∫–µ—Ä': '–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –∫–ª–∏–∫–∞–º–∏, –ø–æ–∫—É–ø–∞–π—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –¥–æ—Ö–æ–¥–∞.',
        '—á–∞—Ç': '–û–±—â–∞–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤ –æ–±—â–µ–º –∏–ª–∏ –ª–∏—á–Ω–æ–º —á–∞—Ç–µ.',
        '–∫–∞—Ä—Ç—ã': '–ü–æ–ª—É—á–∞–π—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞—Ö.',
        '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏': '–°–º–µ–Ω–∏—Ç–µ —Ç–µ–º—É, –≤–∫–ª—é—á–∏—Ç–µ/–≤—ã–∫–ª—é—á–∏—Ç–µ —Å–Ω–µ–≥, —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –¥–∞–Ω–Ω—ã–º–∏.',
        '—Å–ø–∞—Å–∏–±–æ': '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! –í—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–º–æ—á—å.',
        '–ø–æ–∫–∞': '–î–æ —Å–≤–∏–¥–∞–Ω–∏—è! –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –µ—â–µ.'
    };
    
    // –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π –æ—Ç–≤–µ—Ç
    for (const [key, response] of Object.entries(knowledgeBase)) {
        if (lowerText.includes(key)) {
            return response;
        }
    }
    
    // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç
    return '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –Ø –µ—â–µ —É—á—É—Å—å. –ú–æ–∂–µ—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å –æ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–µ, –∏–≥—Ä–∞—Ö –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.';
}

// ====================
// –ù–ê–°–¢–†–û–ô–ö–ò
// ====================
function openSettings() {
    showModal('settings-modal');
}

function setTheme(theme) {
    document.body.setAttribute('data-theme', theme);
    appData.settings.theme = theme;
    saveData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–Ω–µ–≥
    if (theme === 'light') {
        document.getElementById('snow-toggle').checked = false;
        document.getElementById('snow-toggle').disabled = true;
    } else {
        document.getElementById('snow-toggle').disabled = false;
        if (appData.settings.snow) {
            createSnowflakes();
        }
    }
}

function exportData() {
    const data = JSON.stringify(appData, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = 'platform_data.json';
    a.click();
    
    alert('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
}

function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = (e) => {
            try {
                const data = JSON.parse(e.target.result);
                Object.assign(appData, data);
                saveData();
                alert('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                location.reload();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ: ' + error.message);
            }
        };
        
        reader.readAsText(file);
    };
    
    input.click();
}

function clearData() {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')) {
        localStorage.clear();
        location.reload();
    }
}

// ====================
// –£–¢–ò–õ–ò–¢–´
// ====================
function showModal(id) {
    document.getElementById(id).style.display = 'flex';
}

function closeModal(id) {
    document.getElementById(id).style.display = 'none';
}

function saveData() {
    localStorage.setItem('platform_data', JSON.stringify(appData));
}

function exitApp() {
    if (confirm('–í—ã–π—Ç–∏?')) {
        delete appData.online[currentUser];
        saveData();
        location.reload();
    }
}

// ====================
// –ó–ê–ì–†–£–ó–ö–ê
// ====================
window.addEventListener('load', () => {
    initUserSelection();
    
    // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–æ–≤
    const now = Date.now();
    Object.keys(appData.online || {}).forEach(user => {
        if (now - appData.online[user] > 300000) { // 5 –º–∏–Ω—É—Ç
            delete appData.online[user];
        }
    });
    saveData();
    
    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    setInterval(saveData, 30000);
});

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–Ω–µ–≥–∞
document.getElementById('snow-toggle').addEventListener('change', function(e) {
    appData.settings.snow = e.target.checked;
    saveData();
    
    if (e.target.checked && appData.settings.theme !== 'light') {
        createSnowflakes();
    }
});

// Enter –¥–ª—è —á–∞—Ç–∞
document.getElementById('chat-message').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') sendMessage();
});

// Enter –¥–ª—è –±–æ—Ç–∞
document.getElementById('bot-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') sendBotMessage();
});
</script>
</body>
</html>
